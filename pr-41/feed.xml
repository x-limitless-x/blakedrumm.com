<?xml version="1.0" encoding="UTF-8"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Blake Drumm - Technical Blog</title>
    <description>This is the personal technical blog for Blake Drumm. I am a Senior Support Escalation Engineer at Microsoft.</description>
    <link>https://blakedrumm.com/</link>
    <atom:link href="https://blakedrumm.com/feed.xml" rel="self" type="application/rss+xml"/>
    <pubDate>Wed, 11 Feb 2026 11:37:33 -0500</pubDate>
    <lastBuildDate>Wed, 11 Feb 2026 11:37:33 -0500</lastBuildDate>
    <generator>Jekyll v4.3.2</generator>

    
      <item>
        <title>Deep-Dive Email Delivery Analysis with KQL - Azure Communication Services (ACS)</title>
        <postImage>/assets/img/posts/acs-email-delivery-kql.png</postImage>
        <description>&lt;h2 id=&quot;-introduction&quot;&gt;üí° Introduction&lt;/h2&gt;

&lt;p&gt;Email troubleshooting in &lt;strong&gt;Azure Communication Services (ACS)&lt;/strong&gt; can be deceptively complex.&lt;/p&gt;

&lt;p&gt;A message may appear to be sent successfully, yet arrive late, get quarantined, bounce with minimal explanation, or fail silently due to downstream mail server policies. While ACS exposes rich diagnostics in Azure Monitor, those signals are spread across multiple tables and often require correlation to tell a complete story.&lt;/p&gt;

&lt;p&gt;This post introduces a &lt;strong&gt;production-ready KQL query&lt;/strong&gt; that joins ACS email send and status logs to provide a &lt;strong&gt;single, enriched view of email delivery behavior&lt;/strong&gt; ‚Äî including latency, message characteristics, sender and recipient context, and clear interpretations of SMTP and enhanced SMTP failure codes.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-prerequisites&quot;&gt;üìã Prerequisites&lt;/h2&gt;

&lt;p&gt;To use this query, you‚Äôll need:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Access to Azure Monitor Log Analytics workspace with ACS diagnostic logs enabled&lt;/li&gt;
  &lt;li&gt;At least &lt;strong&gt;Log Analytics Reader&lt;/strong&gt; role on the workspace&lt;/li&gt;
  &lt;li&gt;ACS Email diagnostic logs flowing to the workspace (both &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ACSEmailSendMailOperational&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ACSEmailStatusUpdateOperational&lt;/code&gt; tables)&lt;/li&gt;
  &lt;li&gt;Basic familiarity with KQL (Kusto Query Language)&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-the-problem-with-raw-acs-email-logs&quot;&gt;üì© The Problem with Raw ACS Email Logs&lt;/h2&gt;

&lt;p&gt;Out of the box, ACS email diagnostics present a few challenges:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Send and delivery status events live in &lt;strong&gt;separate tables&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Correlating send and delivery events requires understanding MessageId/CorrelationId relationships&lt;/li&gt;
  &lt;li&gt;SMTP codes are numeric and often unclear without protocol knowledge&lt;/li&gt;
  &lt;li&gt;Enhanced SMTP codes are easy to miss or misinterpret&lt;/li&gt;
  &lt;li&gt;Message size and attachment details are not immediately obvious&lt;/li&gt;
  &lt;li&gt;Bounce behavior (hard vs. soft) requires manual interpretation&lt;/li&gt;
  &lt;li&gt;Correlating events across systems is difficult without message IDs&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;When customers ask questions like:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;‚ÄúWhy did this email bounce?‚Äù&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;‚ÄúWhy did delivery take 30 seconds instead of 2?‚Äù&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;‚ÄúIs this a content issue, a mailbox issue, or a policy block?‚Äù&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You need more than raw logs ‚Äî you need &lt;strong&gt;context&lt;/strong&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-what-this-query-does&quot;&gt;üîç What This Query Does&lt;/h2&gt;

&lt;p&gt;This KQL query was built to answer those questions directly.&lt;/p&gt;

&lt;p&gt;At a high level, it:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Joins &lt;strong&gt;send events&lt;/strong&gt; with &lt;strong&gt;final delivery status events&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Measures &lt;strong&gt;end-to-end delivery latency&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Enriches results with sender, recipient, and message metadata&lt;/li&gt;
  &lt;li&gt;Classifies bounces and failures&lt;/li&gt;
  &lt;li&gt;Translates SMTP and enhanced SMTP codes into readable explanations&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;All results are returned in a &lt;strong&gt;single, sortable dataset&lt;/strong&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;Ô∏è-data-sources-used&quot;&gt;‚öôÔ∏è Data Sources Used&lt;/h2&gt;

&lt;p&gt;The query relies on two ACS diagnostic tables:&lt;/p&gt;

&lt;h3 id=&quot;1Ô∏è‚É£-acsemailsendmailoperational&quot;&gt;1Ô∏è‚É£ ACSEmailSendMailOperational&lt;/h3&gt;
&lt;p&gt;Used to capture:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Send timestamp&lt;/li&gt;
  &lt;li&gt;Message correlation ID&lt;/li&gt;
  &lt;li&gt;Message size (in &lt;strong&gt;megabytes&lt;/strong&gt;, not bytes)&lt;/li&gt;
  &lt;li&gt;Attachment count&lt;/li&gt;
  &lt;li&gt;Recipient counts (To, Cc, Bcc, unique)&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;2Ô∏è‚É£-acsemailstatusupdateoperational&quot;&gt;2Ô∏è‚É£ ACSEmailStatusUpdateOperational&lt;/h3&gt;
&lt;p&gt;Used to capture:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Final delivery status&lt;/li&gt;
  &lt;li&gt;SMTP and enhanced SMTP status codes&lt;/li&gt;
  &lt;li&gt;Sender identity&lt;/li&gt;
  &lt;li&gt;Failure reason and message&lt;/li&gt;
  &lt;li&gt;Bounce classification&lt;/li&gt;
  &lt;li&gt;Recipient mail server details&lt;/li&gt;
  &lt;li&gt;InternetMessageId for cross-system correlation&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-the-complete-query&quot;&gt;üìú The Complete Query&lt;/h2&gt;

&lt;p&gt;Here‚Äôs the full KQL query. You can copy and paste this directly into Azure Monitor Log Analytics:&lt;/p&gt;

&lt;div class=&quot;language-kql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// -----------------------------------------------&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Description: Analyzes Azure Communication Services email delivery by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//              joining send and status logs to measure delivery latency &lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//              and surface clear explanations for SMTP and enhanced SMTP&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//              failure codes.&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Created by: Blake Drumm (blakedrumm@microsoft.com)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Date Created: January 21st, 2026&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Enhanced: February 10th, 2026&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Enhancements:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//   - Added sender information (SenderUsername, SenderDomain)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//   - Added message characteristics (Size in MB, AttachmentsCount, recipient counts)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//   - Added detailed failure information (FailureMessage, FailureReason)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//   - Added bounce classification (IsHardBounce, BounceType)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//   - Added recipient domain extraction and mail server tracking&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//   - Added InternetMessageId for cross-system correlation&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;//   - Corrected Size field interpretation (megabytes, not bytes)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// -----------------------------------------------&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ACSEmailSendMailOperational&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;project&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SendTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TimeGenerated&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CorrelationId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageSize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Size is in megabytes (MB)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AttachmentsCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ToRecipientsCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CcRecipientsCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BccRecipientsCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UniqueRecipientsCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ResourceId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inner&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ACSEmailStatusUpdateOperational&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isnotempty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecipientId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DeliveryStatus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Delivered&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Failed&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Bounced&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Suppressed&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Quarantined&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;FilteredSpam&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;summarize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;arg_max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TimeGenerated&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DeliveryStatus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
                        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SenderDomain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SenderUsername&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FailureMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FailureReason&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
                        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsHardBounce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecipientMailServerHostName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InternetMessageId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CorrelationId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecipientId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ResourceId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;project&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecipientId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ResourceId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalStatusTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TimeGenerated&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalDeliveryStatus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DeliveryStatus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tostring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tostring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SenderDomain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SenderUsername&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FailureMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FailureReason&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsHardBounce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecipientMailServerHostName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InternetMessageId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ResourceId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalStatusTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SendTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DurationMilliseconds&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;datetime_diff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;millisecond&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalStatusTime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SendTime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DurationSeconds&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;round&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;todouble&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DurationMilliseconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1000.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Extract recipient domain for analysis&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecipientDomain&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tolower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extract&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;@&quot;@(.+)$&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecipientId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Categorize message size (Size field is in megabytes)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageSizeCategory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageSize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0.1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Tiny (&amp;lt;100KB)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageSize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;1.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Small (100KB-1MB)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageSize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;5.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Medium (1-5MB)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageSize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;10.0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Large (5-10MB)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Very Large (&amp;gt;10MB)&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Categorize bounce type (handle both &quot;True&quot;/&quot;False&quot; and &quot;true&quot;/&quot;false&quot;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BounceType&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalDeliveryStatus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Delivered&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Not Applicable&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tolower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsHardBounce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Hard Bounce&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tolower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsHardBounce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;false&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Soft Bounce&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalDeliveryStatus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Bounced&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Failed&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isempty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IsHardBounce&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Unknown (not populated)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Unknown&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;iff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isempty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalDeliveryStatus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Delivered&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;not applicable&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;iff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isempty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalDeliveryStatus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Delivered&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;not applicable&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCodeDetails&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;not applicable&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Not applicable (Delivered)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;421&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Service not available; try again later (temporary failure)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;450&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Mailbox unavailable (temporary); retry expected&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;451&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Local error in processing (temporary); retry expected&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;452&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Insufficient system storage (temporary); retry expected&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;500&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Syntax error; command unrecognized&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;501&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Syntax error in parameters or arguments&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;502&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Command not implemented&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;503&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Bad sequence of commands&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;504&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Command parameter not implemented&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;550&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Mailbox unavailable / policy / access denied (permanent failure)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;551&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;User not local; please try forwarding address&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;552&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Storage allocation exceeded (mailbox full or message too large)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;553&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Mailbox name not allowed / invalid recipient&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;554&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Transaction failed (often policy/content rejection)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isempty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Unknown / not provided&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;strcat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Unmapped SMTP code: &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCodeDetails&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;not applicable&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Not applicable (Delivered)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5.1.1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Bad destination mailbox address (recipient doesn&apos;t exist)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5.1.0&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Bad destination mailbox address&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5.2.2&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Mailbox full&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5.2.1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Mailbox disabled / not accepting mail&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5.4.1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Cannot route / no answer from host / destination routing issue&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;5.7.1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Rejected by policy (SPF/DKIM/DMARC/reputation/policy)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;4.7.1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Temporary policy/reputation issue; retry expected&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;4.4.1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Connection timed out / temporary network issue; retry expected&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;isempty&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Unknown / not provided&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;strcat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Unmapped enhanced code: &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;project&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;InternetMessageId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecipientId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecipientDomain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SenderUsername&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SenderDomain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalDeliveryStatus&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BounceType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SendTime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalStatusTime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DurationSeconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DurationMilliseconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageSize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageSizeCategory&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AttachmentsCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ToRecipientsCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;CcRecipientsCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BccRecipientsCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UniqueRecipientsCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SmtpStatusCodeDetails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCodeDetails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FailureReason&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FailureMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecipientMailServerHostName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;_ResourceId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;order&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SendTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;desc&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;Ô∏è-delivery-latency-measurement&quot;&gt;‚è±Ô∏è Delivery Latency Measurement&lt;/h2&gt;

&lt;p&gt;The query calculates delivery latency using:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SendTime&lt;/code&gt; (from send logs)&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FinalStatusTime&lt;/code&gt; (from status logs)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;It then derives:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DurationMilliseconds&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;DurationSeconds&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This makes it easy to:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Identify delayed deliveries&lt;/li&gt;
  &lt;li&gt;Compare performance across recipient domains&lt;/li&gt;
  &lt;li&gt;Spot transient vs. systemic delays&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-message-characteristics-and-size-handling&quot;&gt;üì¶ Message Characteristics and Size Handling&lt;/h2&gt;

&lt;p&gt;One common pitfall is assuming the ACS &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Size&lt;/code&gt; field is reported in bytes.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;It is not.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;This query correctly treats &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Size&lt;/code&gt; as &lt;strong&gt;megabytes (MB)&lt;/strong&gt; and adds:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;A &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MessageSizeCategory&lt;/code&gt; field:
    &lt;ul&gt;
      &lt;li&gt;Tiny (&amp;lt;100KB)&lt;/li&gt;
      &lt;li&gt;Small (100KB‚Äì1MB)&lt;/li&gt;
      &lt;li&gt;Medium (1‚Äì5MB)&lt;/li&gt;
      &lt;li&gt;Large (5‚Äì10MB)&lt;/li&gt;
      &lt;li&gt;Very Large (&amp;gt;10MB)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Combined with attachment and recipient counts, this helps identify:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Messages that may trigger size-based rejections&lt;/li&gt;
  &lt;li&gt;Large fan-out sends with higher delivery latency&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; ACS has a default maximum email size of 10MB (including attachments), though this can be increased to 30MB via support request. Messages exceeding limits will fail before logging.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-bounce-classification&quot;&gt;üí• Bounce Classification&lt;/h2&gt;

&lt;p&gt;The query explicitly categorizes bounce behavior:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Hard Bounce&lt;/strong&gt; ‚Äì permanent failure (invalid mailbox, policy block, etc.)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Soft Bounce&lt;/strong&gt; ‚Äì temporary failure (mailbox full, throttling, transient policy)&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Not Applicable&lt;/strong&gt; ‚Äì delivered successfully&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This makes it trivial to separate:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Retry-worthy failures&lt;/li&gt;
  &lt;li&gt;Permanent delivery issues&lt;/li&gt;
  &lt;li&gt;Clean deliveries&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-smtp-and-enhanced-smtp-code-translation&quot;&gt;üìú SMTP and Enhanced SMTP Code Translation&lt;/h2&gt;

&lt;p&gt;Raw SMTP codes are not very helpful on their own.&lt;/p&gt;

&lt;p&gt;This query maps:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Standard SMTP status codes (e.g., &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;550&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;554&lt;/code&gt;)&lt;/li&gt;
  &lt;li&gt;Enhanced SMTP status codes (e.g., &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5.1.1&lt;/code&gt;, &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5.7.1&lt;/code&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Into &lt;strong&gt;clear, human-readable explanations&lt;/strong&gt;, such as:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;‚ÄúBad destination mailbox address (recipient doesn‚Äôt exist)‚Äù&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;‚ÄúRejected by policy (SPF/DKIM/DMARC/reputation)‚Äù&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;‚ÄúTemporary network issue; retry expected‚Äù&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Delivered messages automatically show:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;not applicable&amp;gt;&lt;/code&gt; for SMTP fields&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This removes ambiguity and speeds up root-cause analysis.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-recipient-and-server-intelligence&quot;&gt;üåê Recipient and Server Intelligence&lt;/h2&gt;

&lt;p&gt;The query extracts and surfaces:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Recipient domain&lt;/li&gt;
  &lt;li&gt;Recipient mail server hostname&lt;/li&gt;
  &lt;li&gt;InternetMessageId&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This allows you to:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Group failures by destination domain&lt;/li&gt;
  &lt;li&gt;Identify problematic recipient mail systems&lt;/li&gt;
  &lt;li&gt;Correlate ACS activity with external mail logs or SIEM data&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-common-usage-patterns&quot;&gt;üéØ Common Usage Patterns&lt;/h2&gt;

&lt;h3 id=&quot;filter-by-specific-sender&quot;&gt;Filter by Specific Sender&lt;/h3&gt;
&lt;div class=&quot;language-kql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SenderUsername&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;noreply@yourdomain.com&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;find-all-bounces-to-a-specific-domain&quot;&gt;Find All Bounces to a Specific Domain&lt;/h3&gt;
&lt;div class=&quot;language-kql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecipientDomain&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;gmail.com&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalDeliveryStatus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Bounced&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;identify-slow-deliveries-10-seconds&quot;&gt;Identify Slow Deliveries (&amp;gt;10 seconds)&lt;/h3&gt;
&lt;div class=&quot;language-kql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DurationSeconds&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalDeliveryStatus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Delivered&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;messages-with-large-size-or-attachments&quot;&gt;Messages with Large Size or Attachments&lt;/h3&gt;
&lt;div class=&quot;language-kql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageSize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;5.0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;or&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AttachmentsCount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;all-hard-bounces-in-last-24-hours&quot;&gt;All Hard Bounces in Last 24 Hours&lt;/h3&gt;
&lt;div class=&quot;language-kql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BounceType&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Hard Bounce&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SendTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ago&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;24h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-aggregation-examples-for-dashboards&quot;&gt;üìä Aggregation Examples for Dashboards&lt;/h2&gt;

&lt;h3 id=&quot;delivery-success-rate-by-recipient-domain&quot;&gt;Delivery Success Rate by Recipient Domain&lt;/h3&gt;
&lt;div class=&quot;language-kql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// Add this to the end of the base query&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;summarize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Total&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Delivered&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;countif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalDeliveryStatus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Delivered&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Bounced&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;countif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalDeliveryStatus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Bounced&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;RecipientDomain&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SuccessRate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;round&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;100.0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Delivered&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Total&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;order&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Total&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;desc&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;average-delivery-time-by-hour&quot;&gt;Average Delivery Time by Hour&lt;/h3&gt;
&lt;div class=&quot;language-kql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// Add this to the end of the base query&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalDeliveryStatus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Delivered&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;summarize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;AvgDeliverySeconds&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;avg&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DurationSeconds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;bin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SendTime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;1h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;timechart&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;top-failure-reasons&quot;&gt;Top Failure Reasons&lt;/h3&gt;
&lt;div class=&quot;language-kql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// Add this to the end of the base query&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FinalDeliveryStatus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Delivered&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;summarize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Count&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FailureReason&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;EnhancedSmtpStatusCodeDetails&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;order&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Count&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;desc&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;take&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;bounce-rate-by-sender&quot;&gt;Bounce Rate by Sender&lt;/h3&gt;
&lt;div class=&quot;language-kql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// Add this to the end of the base query&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;summarize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TotalSent&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HardBounces&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;countif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BounceType&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Hard Bounce&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SoftBounces&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;countif&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;BounceType&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Soft Bounce&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;SenderUsername&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HardBounceRate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;round&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;100.0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HardBounces&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TotalSent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;order&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HardBounceRate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;desc&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;message-size-distribution&quot;&gt;Message Size Distribution&lt;/h3&gt;
&lt;div class=&quot;language-kql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// Add this to the end of the base query&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;summarize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;Count&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;MessageSizeCategory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;piechart&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;Ô∏è-limitations--known-issues&quot;&gt;‚ö†Ô∏è Limitations &amp;amp; Known Issues&lt;/h2&gt;

&lt;h3 id=&quot;subject-lines-are-not-available&quot;&gt;Subject Lines Are Not Available&lt;/h3&gt;
&lt;p&gt;Azure Communication Services does not log email subject lines or body content in diagnostic logs for privacy and security reasons. Only metadata (sender, recipient, size, status codes) is captured.&lt;/p&gt;

&lt;p&gt;If you need to track subjects, implement custom logging in your application before sending:&lt;/p&gt;

&lt;div class=&quot;language-csharp highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// Example: Log subject before sending&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;logger&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LogInformation&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Sending email - MessageId: {messageId}, Subject: {subject}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; 
    &lt;span class=&quot;n&quot;&gt;correlationId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;emailMessage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Subject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;ishardbounce-casing&quot;&gt;IsHardBounce Casing&lt;/h3&gt;
&lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;IsHardBounce&lt;/code&gt; field returns &lt;strong&gt;‚ÄúTrue‚Äù/‚ÄùFalse‚Äù&lt;/strong&gt; (capital T/F), not ‚Äútrue‚Äù/‚Äùfalse‚Äù. The query handles this with case-insensitive comparison using &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;tolower()&lt;/code&gt;.&lt;/p&gt;

&lt;h3 id=&quot;time-range-performance&quot;&gt;Time Range Performance&lt;/h3&gt;
&lt;p&gt;For optimal performance on large datasets, limit queries to specific time ranges (e.g., last 24-48 hours) rather than scanning all historical data. Add this at the start:&lt;/p&gt;

&lt;div class=&quot;language-kql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;TimeGenerated&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ago&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;24h&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;correlation-timing&quot;&gt;Correlation Timing&lt;/h3&gt;
&lt;p&gt;The query filters for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;FinalStatusTime &amp;gt;= SendTime&lt;/code&gt; to ensure logical ordering. In rare cases where clock skew exists, some records may be excluded.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-when-to-use-this-query&quot;&gt;üß™ When to Use This Query&lt;/h2&gt;

&lt;p&gt;This query is ideal for:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Investigating bounced or delayed emails&lt;/li&gt;
  &lt;li&gt;Analyzing delivery performance trends&lt;/li&gt;
  &lt;li&gt;Supporting customer escalations&lt;/li&gt;
  &lt;li&gt;Validating ACS email configuration&lt;/li&gt;
  &lt;li&gt;Understanding policy-based rejections&lt;/li&gt;
  &lt;li&gt;Building workbooks or dashboards for email observability&lt;/li&gt;
  &lt;li&gt;Identifying problematic recipient domains or mail servers&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-next-steps&quot;&gt;üöÄ Next Steps&lt;/h2&gt;

&lt;p&gt;Now that you have the query, here are some ways to extend it:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Create an Azure Workbook&lt;/strong&gt; ‚Äì Build interactive dashboards using this query as a data source&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Set Up Alerts&lt;/strong&gt; ‚Äì Create alerts for high bounce rates, delivery latency spikes, or specific failure patterns&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Join with Application Logs&lt;/strong&gt; ‚Äì Use &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MessageId&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;InternetMessageId&lt;/code&gt; to correlate with your application‚Äôs custom logging&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Export to Power BI&lt;/strong&gt; ‚Äì For long-term trend analysis and executive reporting&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Integrate with SIEM&lt;/strong&gt; ‚Äì Feed results into Azure Sentinel or third-party SIEM tools&lt;/li&gt;
&lt;/ol&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-related-resources&quot;&gt;üìö Related Resources&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/azure/communication-services/concepts/email/email-overview&quot;&gt;Azure Communication Services Email Documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/acsemailsendmailoperational&quot;&gt;ACSEmailSendMailOperational Table Reference&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/azure/azure-monitor/reference/tables/acsemailstatusupdateoperational&quot;&gt;ACSEmailStatusUpdateOperational Table Reference&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc5321#section-4.2&quot;&gt;SMTP Status Codes (RFC 5321)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc3463&quot;&gt;Enhanced SMTP Status Codes (RFC 3463)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://learn.microsoft.com/en-us/azure/data-explorer/kusto/query/&quot;&gt;Azure Monitor KQL Reference&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-final-thoughts&quot;&gt;üß† Final Thoughts&lt;/h2&gt;

&lt;p&gt;Azure Communication Services provides excellent email diagnostics ‚Äî but the real power comes from &lt;strong&gt;correlating and enriching that data&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;This KQL query turns raw ACS logs into a structured, actionable dataset that answers the questions customers actually ask:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;em&gt;What happened to my email?&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Why did it fail?&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;How long did it take?&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Is this temporary or permanent?&lt;/em&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If you work with ACS Email regularly, this query is a strong foundation for troubleshooting, reporting, and long-term monitoring.&lt;/p&gt;

&lt;p&gt;Feel free to adapt, extend, and share this query with your team. Happy troubleshooting! üéâ&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/acs-email-delivery-analysis-kql/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>February 10, 2026</pubDate>
        <link>https://blakedrumm.com/blog/acs-email-delivery-analysis-kql/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/acs-email-delivery-analysis-kql/</guid>
      </item>
    
      <item>
        <title>Custom IAM Roles Are Not Supported - Azure Communication Services (ACS)</title>
        <postImage>/assets/img/posts/acs-custom-iam-roles-not-supported.png</postImage>
        <description>&lt;h2 id=&quot;-introduction&quot;&gt;üí° Introduction&lt;/h2&gt;

&lt;p&gt;When deploying or securing Azure Communication Services (ACS), it‚Äôs natural to want to follow least-privilege access principles by creating custom IAM (RBAC) roles.&lt;/p&gt;

&lt;p&gt;This is especially common when customers want to:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Separate operational access from administrative access&lt;/li&gt;
  &lt;li&gt;Grant narrowly scoped permissions to applications or automation&lt;/li&gt;
  &lt;li&gt;Avoid over-assigning built-in roles&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;However, Azure Communication Services behaves differently than many other Azure resource providers, and this often leads to confusion during role design.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-the-issue&quot;&gt;üîê The Issue&lt;/h2&gt;

&lt;p&gt;A customer attempted to create and assign a custom IAM role for an Azure Communication Services resource.&lt;/p&gt;

&lt;p&gt;The goal was to grant limited permissions for managing or interacting with ACS without assigning a broad built-in role.&lt;/p&gt;

&lt;p&gt;Despite the role being created successfully in Azure, it did not function as expected when assigned to users or service principals.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-the-root-cause&quot;&gt;üîç The Root Cause&lt;/h2&gt;

&lt;p&gt;Custom IAM roles are not supported for Azure Communication Services.&lt;/p&gt;

&lt;p&gt;While Azure allows you to define custom roles at a subscription or resource scope, ACS does not honor custom role definitions, even if the permissions appear valid.&lt;/p&gt;

&lt;p&gt;This means:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Custom roles may assign successfully&lt;/li&gt;
  &lt;li&gt;Role assignments appear correct in the portal&lt;/li&gt;
  &lt;li&gt;Access attempts still fail at runtime&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This is not a configuration issue or a customer mistake. It is a platform limitation.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-the-resolution&quot;&gt;‚úÖ The Resolution&lt;/h2&gt;

&lt;p&gt;To manage or interact with Azure Communication Services, you must use a predefined built-in role.&lt;/p&gt;

&lt;h3 id=&quot;-required-built-in-role&quot;&gt;‚úî Required Built-In Role&lt;/h3&gt;

&lt;p&gt;Communication and Email Service Owner&lt;/p&gt;

&lt;p&gt;This role provides the permissions required to:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Manage ACS resources&lt;/li&gt;
  &lt;li&gt;Access keys and endpoints&lt;/li&gt;
  &lt;li&gt;Configure calling, SMS, email, and related features&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;At this time, there is no supported alternative that allows partial or custom permission sets for ACS.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;Ô∏è-important-notes-about-acs-rbac&quot;&gt;‚ö†Ô∏è Important Notes About ACS RBAC&lt;/h2&gt;

&lt;p&gt;Here are a few important behaviors to be aware of when working with ACS permissions:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;ACS does not support custom RBAC roles&lt;/li&gt;
  &lt;li&gt;DataActions are not exposed or configurable for ACS&lt;/li&gt;
  &lt;li&gt;Least-privilege designs are limited to built-in roles only&lt;/li&gt;
  &lt;li&gt;Role assignments must be validated using real API calls, not just portal visibility&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This can be surprising if you‚Äôre used to other Azure services that fully support custom role definitions.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-design-guidance&quot;&gt;üß≠ Design Guidance&lt;/h2&gt;

&lt;p&gt;If you need separation of duties or reduced blast radius, consider these alternatives:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Use separate ACS resources per environment or workload&lt;/li&gt;
  &lt;li&gt;Assign the built-in role only to dedicated service principals&lt;/li&gt;
  &lt;li&gt;Scope access tightly at the resource level, not subscription-wide&lt;/li&gt;
  &lt;li&gt;Use Azure Monitor and diagnostics to audit usage instead of restricting permissions&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;While not ideal, these approaches align with the current ACS security model.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;-final-thoughts&quot;&gt;üß† Final Thoughts&lt;/h2&gt;

&lt;p&gt;Azure Communication Services has a powerful feature set, but its RBAC model is intentionally constrained today. Attempting to use custom IAM roles will lead to confusing access failures that are difficult to troubleshoot unless this limitation is known upfront.&lt;/p&gt;

&lt;p&gt;If you encounter authorization issues with ACS:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Verify the role is &lt;strong&gt;Communication and Email Service Owner&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Do not rely on custom role definitions&lt;/li&gt;
  &lt;li&gt;Validate access using real SDK or REST calls&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If this behavior changes in the future, it will require a platform update from the ACS product group.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/acs-custom-iam-roles-not-supported/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>January 20, 2026</pubDate>
        <link>https://blakedrumm.com/blog/acs-custom-iam-roles-not-supported/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/acs-custom-iam-roles-not-supported/</guid>
      </item>
    
      <item>
        <title>Outbound Calling with a Lightweight Console Tool - Azure Communication Services (ACS)</title>
        <postImage>/assets/img/posts/acs-outbound-calling-tool.png</postImage>
        <description>&lt;h2 id=&quot;bulb-introduction&quot;&gt;:bulb: Introduction&lt;/h2&gt;

&lt;p&gt;Azure Communication Services (ACS) provides powerful APIs for building telephony workflows ‚Äî from simple outbound calls to fully automated IVR systems. But when you‚Äôre validating a new ACS deployment, troubleshooting access keys, or checking if a purchased phone number is correctly configured, you often need something much simpler:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;A tool that can place a real outbound PSTN call on demand.&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;To streamline that process, I created a small &lt;strong&gt;C# console application&lt;/strong&gt; that uses the ACS Call Automation API to place a call from an ACS-owned phone number to any valid target phone number. This post provides an overview of how the tool works, why it exists, and what to know when using ACS programmatically for calling.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;telephone_receiver-why-build-a-tool-for-acs-outbound-calling&quot;&gt;:telephone_receiver: Why Build a Tool for ACS Outbound Calling?&lt;/h2&gt;

&lt;p&gt;When helping customers troubleshoot ACS calling issues, one of the most common challenges is isolating whether a problem is:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;a misconfigured ACS resource&lt;/li&gt;
  &lt;li&gt;an invalid or inactive phone number&lt;/li&gt;
  &lt;li&gt;a missing callback endpoint&lt;/li&gt;
  &lt;li&gt;incorrect API usage&lt;/li&gt;
  &lt;li&gt;version mismatch in the SDK&lt;/li&gt;
  &lt;li&gt;firewall or networking issues blocking callbacks&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;A lightweight console caller removes all other moving parts so you can focus on validating:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;‚úî The ACS resource is reachable&lt;/li&gt;
  &lt;li&gt;‚úî The access key is correct&lt;/li&gt;
  &lt;li&gt;‚úî The Call Automation API accepts your request&lt;/li&gt;
  &lt;li&gt;‚úî The ACS phone number is capable of PSTN outbound traffic&lt;/li&gt;
  &lt;li&gt;‚úî Call events are flowing to the configured callback URL (if applicable)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;It‚Äôs the ACS equivalent of &lt;strong&gt;‚Äúping‚Äù for telephony&lt;/strong&gt; ‚Äî quick, simple, and reliable.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;mag-understanding-acs-callautomation-behavior&quot;&gt;:mag: Understanding ACS CallAutomation Behavior&lt;/h2&gt;

&lt;p&gt;One important part of building this tool was understanding how ACS behaves across SDK versions. The &lt;strong&gt;CreateCall&lt;/strong&gt; API:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Does not provide real-time call status&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Does not block while waiting for the call to be answered&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Does not include a call state object in the response&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Instead, ACS gives you:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;CallConnectionId&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;These identifiers uniquely represent the server-side call object and can be used:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;to correlate logs&lt;/li&gt;
  &lt;li&gt;to track call events&lt;/li&gt;
  &lt;li&gt;inside Call Automation actions (hang up, play audio, etc.)&lt;/li&gt;
  &lt;li&gt;for troubleshooting in Azure Monitor or diagnostics views&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Any real-time events ‚Äî like CallConnected or CallDisconnected ‚Äî are always delivered asynchronously to your configured &lt;strong&gt;callback URL&lt;/strong&gt;, not through the tool itself.&lt;/p&gt;

&lt;p&gt;This design is intentional and foundational to ACS at scale.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;gear-what-the-tool-does&quot;&gt;:gear: What the Tool Does&lt;/h2&gt;

&lt;p&gt;The console tool performs the following steps:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Accepts two command-line parameters&lt;/strong&gt;:
    &lt;ul&gt;
      &lt;li&gt;ACS source phone number&lt;/li&gt;
      &lt;li&gt;Target PSTN phone number&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Creates a CallAutomationClient&lt;/strong&gt; using your ACS connection string.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Builds a CallInvite&lt;/strong&gt; using the source and target numbers.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Sends a CreateCall request&lt;/strong&gt; to the ACS endpoint.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Prints the CallConnectionId and ServerCallId&lt;/strong&gt; returned by ACS.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Exits immediately&lt;/strong&gt; ‚Äî because ACS handles all call progression asynchronously.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;what-its-ideal-for&quot;&gt;What It‚Äôs Ideal For&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Verifying ACS outbound calling works&lt;/li&gt;
  &lt;li&gt;Testing newly purchased phone numbers&lt;/li&gt;
  &lt;li&gt;Troubleshooting 401/403/BadRequest failures&lt;/li&gt;
  &lt;li&gt;Ensuring your ACS access key is correct&lt;/li&gt;
  &lt;li&gt;Validating resource deployment issues&lt;/li&gt;
  &lt;li&gt;Proving connectivity before building more complex automation&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;what-its-not-designed-for&quot;&gt;What It‚Äôs &lt;em&gt;Not&lt;/em&gt; Designed For&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;Monitoring call state in real-time&lt;/li&gt;
  &lt;li&gt;Handling media, DTMF, or recording&lt;/li&gt;
  &lt;li&gt;Complete IVR or call-flow logic&lt;/li&gt;
  &lt;li&gt;Replacing full Call Automation workflows&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;This tool is intentionally focused and minimal.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;electric_plug-callback-url-requirements&quot;&gt;:electric_plug: Callback URL Requirements&lt;/h2&gt;

&lt;p&gt;ACS requires a &lt;strong&gt;public callback endpoint&lt;/strong&gt; for call events. This is used to deliver:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;CallConnected&lt;/li&gt;
  &lt;li&gt;ParticipantsUpdated&lt;/li&gt;
  &lt;li&gt;CallDisconnected&lt;/li&gt;
  &lt;li&gt;Media events&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Even if you aren‚Äôt using callbacks yet, the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;callbackUri&lt;/code&gt; must be:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;a valid URI&lt;/li&gt;
  &lt;li&gt;publicly accessible&lt;/li&gt;
  &lt;li&gt;HTTPS recommended&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If you‚Äôre just validating call initiation, you can temporarily specify a placeholder endpoint.&lt;br /&gt;
For full automation, you‚Äôll want a real listener (Azure Functions, App Service, Ngrok, etc.).&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;warning-common-issues-when-testing-acs-calls&quot;&gt;:warning: Common Issues When Testing ACS Calls&lt;/h2&gt;

&lt;p&gt;Here are some real-world issues I‚Äôve seen while helping customers:&lt;/p&gt;

&lt;h3 id=&quot;-401-unauthorized&quot;&gt;‚ùå 401 Unauthorized&lt;/h3&gt;
&lt;p&gt;Typically caused by:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Incorrect access key&lt;/li&gt;
  &lt;li&gt;Expired regenerated key not updated in code&lt;/li&gt;
  &lt;li&gt;Wrong endpoint region&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;-403-forbidden&quot;&gt;‚ùå 403 Forbidden&lt;/h3&gt;
&lt;p&gt;Usually means:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The ACS phone number is not enabled for PSTN&lt;/li&gt;
  &lt;li&gt;Phone number is missing from the resource&lt;/li&gt;
  &lt;li&gt;You‚Äôre calling a restricted destination&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;-call-never-arrives&quot;&gt;‚ùå Call never arrives&lt;/h3&gt;
&lt;p&gt;Often due to:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Incorrect E.164 formatting (ACS is strict)&lt;/li&gt;
  &lt;li&gt;Callback endpoint unreachable&lt;/li&gt;
  &lt;li&gt;Resource not provisioned for PSTN&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;The console tool makes diagnosing these issues much easier ‚Äî if an outbound call fails, the response error tells you &lt;em&gt;why&lt;/em&gt;.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;floppy_disk-download-the-tool&quot;&gt;:floppy_disk: Download the Tool&lt;/h2&gt;

&lt;p&gt;You can download the tool or review the source code here:&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;üîó &lt;strong&gt;Download the ACS Outbound Calling Tool Executable&lt;/strong&gt;&lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/ACS-CallExample-Console-Executable.zip&quot;&gt;https://files.blakedrumm.com/ACS-CallExample-Console-Executable.zip&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;üîó &lt;strong&gt;Source Code Repository&lt;/strong&gt;&lt;br /&gt;
&lt;a href=&quot;https://github.com/blakedrumm/ACS-CallExample-Console&quot;&gt;https://github.com/blakedrumm/ACS-CallExample-Console&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Feel free to fork it, extend it, or incorporate it into your own automation workflows.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;speech_balloon-final-thoughts&quot;&gt;:speech_balloon: Final Thoughts&lt;/h2&gt;

&lt;p&gt;Azure Communication Services is extremely powerful once you understand its event-driven architecture. Tools like this console caller make it easier to validate your environment, test scenarios quickly, and remove uncertainty during deployments.&lt;/p&gt;

&lt;p&gt;If you‚Äôre working with ACS and need help diagnosing issues or extending call workflows, feel free to reach out ‚Äî I‚Äôm always happy to help troubleshoot or share lessons learned.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/acs-outbound-calling-tool/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>December 5, 2025</pubDate>
        <link>https://blakedrumm.com/blog/acs-outbound-calling-tool/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/acs-outbound-calling-tool/</guid>
      </item>
    
      <item>
        <title>Cleaning Orphaned WindowsPatchExtension Status Files - Azure Update Manager</title>
        <postImage>/assets/img/posts/windows-patch-extension-status-cleanup.png</postImage>
        <description>&lt;h2 id=&quot;bulb-introduction&quot;&gt;:bulb: Introduction&lt;/h2&gt;

&lt;p&gt;While helping customers troubleshoot patching issues with &lt;strong&gt;Azure Update Manager&lt;/strong&gt;, I ran into a recurring problem‚Äîleftover &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.status&lt;/code&gt; files from the &lt;strong&gt;WindowsPatchExtension&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;These orphaned files can confuse log analysis and clutter VMs over time. This blog post explains how they get there, why they matter, and how to clean them up using a simple PowerShell script.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;mag-the-problem--orphaned-status-files&quot;&gt;:mag: The Problem ‚Äî Orphaned &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.status&lt;/code&gt; Files&lt;/h2&gt;

&lt;p&gt;When the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;WindowsPatchExtension&lt;/code&gt; runs, it generates &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.settings&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.status&lt;/code&gt; files in the following directories:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Settings Path&lt;/strong&gt;&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\Packages\Plugins\Microsoft.CPlat.Core.WindowsPatchExtension\&amp;lt;version&amp;gt;\RuntimeSettings&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Status Path&lt;/strong&gt;&lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\Packages\Plugins\Microsoft.CPlat.Core.WindowsPatchExtension\&amp;lt;version&amp;gt;\status&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Under normal conditions, these files are created and removed together. But if patching is interrupted, retried, or a new version of the extension is installed, some &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.status&lt;/code&gt; files may remain‚Äîeven if they no longer correspond to a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.settings&lt;/code&gt; file.&lt;/p&gt;

&lt;h3 id=&quot;warning-real-world-scenario&quot;&gt;:warning: Real-World Scenario&lt;/h3&gt;

&lt;p&gt;In a recent case, the customer deployed VMs from a &lt;strong&gt;custom image&lt;/strong&gt; that already had the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;WindowsPatchExtension&lt;/code&gt; installed. The image unknowingly &lt;strong&gt;included stale &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.status&lt;/code&gt; files&lt;/strong&gt;, which then propagated to every new VM built from that image.&lt;/p&gt;

&lt;p&gt;This mismatch between &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.settings&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.status&lt;/code&gt; files caused confusion during patch runs, where the extension logs no longer lined up with the expected state.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;thinking-why-this-matters&quot;&gt;:thinking: Why This Matters&lt;/h2&gt;

&lt;p&gt;These orphaned &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.status&lt;/code&gt; files:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;‚ùå Do &lt;strong&gt;not&lt;/strong&gt; represent the current patch status&lt;/li&gt;
  &lt;li&gt;ü§î Can cause confusion when checking plugin behavior&lt;/li&gt;
  &lt;li&gt;üßπ Accumulate over time and clutter the file system&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;While they don‚Äôt break the extension‚Äôs functionality, they make troubleshooting harder‚Äîespecially when using automation or analyzing logs across many VMs.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;wrench-the-fix--compare-and-clean-with-powershell&quot;&gt;:wrench: The Fix ‚Äî Compare and Clean with PowerShell&lt;/h2&gt;

&lt;p&gt;To resolve this, I wrote a &lt;a href=&quot;https://gist.github.com/blakedrumm/62a572ddc786963136641b2c52894211&quot; target=&quot;_blank&quot;&gt;PowerShell script&lt;/a&gt; that compares &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.status&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.settings&lt;/code&gt; file indexes and deletes any &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.status&lt;/code&gt; files that don‚Äôt match.&lt;/p&gt;

&lt;h3 id=&quot;what-it-does&quot;&gt;What It Does&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;Finds the highest-index &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.settings&lt;/code&gt; file in the RuntimeSettings folder&lt;/li&gt;
  &lt;li&gt;Deletes any &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.status&lt;/code&gt; files with a &lt;strong&gt;higher index&lt;/strong&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;This keeps only the relevant &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.status&lt;/code&gt; files and ensures consistency.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;floppy_disk-how-to-use-the-script&quot;&gt;:floppy_disk: How to Use the Script&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;üîó &lt;strong&gt;Script Link&lt;/strong&gt;: &lt;a href=&quot;https://gist.github.com/blakedrumm/62a572ddc786963136641b2c52894211&quot; target=&quot;_blank&quot;&gt;PowerShell Gist - Cleanup Status Files&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Disclaimer&lt;/strong&gt;: Always test in a development environment before applying to production.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;1-save-the-script-locally&quot;&gt;1. Save the Script Locally&lt;/h3&gt;

&lt;p&gt;Save the content of the Gist above as a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.ps1&lt;/code&gt; file on your VM:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Remove-UpdateManagerOldStatusFiles.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;2-run-powershell-as-administrator&quot;&gt;2. Run PowerShell as Administrator&lt;/h3&gt;

&lt;p&gt;Because the script accesses protected directories, you must run it with admin rights.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Right-click &lt;strong&gt;PowerShell&lt;/strong&gt; ‚Üí &lt;strong&gt;Run as Administrator&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;3-execute-the-script&quot;&gt;3. Execute the Script&lt;/h3&gt;

&lt;p&gt;Navigate to the script location and run:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Remove-UpdateManagerOldStatusFiles.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The script will:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Detect the latest version of the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;WindowsPatchExtension&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Find the highest &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.settings&lt;/code&gt; file&lt;/li&gt;
  &lt;li&gt;Remove &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.status&lt;/code&gt; files with a &lt;strong&gt;higher index&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You‚Äôll get output confirming what (if anything) was removed.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;speech_balloon-share-your-experience&quot;&gt;:speech_balloon: Share Your Experience&lt;/h2&gt;

&lt;p&gt;Have you encountered similar cleanup scenarios with the WindowsPatchExtension or Update Manager?&lt;br /&gt;
Did you solve it a different way?&lt;/p&gt;

&lt;p&gt;Let me know! I‚Äôm always interested in how others handle extension state management at scale.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/azure-update-manager-status-cleanup/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>June 18, 2025</pubDate>
        <link>https://blakedrumm.com/blog/azure-update-manager-status-cleanup/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/azure-update-manager-status-cleanup/</guid>
      </item>
    
      <item>
        <title>Setup OpenWeb UI AI Webpage - Azure Container Apps</title>
        <postImage>/assets/img/posts/openweb-ui-logged-in.png</postImage>
        <description>&lt;h2 id=&quot;bulb-introduction&quot;&gt;:bulb: Introduction&lt;/h2&gt;

&lt;p&gt;Deploying OpenWeb UI on Azure allows you to host an interactive AI webpage. However, due to OpenWeb UI‚Äôs architecture‚Äîwhere both the frontend and backend are housed in a single container‚Äîscalability is limited. This guide will walk you through setting up OpenWeb UI using Azure Container Apps, discuss its limitations regarding scaling, and compare this solution to using Kubernetes.&lt;/p&gt;

&lt;h2 id=&quot;hammer-prerequisites&quot;&gt;:hammer: Prerequisites&lt;/h2&gt;

&lt;p&gt;Before starting, make sure you have the following:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Azure Account&lt;/strong&gt;: An active Azure subscription with permissions to create new resources.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;OpenWeb UI Container Image&lt;/strong&gt;: The container image from GitHub Container Registry (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ghcr.io/open-webui/open-webui:main&lt;/code&gt;).&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;OpenAI API Key&lt;/strong&gt;: [Optional] In order to utilize OpenAI in OpenWeb UI, you will need an OpenAI API Key. &lt;a href=&quot;https://platform.openai.com/api-keys&quot;&gt;https://platform.openai.com/api-keys&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;rocket-setting-up-openweb-ui-with-azure-container-apps&quot;&gt;:rocket: Setting Up OpenWeb UI with Azure Container Apps&lt;/h2&gt;

&lt;h3 id=&quot;step-by-step-guide-portal&quot;&gt;Step-by-Step Guide (Portal)&lt;/h3&gt;

&lt;h4 id=&quot;1-access-the-azure-portal&quot;&gt;1. &lt;strong&gt;Access the Azure Portal&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Log in to &lt;a href=&quot;https://portal.azure.com/&quot; target=&quot;_blank&quot;&gt;Azure Portal&lt;/a&gt;.&lt;/p&gt;

&lt;h4 id=&quot;2-create-a-resource-group&quot;&gt;2. &lt;strong&gt;Create a Resource Group&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Search for &lt;strong&gt;Resource groups&lt;/strong&gt; and create a new one named &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OpenWebUI-ContainerApp-RG&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Select a region like &lt;strong&gt;East US&lt;/strong&gt; be sure you are consistent with the region through this guide.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;3-create-a-storage-account&quot;&gt;3. &lt;strong&gt;Create a Storage Account&lt;/strong&gt;&lt;/h4&gt;
&lt;ul&gt;
  &lt;li&gt;Search for &lt;strong&gt;Storage accounts&lt;/strong&gt;, create a new one (For example: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;openwebuistorageaccount&lt;/code&gt; (lowercase required)) in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OpenWebUI-ContainerApp-RG&lt;/code&gt; resource group.
    &lt;ul&gt;
      &lt;li&gt;
        &lt;p&gt;During creation of the Storage account there are configuration changes required:&lt;/p&gt;

        &lt;ul&gt;
          &lt;li&gt;&lt;strong&gt;&lt;u&gt;Basics tab&lt;/u&gt;&lt;/strong&gt;
            &lt;ol&gt;
              &lt;li&gt;&lt;strong&gt;Primary service&lt;/strong&gt; select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Azure Files&lt;/code&gt;.&lt;/li&gt;
              &lt;li&gt;&lt;strong&gt;Performance&lt;/strong&gt; you can set &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Standard&lt;/code&gt; unless you have a specific need for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Premium&lt;/code&gt;.&lt;/li&gt;
              &lt;li&gt;&lt;strong&gt;Redundancy&lt;/strong&gt; you can set &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Locally-redundant storage (LRS)&lt;/code&gt; unless you have a specific need for the other options.&lt;/li&gt;
            &lt;/ol&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;strong&gt;&lt;u&gt;Networking tab&lt;/u&gt;&lt;/strong&gt;
            &lt;ol&gt;
              &lt;li&gt;&lt;strong&gt;Network access&lt;/strong&gt; select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Enable public access from all networks&lt;/code&gt; (default option) unless you have a specific need for the other options (the other options require additional configuration which will not be covered in this guide).&lt;/li&gt;
            &lt;/ol&gt;
          &lt;/li&gt;
          &lt;li&gt;&lt;strong&gt;&lt;u&gt;Other tabs&lt;/u&gt;&lt;/strong&gt;
            &lt;ol&gt;
              &lt;li&gt;Leave the defaults and create the storage account.&lt;/li&gt;
            &lt;/ol&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;&lt;em&gt;After&lt;/em&gt; the storage account is created there are additional steps required:&lt;/p&gt;
        &lt;ol&gt;
          &lt;li&gt;Search for &lt;strong&gt;Storage accounts&lt;/strong&gt;. Locate the storage account (&lt;strong&gt;&lt;em&gt;openwebuistorageaccount&lt;/em&gt;&lt;/strong&gt;) and select it.&lt;/li&gt;
          &lt;li&gt;Expand &lt;strong&gt;Data storage&lt;/strong&gt; and go to the &lt;strong&gt;File shares&lt;/strong&gt; blade. Add a new file share.
            &lt;ol&gt;
              &lt;li&gt;&lt;strong&gt;Name&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ai-storage-file-share&lt;/code&gt;.&lt;/li&gt;
              &lt;li&gt;For &lt;strong&gt;Access tier&lt;/strong&gt; select &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Transaction optimized&lt;/code&gt;.&lt;/li&gt;
              &lt;li&gt;On the &lt;strong&gt;Backup&lt;/strong&gt; tab I disable backup, as I do not want to incur any additional charges. But if you can afford it, keep it enabled to keep your files safe in the event of data loss.&lt;/li&gt;
              &lt;li&gt;Create the file share.&lt;/li&gt;
            &lt;/ol&gt;
          &lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;4-create-a-container-app&quot;&gt;4. &lt;strong&gt;Create a Container App&lt;/strong&gt;&lt;/h4&gt;
&lt;p&gt;Search for &lt;strong&gt;Container Apps&lt;/strong&gt;, create a new container app.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;&lt;u&gt;Basics tab&lt;/u&gt;&lt;/strong&gt;
    &lt;ol&gt;
      &lt;li&gt;&lt;strong&gt;Container app name&lt;/strong&gt; set the name to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ai-openwebcontainer&lt;/code&gt;.&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Deployment source&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Container image&lt;/code&gt;.&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Region&lt;/strong&gt; set &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;East US&lt;/code&gt;.&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Container Apps Environment&lt;/strong&gt; create a new container apps environment. There is additional configuration needed for the container app environment:
        &lt;ol&gt;
          &lt;li&gt;Set the &lt;strong&gt;Environment Name&lt;/strong&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OpenWebContainerEnvironment&lt;/code&gt;.&lt;/li&gt;
          &lt;li&gt;Leave the rest of the options as the defaults.&lt;/li&gt;
          &lt;li&gt;
            &lt;p&gt;Create the Container Apps Environment.&lt;/p&gt;

            &lt;p&gt;&lt;img src=&quot;/assets/img/posts/create-container-app-basics-tab-filled-out.png&quot; alt=&quot;Example of how to setup container app basics tab&quot; /&gt;&lt;/p&gt;
          &lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Proceed to &lt;strong&gt;Next: Container&lt;/strong&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;u&gt;Container tab&lt;/u&gt;&lt;/strong&gt;
    &lt;ol&gt;
      &lt;li&gt;&lt;strong&gt;Image source&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Docker Hub or other registries&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Image type&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Public&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Registry login server&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ghcr.io&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Image and tag&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;open-webui/open-webui:main&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;CPU and Memory&lt;/strong&gt; set to what you are comfortable with, I set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2 CPU cores, 4 Gi memory&lt;/code&gt; but this can be lower if needed.&lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;Leave the rest of the options as the defaults (we will configure the environmental variables in a few steps).&lt;/p&gt;

        &lt;p&gt;&lt;img src=&quot;/assets/img/posts/create-container-app-container-tab-filled-out.png&quot; alt=&quot;Example of how to setup container app container tab - picture 1&quot; /&gt;&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Proceed to &lt;strong&gt;Next: Bindings&lt;/strong&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;u&gt;Bindings tab&lt;/u&gt;&lt;/strong&gt;
    &lt;ol&gt;
      &lt;li&gt;Nothing needs to be modified on this tab.&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Proceed to &lt;strong&gt;Next: Ingress&lt;/strong&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;u&gt;Ingress tab&lt;/u&gt;&lt;/strong&gt;
    &lt;ol&gt;
      &lt;li&gt;Toggle &lt;strong&gt;Ingress&lt;/strong&gt; to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Enabled&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Ingress traffic&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Accept traffic from anywhere: Applies if &apos;internal&apos; setting is set to false on the Container Apps environment&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Ingress Type&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HTTP&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Target port&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;8080&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;Leave the rest of the options as the defaults.&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;Select &lt;strong&gt;Review + create&lt;/strong&gt; to create the Container App.&lt;/li&gt;
&lt;/ul&gt;

&lt;h4 id=&quot;5-gather-data-from-storage-accounts&quot;&gt;5. &lt;strong&gt;Gather data from Storage Accounts&lt;/strong&gt;&lt;/h4&gt;
&lt;ol&gt;
  &lt;li&gt;Search for &lt;strong&gt;Storage accounts&lt;/strong&gt;, select the storage account we created &lt;strong&gt;openwebuistorageaccount&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Expand &lt;strong&gt;Security + networking&lt;/strong&gt; and select &lt;strong&gt;Access keys&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Click show on one of the 2 keys listed, &lt;strong&gt;copy one&lt;/strong&gt; for us to use in the next step.&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;6-link-azure-files-to-container-apps-environment&quot;&gt;6. &lt;strong&gt;Link Azure Files to Container Apps Environment&lt;/strong&gt;&lt;/h4&gt;
&lt;ol&gt;
  &lt;li&gt;Search for &lt;strong&gt;Container Apps Environments&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Expand &lt;strong&gt;Settings&lt;/strong&gt;, then select &lt;strong&gt;Azure Files&lt;/strong&gt;, we are going to Add a new file share to the container apps environment.
    &lt;ol&gt;
      &lt;li&gt;&lt;strong&gt;Name&lt;/strong&gt; set a name (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;openwebcontainerfileshare&lt;/code&gt;) for the file share in the container apps environment.
        &lt;ol&gt;
          &lt;li&gt;&lt;strong&gt;Storage account name&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;openwebuistorageaccount&lt;/code&gt;&lt;/li&gt;
          &lt;li&gt;&lt;strong&gt;Storage account key&lt;/strong&gt; set to the access key we copied in the previous step.&lt;/li&gt;
          &lt;li&gt;&lt;strong&gt;File Share&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ai-storage-file-share&lt;/code&gt;&lt;/li&gt;
          &lt;li&gt;&lt;strong&gt;Access mode&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Read/Write&lt;/code&gt;&lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;7-mount-azure-file-share-to-container-app&quot;&gt;7. &lt;strong&gt;Mount Azure File Share to Container App&lt;/strong&gt;&lt;/h4&gt;
&lt;ol&gt;
  &lt;li&gt;Search for &lt;strong&gt;Container Apps&lt;/strong&gt;, select the container app we created &lt;strong&gt;ai-openwebcontainer&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Expand &lt;strong&gt;Application&lt;/strong&gt;, select &lt;strong&gt;Containers&lt;/strong&gt;. Select &lt;strong&gt;Edit and deploy&lt;/strong&gt;.
    &lt;ul&gt;
      &lt;li&gt;First, you will need to select the Volumes tab.&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;&lt;u&gt;Volumes tab&lt;/u&gt;&lt;/strong&gt;
        &lt;ol&gt;
          &lt;li&gt;Select &lt;strong&gt;+ Add&lt;/strong&gt;&lt;/li&gt;
          &lt;li&gt;&lt;strong&gt;Volume type&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Azure file volume&lt;/code&gt;&lt;/li&gt;
          &lt;li&gt;&lt;strong&gt;Name&lt;/strong&gt; set to whatever name you would like (I used &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ai-openweb-volume&lt;/code&gt;).&lt;/li&gt;
          &lt;li&gt;&lt;strong&gt;File share&lt;/strong&gt; select the file share we created &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;openwebcontainerfileshare&lt;/code&gt;&lt;/li&gt;
          &lt;li&gt;&lt;strong&gt;Mount options&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nobrl&lt;/code&gt; &lt;a href=&quot;https://learn.microsoft.com/troubleshoot/azure/azure-kubernetes/storage/mountoptions-settings-azure-files#other-useful-settings&quot; target=&quot;_blank&quot;&gt;more information&lt;/a&gt;&lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
      &lt;li&gt;Now select the &lt;strong&gt;Container&lt;/strong&gt; tab.&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;&lt;u&gt;Container tab&lt;/u&gt;&lt;/strong&gt;
        &lt;ol&gt;
          &lt;li&gt;&lt;strong&gt;Name / suffix&lt;/strong&gt; set the name of the revision to something you will recognize. (I used &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;live&lt;/code&gt;)&lt;/li&gt;
          &lt;li&gt;Click on the container image &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ai-openwebcontainer&lt;/code&gt; shown in the Container Image table
&lt;img src=&quot;/assets/img/posts/edit-container-app-revision-container-image-select.png&quot; alt=&quot;Where to click, to configure the container image&quot; /&gt;&lt;/li&gt;
          &lt;li&gt;The &lt;strong&gt;Edit a container&lt;/strong&gt; menu will open.
            &lt;ol&gt;
              &lt;li&gt;In the &lt;strong&gt;Basics&lt;/strong&gt; tab you can add your Environment variables at the bottom of the tab. Here are all the environmental variables that OpenWeb UI Supports: &lt;a href=&quot;https://docs.openwebui.com/getting-started/env-configuration/&quot; target=&quot;_blank&quot;&gt;https://docs.openwebui.com/getting-started/env-configuration/&lt;/a&gt;
                &lt;ul&gt;
                  &lt;li&gt;Add a new environmental variable &lt;strong&gt;&lt;em&gt;(keep in mind this method will expose your API key in plain text. If you want security you need to save it as a secret)&lt;/em&gt;&lt;/strong&gt;:
                    &lt;ul&gt;
                      &lt;li&gt;&lt;strong&gt;Name:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;OPENAI_API_KEY&lt;/code&gt;&lt;/li&gt;
                      &lt;li&gt;&lt;strong&gt;Source:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Manual entry&lt;/code&gt;&lt;/li&gt;
                      &lt;li&gt;&lt;strong&gt;Value:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;OpenAI-API-Key&amp;gt;&lt;/code&gt; &lt;a href=&quot;https://platform.openai.com/api-keys&quot; target=&quot;_blank&quot;&gt;https://platform.openai.com/api-keys&lt;/a&gt;&lt;/li&gt;
                    &lt;/ul&gt;
                  &lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
              &lt;li&gt;Select the &lt;strong&gt;Volume mounts&lt;/strong&gt; tab.&lt;/li&gt;
              &lt;li&gt;Select the dropdown under volume name and select the Azure file volume that we created in the Volumes tab.
                &lt;ul&gt;
                  &lt;li&gt;&lt;strong&gt;Volume name:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ai-openweb-volume&lt;/code&gt;&lt;/li&gt;
                  &lt;li&gt;&lt;strong&gt;Mount path:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/app/backend/data&lt;/code&gt;&lt;/li&gt;
                  &lt;li&gt;&lt;strong&gt;Sub path (optional):&lt;/strong&gt; Leave this empty&lt;/li&gt;
                &lt;/ul&gt;
              &lt;/li&gt;
              &lt;li&gt;Click save&lt;/li&gt;
            &lt;/ol&gt;
          &lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;Lastly, you will need to select the Scale tab.&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;&lt;u&gt;Scale tab&lt;/u&gt;&lt;/strong&gt;
        &lt;ol&gt;
          &lt;li&gt;&lt;strong&gt;Min replicas&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt; (If you want the instance to spin up on demand and deallocate when not in use, set this to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt; instead. Personally, I prefer the application to remain running, so I don‚Äôt have to wait for Azure Container Apps to activate the container.)&lt;/li&gt;
          &lt;li&gt;&lt;strong&gt;Max replicas&lt;/strong&gt; set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt; (the max cannot be more than 1 due to design of Docker container for OpenWeb UI)&lt;/li&gt;
        &lt;/ol&gt;
      &lt;/li&gt;
      &lt;li&gt;Select &lt;strong&gt;Create&lt;/strong&gt; to create the revision.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;8-access-the-application&quot;&gt;8. &lt;strong&gt;Access the Application&lt;/strong&gt;:&lt;/h4&gt;
&lt;ol&gt;
  &lt;li&gt;In the &lt;strong&gt;Container App&lt;/strong&gt; view, expand &lt;strong&gt;Application&lt;/strong&gt; and select &lt;strong&gt;Revisions and replicas&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Click the Active revision that ends with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;live&lt;/code&gt; (or whatever you configured your revision name to)&lt;/li&gt;
  &lt;li&gt;In the &lt;strong&gt;Revision details&lt;/strong&gt; menu select the &lt;strong&gt;Revision URL&lt;/strong&gt; this is the published URL for your container app revision. (the main URL is in the &lt;strong&gt;Overview&lt;/strong&gt; blade of your container app. Its called the &lt;strong&gt;Application Url&lt;/strong&gt;.)&lt;/li&gt;
&lt;/ol&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;gear-scaling-limitations-of-openweb-ui&quot;&gt;:gear: Scaling Limitations of OpenWeb UI&lt;/h2&gt;

&lt;p&gt;Due to OpenWeb UI‚Äôs architecture, where both frontend and backend are housed in the same container, scaling the application horizontally (adding more replicas) is problematic. Here‚Äôs why:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Single Container Design&lt;/strong&gt;: The combined frontend and backend make it difficult to scale individual components like you would in a decoupled architecture.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Session Handling&lt;/strong&gt;: Without advanced session management, multiple instances of the backend can cause inconsistent behavior, as there‚Äôs no mechanism to manage session persistence across replicas.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Best Fit&lt;/strong&gt;: For now, deploying OpenWeb UI with &lt;strong&gt;1 replica&lt;/strong&gt; in &lt;strong&gt;Azure Container Apps&lt;/strong&gt; is the most efficient way to ensure stability.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;possible-solutions&quot;&gt;Possible Solutions&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Decoupling Services&lt;/strong&gt;: If you want to scale, consider splitting the frontend and backend into separate containers and using Kubernetes for scaling them independently.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Kubernetes Deployment&lt;/strong&gt;: Kubernetes can help manage scaling by separating components, introducing load balancing, and handling session persistence. However, this adds complexity and cost.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;moneybag-cost-effective-hosting-container-apps-vs-kubernetes&quot;&gt;:moneybag: Cost-Effective Hosting: Container Apps vs. Kubernetes&lt;/h2&gt;

&lt;p&gt;When comparing &lt;strong&gt;Azure Container Apps&lt;/strong&gt; and &lt;strong&gt;Azure Kubernetes Service (AKS)&lt;/strong&gt;, here‚Äôs what you need to know about cost-effectiveness:&lt;/p&gt;

&lt;h3 id=&quot;azure-container-apps&quot;&gt;Azure Container Apps&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Serverless Pricing&lt;/strong&gt;: You only pay for the CPU and memory your app uses. It‚Äôs cost-efficient for small to medium workloads and apps with unpredictable traffic.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Low Management Overhead&lt;/strong&gt;: Azure manages the underlying infrastructure, so there‚Äôs no need to worry about managing virtual machines (VMs), which reduces operational costs.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Best Use&lt;/strong&gt;: Ideal for apps like OpenWeb UI that don‚Äôt require complex scaling and benefit from Azure‚Äôs autoscaling features.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;azure-kubernetes-service-aks&quot;&gt;Azure Kubernetes Service (AKS)&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;VM-Based Pricing&lt;/strong&gt;: You pay for VMs even when your app is idle. Scaling adds complexity since you need to manage pods, nodes, and networking.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Scalability&lt;/strong&gt;: While AKS offers more flexibility in scaling, the cost is higher, especially for apps that don‚Äôt need continuous scalability.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Best Use&lt;/strong&gt;: Suitable for large-scale applications that need fine-grained control over scaling and architecture.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;strong&gt;Conclusion&lt;/strong&gt;: &lt;strong&gt;Azure Container Apps&lt;/strong&gt; is the more cost-effective solution for hosting OpenWeb UI due to its serverless pricing and minimal management requirements. AKS is better suited for complex, highly scalable applications, but it comes with a higher cost and management overhead.&lt;/p&gt;

&lt;h2 id=&quot;mag-conclusion&quot;&gt;:mag: Conclusion&lt;/h2&gt;

&lt;p&gt;In this guide, we deployed OpenWeb UI using Azure Container Apps and explored its scalability limitations. For most users, sticking with a single-instance deployment in Container Apps is the most cost-effective and stable approach. If scaling is essential, consider moving to the &lt;a href=&quot;https://docs.openwebui.com/getting-started/installation&quot; target=&quot;_blank&quot;&gt;Kubernetes-based solution&lt;/a&gt; where the frontend and backend can be decoupled.&lt;/p&gt;

&lt;h2 id=&quot;thought_balloon-feedback&quot;&gt;:thought_balloon: Feedback&lt;/h2&gt;

&lt;p&gt;Have you tried deploying OpenWeb UI on Azure? What‚Äôs your experience with its scaling capabilities? Share your insights in the comments below.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/azure-container-apps-openweb-ui/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>September 7, 2024</pubDate>
        <link>https://blakedrumm.com/blog/azure-container-apps-openweb-ui/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/azure-container-apps-openweb-ui/</guid>
      </item>
    
      <item>
        <title>PowerShell: SCOM&apos;s Best Friend - Insights from Scomathon 2024</title>
        <postImage>/assets/img/posts/scomathon-2024.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;

&lt;p&gt;At Scomathon 2024, I had the privilege of presenting on a topic that is near and dear to my heart: ‚ÄúPowerShell: SCOM‚Äôs Best Friend.‚Äù In this blog post, I‚Äôll be sharing the key takeaways from my presentation, along with some practical PowerShell scripts that can significantly enhance your SCOM environment. Whether you‚Äôre just starting with SCOM or are a seasoned professional, there‚Äôs something here for everyone.&lt;/p&gt;

&lt;p&gt;For those who couldn‚Äôt attend, you can watch my presentation here: &lt;a href=&quot;https://www.youtube.com/watch?v=ewcJpC0iFqY&quot;&gt;https://www.youtube.com/watch?v=ewcJpC0iFqY&lt;/a&gt;&lt;/p&gt;

&lt;iframe width=&quot;560&quot; height=&quot;315&quot; src=&quot;https://www.youtube.com/embed/ewcJpC0iFqY?si=FtH07844yFjErQEe&quot; title=&quot;YouTube video player&quot; frameborder=&quot;0&quot; allow=&quot;accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share&quot; referrerpolicy=&quot;strict-origin-when-cross-origin&quot; allowfullscreen=&quot;&quot;&gt;&lt;/iframe&gt;

&lt;h2 id=&quot;classical_building-why-powershell-for-scom&quot;&gt;:classical_building: Why PowerShell for SCOM?&lt;/h2&gt;

&lt;p&gt;PowerShell is a powerful scripting language that can automate and simplify many tasks within System Center Operations Manager (SCOM). From managing alerts and notifications to performing regular maintenance and configuration tasks, PowerShell can be your go-to tool for enhancing the efficiency and functionality of your SCOM environment.&lt;/p&gt;

&lt;h3 id=&quot;page_with_curl-key-benefits&quot;&gt;:page_with_curl: Key Benefits&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Automation:&lt;/strong&gt; Schedule and automate repetitive tasks to save time and reduce errors.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Flexibility:&lt;/strong&gt; Modify and extend scripts to meet your specific needs.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Integration:&lt;/strong&gt; Seamlessly integrate with other Windows services and applications.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;hammer_and_wrench-tools-and-techniques&quot;&gt;:hammer_and_wrench: Tools and Techniques&lt;/h2&gt;

&lt;p&gt;During the presentation, I covered a variety of tools and techniques that are particularly useful for SCOM administrators. Below are the links to the tools discussed. &lt;strong&gt;Please note that these scripts require compliance with the MIT license&lt;/strong&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;system-center-operations-manager-data-warehouse-grooming-tool&quot;&gt;System Center Operations Manager Data Warehouse Grooming Tool&lt;/h3&gt;

  &lt;p&gt;&lt;a href=&quot;/blog/scom-dw-grooming-tool&quot;&gt;Read more&lt;/a&gt;&lt;/p&gt;

  &lt;p&gt;This tool analyzes your Data Warehouse Grooming to see what is being stored and how much of your Data Warehouse is filled with the related data. It is available in multiple formats: MSI, EXE, or source PS1.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;scom-data-collector&quot;&gt;SCOM Data Collector&lt;/h3&gt;

  &lt;p&gt;&lt;a href=&quot;/blog/scom-data-collector&quot;&gt;Read more&lt;/a&gt;&lt;/p&gt;

  &lt;p&gt;With the SCOM Data Collector, you can collect useful data to analyze and troubleshoot your SCOM Environment. It‚Äôs an essential tool for any SCOM Admin who wants a holistic view of their configuration and setup.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;reconfigure-system-center-operations-manager-for-database-move-tool&quot;&gt;Reconfigure System Center Operations Manager for Database Move Tool&lt;/h3&gt;

  &lt;p&gt;&lt;a href=&quot;/blog/scom-db-move-tool&quot;&gt;Read more&lt;/a&gt;&lt;/p&gt;

  &lt;p&gt;This application aids in updating the configuration when migrating SCOM SQL Instances.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;remove-data-from-the-scom-database-instantly---the-powershell-way&quot;&gt;Remove Data from the SCOM Database Instantly - The PowerShell Way!&lt;/h3&gt;

  &lt;p&gt;&lt;a href=&quot;/blog/remove-data-from-scom-database/&quot;&gt;Read more&lt;/a&gt;&lt;/p&gt;

  &lt;p&gt;This guide allows for quick removal of specific data from the SCOM Database without needing SQL Server Management Studio.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;scom-certificate-checker-script&quot;&gt;SCOM Certificate Checker Script&lt;/h3&gt;

  &lt;p&gt;&lt;a href=&quot;/blog/scom-certificate-checker-script/&quot;&gt;Read more&lt;/a&gt;&lt;/p&gt;

  &lt;p&gt;Check the validity of SCOM Certificates on an Agent, Gateway, or Management Server.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;enforce-tls-12--tls-13-in-scom---the-powershell-way&quot;&gt;Enforce TLS 1.2 &amp;amp; TLS 1.3 in SCOM - The PowerShell Way!&lt;/h3&gt;

  &lt;p&gt;&lt;a href=&quot;/blog/enforce-tls-1-2-scom/&quot;&gt;Read more&lt;/a&gt;&lt;/p&gt;

  &lt;p&gt;Configure your SCOM Environment for a more secure configuration with TLS 1.2 and TLS 1.3.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;star-best-practices&quot;&gt;:star: Best Practices&lt;/h2&gt;

&lt;p&gt;Here are some best practices to keep in mind when using PowerShell with SCOM:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Test Scripts:&lt;/strong&gt; Always test scripts in a non-production environment before deploying them live.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Error Handling:&lt;/strong&gt; Implement robust error handling to manage exceptions and failures gracefully.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Documentation:&lt;/strong&gt; Keep your scripts well-documented to ensure they are understandable and maintainable.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;rocket-conclusion&quot;&gt;:rocket: Conclusion&lt;/h2&gt;

&lt;p&gt;PowerShell truly is SCOM‚Äôs best friend, offering unparalleled flexibility and control. By leveraging the tools and techniques discussed in my Scomathon 2024 presentation, you can enhance your SCOM environment, automate tedious tasks, and focus on what truly matters‚Äîoptimizing your IT operations.&lt;/p&gt;

&lt;h2 id=&quot;link-additional-resources&quot;&gt;:link: Additional Resources&lt;/h2&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.microsoft.com/powershell/&quot;&gt;Official PowerShell Documentation&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://docs.microsoft.com/system-center/scom/&quot;&gt;System Center Operations Manager Documentation&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Leave some feedback if this helped you! :v:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scomathon-2024-presentation/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>June 18, 2024</pubDate>
        <link>https://blakedrumm.com/blog/scomathon-2024-presentation/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scomathon-2024-presentation/</guid>
      </item>
    
      <item>
        <title>Resolving Azure Maintenance Configuration Authorization Errors - Azure Update Manager</title>
        <postImage>/assets/img/posts/azure-authorization-error.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;

&lt;p&gt;While working with Azure, I encountered an authorization error while attempting to create a maintenance configuration. This post discusses the error, its implications, and how to resolve it using a custom role.&lt;/p&gt;

&lt;h2 id=&quot;x-error-text&quot;&gt;:x: Error text&lt;/h2&gt;

&lt;p&gt;While creating a maintenance configuration, I encountered the following error:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;span style=&quot;color:yellow&quot;&gt;The client ‚Äòuser@contoso.com‚Äô&lt;/span&gt; with object id ‚Äò8b4fd821-05b6-4938-9949-18782893c5ed‚Äô &lt;span style=&quot;color:yellow&quot;&gt;does not have authorization to perform action ‚ÄòMicrosoft.Resources/deployments/validate/action‚Äô&lt;/span&gt; over scope ‚Äò/subscriptions/a1b2c3d4-5e6f-7g8h-9i0j-1k2l3m4n5o6p/resourceGroups/DeleteThisResourceGroup/providers/Microsoft.Resources/deployments/TestConfiguration_1715820611290‚Äô or the scope is invalid. If access was recently granted, please refresh your credentials. (Code: AuthorizationFailed)&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This error message indicates a lack of permissions necessary to perform specific actions within the Azure portal.&lt;/p&gt;

&lt;h2 id=&quot;gear-solution&quot;&gt;:gear: Solution&lt;/h2&gt;

&lt;p&gt;To address this error we will need to create a custom role that specifically includes the necessary permissions for managing maintenance configurations and validating deployments.&lt;/p&gt;

&lt;h2 id=&quot;arrow_down-how-to-get-it&quot;&gt;:arrow_down: How to get it&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;GitHub Gist:&lt;/strong&gt; &lt;a href=&quot;https://gist.github.com/blakedrumm/d94fe65970bbf5d4c56d471e5f4024a2&quot;&gt;Create-MaintenanceConfigManagerRole.ps1&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I developed a PowerShell script that creates a custom role to grant a user the necessary permissions for managing Maintenance Configurations within a specific Resource Group.&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Create-MaintenanceConfigManagerRole.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Script to create a custom role for managing Azure Maintenance Configurations&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Author: Blake Drumm (blakedrumm@microsoft.com)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Website: https://blakedrumm.com/blog/resolve-azure-maintenance-configuration-error/&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Date created: May 15th, 2024&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Define custom variables&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$subscriptionId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;a1b2c3d4-5e6f-7g8h-9i0j-1k2l3m4n5o6p&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$resourceGroupName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ResourceGroupName&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRoleName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Maintenance Configuration Manager - Resource Group: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$resourceGroupName&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$userPrincipalName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;user@contoso.com&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Define the custom role as a JSON string with the subscription ID and resource group name directly replaced&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRoleJson&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;@&quot;
{
    &quot;Name&quot;: &quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRoleName&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;,
    &quot;IsCustom&quot;: true,
    &quot;Description&quot;: &quot;Allows management of maintenance configurations, validate and write deployments, read and write virtual machines, and write configuration assignments.&quot;,
    &quot;Actions&quot;: [
        &quot;Microsoft.Maintenance/maintenanceConfigurations/read&quot;,
        &quot;Microsoft.Maintenance/maintenanceConfigurations/write&quot;,
        &quot;Microsoft.Maintenance/maintenanceConfigurations/delete&quot;,
        &quot;Microsoft.Resources/deployments/validate/action&quot;,
        &quot;Microsoft.Resources/deployments/write&quot;,
        &quot;Microsoft.Maintenance/configurationAssignments/write&quot;,
        &quot;Microsoft.Compute/virtualMachines/read&quot;,
        &quot;Microsoft.Compute/virtualMachines/write&quot;
    ],
    &quot;NotActions&quot;: [],
    &quot;AssignableScopes&quot;: [
        &quot;/subscriptions/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$subscriptionId&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;/resourceGroups/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$resourceGroupName&lt;/span&gt;&lt;span class=&quot;sh&quot;&gt;&quot;
    ]
}
&quot;@&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Convert the JSON string to a PowerShell object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRoleJson&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConvertFrom-Json&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Create the custom role&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-AzRoleDefinition&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Role&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Define the scope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$scope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/subscriptions/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$subscriptionId&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/resourceGroups/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$resourceGroupName&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Assign the custom role to the user&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-AzRoleAssignment&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-RoleDefinitionName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRoleName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserPrincipalName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$userPrincipalName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Scope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$scope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;&amp;lt;#
    Copyright (c) Microsoft Corporation. MIT License
    
    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the &quot;Software&quot;), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:
    
    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.
    
    THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
    CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
#&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;bulb-how-to-use-it&quot;&gt;:bulb: How to use it&lt;/h2&gt;
&lt;p&gt;To implement this solution:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Modify the script&lt;/strong&gt; with your specific details, including subscription ID, resource group name, and user principal name.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Execute the script&lt;/strong&gt; in your PowerShell environment to create the custom role and assign it.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Verify the permissions&lt;/strong&gt; are correctly applied by attempting to create a Maintenance Configuration again.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;speech_balloon-conclusion&quot;&gt;:speech_balloon: Conclusion&lt;/h2&gt;
&lt;p&gt;By understanding and addressing Azure permission errors through custom role creation, administrators can ensure smoother operation, enhance security, and reduce manual workload. Feel free to modify the script to fit your specific needs and share your feedback on how it worked for you! :v:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/resolve-azure-maintenance-configuration-error/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>May 15, 2024</pubDate>
        <link>https://blakedrumm.com/blog/resolve-azure-maintenance-configuration-error/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/resolve-azure-maintenance-configuration-error/</guid>
      </item>
    
      <item>
        <title>Automated Azure Role Assignment Reports via Email - Azure Automation</title>
        <postImage>/assets/img/posts/azure-role-assignments-email.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;
&lt;p&gt;Azure cloud services management often requires monitoring and auditing user roles and group memberships. This script automates the generation and email distribution of detailed Azure subscription role assignments. It utilizes managed identity for Azure login, fetches role assignments, and compiles them into a comprehensive report sent via email.&lt;/p&gt;

&lt;h2 id=&quot;arrow_down-how-to-get-it&quot;&gt;:arrow_down: How to get it&lt;/h2&gt;
&lt;p&gt;You can download the script from the following links:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;https://gist.github.com/blakedrumm/8f73e82f78b675bea2968117b70fd83e&quot;&gt;Get-AzRoleAssignmentReport.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Direct Download Link&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://files.blakedrumm.com/Get-AzRoleAssignmentReport.ps1&quot;&gt;Personal File Server - Get-AzRoleAssignmentReport.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Alternative Download Link&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;https://files.blakedrumm.com/Get-AzRoleAssignmentReport.txt&quot;&gt;Personal File Server - Get-AzRoleAssignmentReport.txt&lt;/a&gt; :arrow_left: &lt;strong&gt;Text Format Alternative Download Link&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;classical_building-argument-list&quot;&gt;:classical_building: Argument List&lt;/h2&gt;

&lt;table class=&quot;table table-hover table-text d-block overflow-auto&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parameter&lt;/th&gt;
      &lt;th&gt;Alias&lt;/th&gt;
      &lt;th&gt;ValueFromPipeline&lt;/th&gt;
      &lt;th&gt;Type&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;EmailUsername&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;The username used to authenticate with the SMTP server.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;EmailPassword&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;SecureString&lt;/td&gt;
      &lt;td&gt;The secure password used for SMTP authentication.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;From&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;The email address from which the report will be sent.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;To&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Array&lt;/td&gt;
      &lt;td&gt;Array of recipient email addresses to whom the report will be sent.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Cc&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Array&lt;/td&gt;
      &lt;td&gt;Array of CC recipient email addresses.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Subject&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;The subject line of the email.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Body&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;The body text of the email, describing the contents of the report. Can be HTML or plain text.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SMTPServer&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;The SMTP server used for sending the email.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SubscriptionIds&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Array&lt;/td&gt;
      &lt;td&gt;Array of Azure subscription IDs to be included in the report.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;WhatIf&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Switch&lt;/td&gt;
      &lt;td&gt;A switch to simulate the script execution for testing purposes without performing any actual operations.&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;key-configuring-permissions-for-managed-identity&quot;&gt;:key: Configuring Permissions for Managed Identity&lt;/h2&gt;

&lt;p&gt;To enable the PowerShell script to retrieve detailed user information, such as ObjectType and DisplayName from Azure Active Directory, the UserManagedIdentity needs the ‚ÄúDirectory Readers‚Äù permission. This role-based access control (RBAC) is assigned at the Microsoft Entra ID level (formerly known as Azure Active Directory), not at the subscription level. Follow these steps to assign the correct permissions:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;&lt;strong&gt;Identify the Object ID:&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;System Assigned Identity&lt;/strong&gt;
        &lt;ul&gt;
          &lt;li&gt;Navigate to your Azure Automation Account -&amp;gt; Identity, select the System assigned tab. Copy the Object ID of the System Assigned identity. &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/system-assigned-identity.png&quot; alt=&quot;Copy the System assigned Identity Object ID&quot; /&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;User Assigned Identity&lt;/strong&gt;
        &lt;ul&gt;
          &lt;li&gt;Navigate to your Azure Automation Account -&amp;gt; Identity, select the User assigned tab. Click on the name of the user assigned identity you want to gather the id from. Copy the Object ID of the User Assigned identity. &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/user-assigned-identity.png&quot; alt=&quot;Copy the System assigned Identity Object ID&quot; /&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/user-assigned-identity-object-id.png&quot; alt=&quot;Gather the Object ID from the User Managed Identity&quot; /&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Set Azure role assignments&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;Select &lt;strong&gt;Azure role assignments&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;Select &lt;strong&gt;Add role assignment&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;Set the scope to: &lt;strong&gt;Subscription&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;Select the subscription.&lt;/li&gt;
      &lt;li&gt;Set the role to (use what your company allows here, this is just what I used in my testing): &lt;strong&gt;Reader&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/add-role-assignments-subscription-reader.png&quot; alt=&quot;Subscription reader RBAC permission&quot; /&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Assign the Role:&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;Open Microsoft Entra Id -&amp;gt; Roles and Administrators. &lt;br /&gt;
&lt;a href=&quot;https://portal.azure.com/#view/Microsoft_AAD_IAM/RolesManagementMenuBlade/~/AllRoles/adminUnitObjectId//resourceScope/&quot;&gt;Azure Portal - Roles and Administrators&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;In the roles list, find and click on &lt;strong&gt;Directory Readers&lt;/strong&gt;. &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/add-directory-reader-assignment.png&quot; alt=&quot;Where to click for Add assignments&quot; /&gt;&lt;/li&gt;
      &lt;li&gt;Click &lt;strong&gt;+ Add Assignments&lt;/strong&gt; to start the role assignment process.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Add Managed Identity to Role:&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;In the assignment interface, you might not see app registrations or managed identities by default.&lt;/li&gt;
      &lt;li&gt;Paste the Object ID (from step 1) into the search field. This should display the name and ID of your Azure Automation Account.&lt;/li&gt;
      &lt;li&gt;Select your account and confirm the assignment. &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/add-directory-reader-assignment-object-id.png&quot; alt=&quot;How to add a object id for assignment&quot; /&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Verify Permissions:&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;Once the ‚ÄúDirectory Readers‚Äù permission is assigned, the script will be able to pull the Object Type and DisplayName along with other outputs from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Get-AzRoleAssignment&lt;/code&gt;.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;This configuration is essential for the script to function correctly and securely access the necessary Azure AD data!&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;page_with_curl-how-to-use-it&quot;&gt;:page_with_curl: How to use it&lt;/h2&gt;
&lt;p&gt;In order to utilize this script in your Automation Runbook, you will need to set an encrypted variable inside of the Automation Account. This will be so we can pass the EmailPassword variable securely to the script. The script has the ability to gather this password automatically if you perform the following steps.&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Go to &lt;strong&gt;Automation Accounts&lt;/strong&gt; -&amp;gt; Select the Automation Account -&amp;gt; &lt;strong&gt;Variables&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Click &lt;strong&gt;+ Add a variable&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;New Variable&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;Name:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;EmailPassword&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Description:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;This is the password for the Email Account used in SMTP for an Azure Automation Runbook&lt;/code&gt;.&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Type:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;String&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Value:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;YourPassword&amp;gt;&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Encrypted:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Yes&lt;/code&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/encrypted-variables-automation-account.png&quot; alt=&quot;Encrypted Variables Azure Automation Account&quot; /&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Leave some feedback if this helped you! :v:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/azure-automation-automated-azure-role-assignment-reports/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>April 23, 2024</pubDate>
        <link>https://blakedrumm.com/blog/azure-automation-automated-azure-role-assignment-reports/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/azure-automation-automated-azure-role-assignment-reports/</guid>
      </item>
    
      <item>
        <title>Toggle VM Power by Tag - Azure Automation</title>
        <postImage>/assets/img/start-stop-vms-by-tag-test-panel.png</postImage>
        <description>&lt;h2 id=&quot;bulb-introduction&quot;&gt;:bulb: Introduction&lt;/h2&gt;
&lt;p&gt;Managing the power state of Azure VMs can be a cumbersome task, especially when dealing with a large number of instances. In scenarios where VMs need to be started or stopped based on certain criteria‚Äîlike environment tags‚Äîit‚Äôs crucial to have an automated solution. This guide introduces a PowerShell script designed to toggle the power state of Azure Virtual Machines (VMs) based on their tags, offering a streamlined approach for bulk operations.&lt;/p&gt;

&lt;h2 id=&quot;wrench-the-script&quot;&gt;:wrench: The Script&lt;/h2&gt;
&lt;p&gt;The PowerShell script enables you to start or stop Azure VMs in bulk by specifying their subscription IDs, a tag name, and a tag value. It also supports a &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-WhatIf&lt;/code&gt; parameter for dry runs, allowing you to preview the changes without applying them.&lt;/p&gt;

&lt;h2 id=&quot;label-preparing-your-vms&quot;&gt;:label: Preparing Your VMs&lt;/h2&gt;

&lt;p&gt;To ensure your Azure VMs respond correctly to the script, you must tag them with specific key-value pairs. The script identifies VMs to start or stop based on these tags. Here‚Äôs how to set up your VM tags:&lt;/p&gt;

&lt;h3 id=&quot;tagging-vms&quot;&gt;Tagging VMs&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/start-stop-vms-by-tag-vm-example.png&quot; alt=&quot;Example showing a tag configured for a Virtual Machine in the Azure Portal&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Access the Azure Portal:&lt;/strong&gt; Navigate to the Azure Portal and find the Virtual Machines section.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Select a VM:&lt;/strong&gt; Choose the VM you want to manage with the script.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;&lt;strong&gt;Add Tags:&lt;/strong&gt;&lt;/p&gt;
    &lt;ul&gt;
      &lt;li&gt;Click on the &lt;strong&gt;Tags&lt;/strong&gt; section in the VM‚Äôs menu.&lt;/li&gt;
      &lt;li&gt;Add a new tag with the &lt;strong&gt;TagName&lt;/strong&gt; you plan to use in the script. For example, if your script uses &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Environment&lt;/code&gt; as the tag name, you might set the tag value to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Development&lt;/code&gt; for all development VMs.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;example-tag-configuration&quot;&gt;Example Tag Configuration&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Tag Name:&lt;/strong&gt; Environment&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Tag Value:&lt;/strong&gt; Development&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;With this configuration, if you run the script with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Environment&lt;/code&gt; as the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$TagName&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Development&lt;/code&gt; as the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$TagValue&lt;/code&gt;, it will target all VMs tagged as part of your development environment.&lt;/p&gt;

&lt;p&gt;This setup allows for precise control over which VMs are affected by the script, enabling you to manage VM power states efficiently across different environments or projects.&lt;/p&gt;

&lt;h2 id=&quot;arrow_down-how-to-get-it&quot;&gt;:arrow_down: How to get it&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;GitHub Gist:&lt;/strong&gt; &lt;a href=&quot;https://gist.github.com/blakedrumm/23163b76af766e38bcc507743472c603&quot;&gt;Toggle-VMPowerByTag.ps1&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kr&quot;&gt;param&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SubscriptionIds&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TagName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TagValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Parameter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Mandatory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Boolean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PowerState&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# true for start, false for stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Boolean&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$WhatIf&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# test how the script will work, without making any changes to your environment&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Script to toggle Azure VM power states based on tags&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Requires PowerShell 7.2 or higher&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Author: Blake Drumm (blakedrumm@microsoft.com)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Website: https://blakedrumm.com/&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Date created: March 31st, 2024&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Date modified: April 16th, 2024&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Ensures you do not inherit an AzContext in your runbook&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$disableAzContextAutosave&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Disable-AzContextAutosave&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Scope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Process&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Connect using a Managed Service Identity&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Connect to Azure&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$AzConnection&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Connect-AzAccount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Identity&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AccountId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cb02e61e-d392-48d7-936a-9b44bbf5f312&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.ToLocalTime()) - Connected to Azure (Account Id: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$AzConnection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Context&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Account&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Id&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;)&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Log the error and exit&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.ToLocalTime()) - Connection failed: &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SubscriptionIds&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ForEach-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Initialize variables&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PowerState&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SubId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Set the subscription context&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.ToLocalTime()) - Subscription Id: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SubId&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$setAzContext&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set-AzContext&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SubscriptionId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SubId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Log the error and exit&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.ToLocalTime()) - Encountered error: &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;exit&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Fetch VMs with the specified tag&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vms&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-AzResource&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ResourceType&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Microsoft.Compute/virtualMachines&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-TagName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TagName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-TagValue&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TagValue&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Start or stop the VMs based on the desired state&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vms&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ForEach-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Parallel&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vm&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$WhatIf&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;using&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;WhatIf&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$Power&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;using&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;PS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Fetch VM status&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;do&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$x&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
				&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vmStatus&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-AzVM&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ResourceGroupName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ResourceGroupName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Status&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
				&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# This will only be set to 2 if the command above is able to successfully fetch the VM status&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
				&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
				&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.ToLocalTime()) - Encountered error: (VM Name: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;) &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;until&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$x&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-eq&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		
		
		&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Extract the power state of the VM&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vmPowerState&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vmStatus&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Statuses&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Where-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Code&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-like&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;PowerState/*&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Select-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ExpandProperty&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Code&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		
		&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Start or stop VM based on the desired state		&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$Power&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-eq&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$true&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vmPowerState&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-ne&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;PowerState/running&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$WhatIf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
				&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.ToLocalTime()) - What if: Starting &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
				&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Start the VM&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
				&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Start-AzVM&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ResourceGroupName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ResourceGroupName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Verbose&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
				&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.ToLocalTime()) - Starting &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;elseif&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$Power&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-eq&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vmPowerState&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-notmatch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;PowerState/(deallocated|stopped)&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$WhatIf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
				&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.ToLocalTime()) - What if: Stopping &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
				&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Stop the VM&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
				&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Stop-AzVM&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ResourceGroupName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ResourceGroupName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Force&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Verbose&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
				&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.ToLocalTime()) - Stopping &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Log the VM is already in the desired state&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.ToLocalTime()) - VM &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vm&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; is already in the desired state (PowerState: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$Power&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;). (Current VM PowerState: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$vmPowerState&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;)&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ThrottleLimit&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Example throttle limit&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.ToLocalTime()) - Script completed!&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;&amp;lt;#
    Copyright (c) Microsoft Corporation. MIT License
    
    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the &quot;Software&quot;), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:
    
    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.
    
    THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
    CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
#&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;gear-how-it-works&quot;&gt;:gear: How It Works&lt;/h2&gt;
&lt;p&gt;The script first disables AzContext autosave to ensure a clean environment. Then, it attempts to connect to Azure using a Managed Service Identity. For each subscription ID provided, it sets the Azure context and fetches VMs that match the specified tag name and value. Depending on the desired power state (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;$PowerState&lt;/code&gt;), it starts or stops the fetched VMs, respecting the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-WhatIf&lt;/code&gt; parameter to only simulate actions if specified.&lt;/p&gt;

&lt;h3 id=&quot;key-key-features&quot;&gt;:key: Key Features&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Tag-Based Filtering:&lt;/strong&gt; Selectively start or stop VMs based on tags, allowing for flexible management of different environments or deployment stages.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Bulk Operations:&lt;/strong&gt; Perform actions on multiple VMs across different subscriptions, saving time and effort.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Safe Testing with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-WhatIf&lt;/code&gt;:&lt;/strong&gt; Preview the impact of the script without making actual changes to your VMs, enhancing control and safety.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;mag-use-cases&quot;&gt;:mag: Use Cases&lt;/h2&gt;
&lt;p&gt;This script is particularly useful for scenarios like:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Cost Optimization:&lt;/strong&gt; Automatically stop non-essential VMs outside of business hours.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Environment Management:&lt;/strong&gt; Quickly start or stop all VMs within a specific environment (e.g., development, testing) based on tagging.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;thought_balloon-feedback&quot;&gt;:thought_balloon: Feedback&lt;/h2&gt;
&lt;p&gt;Have you tried using the script in your Azure environment? Any suggestions for improvement or additional features you‚Äôd find useful? Share your thoughts and experiences to help enhance this script for everyone.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/azure-automation-toggle-vm-power-by-tag/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;
</description>
        <pubDate>March 31, 2024</pubDate>
        <link>https://blakedrumm.com/blog/azure-automation-toggle-vm-power-by-tag/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/azure-automation-toggle-vm-power-by-tag/</guid>
      </item>
    
      <item>
        <title>Assessment Failures - Azure Update Manager</title>
        <postImage>/assets/img/posts/example-error-azure-update-manager-assessment.png</postImage>
        <description>&lt;h2 id=&quot;bulb-introduction&quot;&gt;:bulb: Introduction&lt;/h2&gt;
&lt;p&gt;I had a case today where Azure Update Manager was showing errors regarding checks for assessments, upon checking the Windows Updates installed on the machine we noticed the updates were successfully installed.&lt;/p&gt;

&lt;h3 id=&quot;x-error-text&quot;&gt;:x: Error text&lt;/h3&gt;
&lt;pre style=&quot;white-space: pre-wrap;&quot;&gt;
1 errors reported. The latest 100 errors are shared in details. To view all errors, review this log file on the machine: [C:\ProgramData\GuestConfig\extension_logs\Microsoft.Software Update Management.WindowsOsUpdateExtension\1.telemetryLogs]. Failed to apply patch installation. Reason: [Failed to assess the machine for available updates: Activityld = [4242741a-0959-4b6c-886b-d7385dfc62f1], Operation=[Patching], Reason:[Windows update API threw an exception while assessing the machine for available updates. &lt;span style=&quot;color:yellow&quot;&gt;HResult: 0x80244022&lt;/span&gt;.. For information on diagnosing this error, see: https://aka.ms/TroubleshootVMGuestPatching.].].
&lt;/pre&gt;

&lt;h2 id=&quot;mag-cause&quot;&gt;:mag: Cause&lt;/h2&gt;
&lt;p&gt;Details on the above exception:&lt;/p&gt;
&lt;div class=&quot;w-100 overflow-auto&quot;&gt;

  &lt;hr /&gt;

  &lt;table&gt;
    &lt;thead&gt;
      &lt;tr&gt;
        &lt;th&gt;Hexadecimal Error Code&lt;/th&gt;
        &lt;th&gt;Decimal Error Code&lt;/th&gt;
        &lt;th&gt;Symbolic Name&lt;/th&gt;
        &lt;th&gt;Error Description&lt;/th&gt;
        &lt;th&gt;Header&lt;/th&gt;
      &lt;/tr&gt;
    &lt;/thead&gt;
    &lt;tbody&gt;
      &lt;tr&gt;
        &lt;td&gt;0x80244022¬†&lt;/td&gt;
        &lt;td&gt;-2145107934¬†&lt;/td&gt;
        &lt;td&gt;WU_E_PT_HTTP_STATUS_SERVICE_UNAVAIL¬†&lt;/td&gt;
        &lt;td&gt;Same as HTTP status 503 - the service is temporarily overloaded.¬†&lt;/td&gt;
        &lt;td&gt;wuerror.h¬†&lt;/td&gt;
      &lt;/tr&gt;
    &lt;/tbody&gt;
  &lt;/table&gt;

  &lt;hr /&gt;

&lt;/div&gt;
&lt;p&gt;¬†&lt;/p&gt;

&lt;p&gt;The issue above in my customers circumstance was due to the following registry key being present: &lt;br /&gt;
&lt;strong&gt;HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;Specifically this key was changed to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1&lt;/code&gt; which needed to be &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt; in order to utilize Microsoft Updates:&lt;/p&gt;

&lt;table&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Entry name&lt;/th&gt;
      &lt;th&gt;Data type&lt;/th&gt;
      &lt;th&gt;Values&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;UseWUServer¬†&lt;/td&gt;
      &lt;td&gt;Reg_DWORD¬†¬†&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;1&lt;/strong&gt; = The computer gets its updates from a WSUS server.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;&lt;strong&gt;0&lt;/strong&gt; = The computer gets its updates from Microsoft Update.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;The WUServer value is not respected unless this key is set.&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;p&gt;More information on the registry keys for Automatic Updates and WSUS: &lt;br /&gt;
&lt;a href=&quot;https://learn.microsoft.com/windows/deployment/update/waas-wu-settings#configuring-automatic-updates-by-editing-the-registry&quot;&gt;https://learn.microsoft.com/windows/deployment/update/waas-wu-settings#configuring-automatic-updates-by-editing-the-registry&lt;/a&gt; &lt;br /&gt;
&lt;a href=&quot;https://github.com/vFense/vFenseAgent-win/wiki/Registry-keys-for-configuring-Automatic-Updates-&amp;amp;-WSUS&quot;&gt;https://github.com/vFense/vFenseAgent-win/wiki/Registry-keys-for-configuring-Automatic-Updates-&amp;amp;-WSUS&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;wrench-resolution&quot;&gt;:wrench: Resolution&lt;/h2&gt;
&lt;p&gt;Modifying the registry key above (&lt;strong&gt;UseWUServer&lt;/strong&gt;) registry key to &lt;strong&gt;0&lt;/strong&gt; instead of &lt;strong&gt;1&lt;/strong&gt; allowed us to successfully utilize Azure Update Manager.&lt;/p&gt;

&lt;h3 id=&quot;computer-powershell-script&quot;&gt;:computer: PowerShell Script&lt;/h3&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# The following code will allow you to set the UseWUServer registry key to 0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Which allows you to utilize Microsoft Updates instead of Software Update Services (WSUS)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set-ItemProperty&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;UseWUServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Path&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;HKLM:\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/wsus-registry-key.png&quot; alt=&quot;Example showing how the registry should look&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Leave some feedback if this helped you! :v:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/azure-update-manager-assessment-failures/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>February 27, 2024</pubDate>
        <link>https://blakedrumm.com/blog/azure-update-manager-assessment-failures/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/azure-update-manager-assessment-failures/</guid>
      </item>
    
      <item>
        <title>Configure periodic checking for missing system updates on azure virtual machines - Azure Update Manager Policy</title>
        <postImage>/assets/img/posts/azure-update-manager-policy-configure-periodic-checking.png</postImage>
        <description>&lt;h2 id=&quot;bulb-introduction&quot;&gt;:bulb: Introduction&lt;/h2&gt;
&lt;p&gt;I had a case today were my customer was experiencing an error with the built-in Azure Update Manager Policy named: &lt;strong&gt;Configure periodic checking for missing system updates on azure virtual machines&lt;/strong&gt;. I decided it would be a good idea to script out how to fix this so it can be automatically fixed for anyone who needs this fix in the future.&lt;/p&gt;

&lt;h3 id=&quot;x-error-text&quot;&gt;:x: Error text&lt;/h3&gt;
&lt;pre style=&quot;white-space: pre-wrap;&quot;&gt;
Failed to remediate resource: &apos;/subscriptions/a84b857e-2f4b-4b79-8b92-c6f1093b6d4f/resourceGroups/rg-app-production/providers/Microsoft.Compute/virtualMachines/vmProdServer01&apos;. The &apos;PUT&apos; request failed with status code: &apos;Forbidden&apos;. Inner Error: &apos;The client &apos;f4e3d2c1-b6a5-4f09-b8ed-9c2a3b1c9e4d&apos; with object id &apos;f4e3d2c1-b6a5-4f09-b8ed-9c2a3b1c9e4d&apos; has permission to perform action &apos;Microsoft.Compute/virtualMachines/write&apos; on scope &apos;/subscriptions/a84b857e-2f4b-4b79-8b92-c6f1093b6d4f/resourceGroups/rg-app-production/providers/Microsoft.Compute/virtualMachines/vmProdServer01&apos;; however, &lt;span style=&quot;color:yellow&quot;&gt;it does not have permission to perform action(s) &apos;Microsoft.Compute/diskEncryptionSets/read&apos; on the linked scope(s) &apos;/subscriptions/a84b857e-2f4b-4b79-8b92-c6f1093b6d4f/resourceGroups/rg-encryption-keys/providers/Microsoft.Compute/diskEncryptionSets/desProdKeySet&apos;&lt;/span&gt; (respectively) or the linked scope(s) are invalid.&apos;, Correlation Id: &apos;9e2d4b3c-a1b2-c3d4-e5f6-7g8h9i0j1k2l&apos;.
&lt;/pre&gt;

&lt;h2 id=&quot;mag-cause&quot;&gt;:mag: Cause&lt;/h2&gt;
&lt;p&gt;Built-in policy for &lt;strong&gt;Configure periodic checking for missing system updates on azure virtual machines&lt;/strong&gt; does not utilize a role that includes the permissions needed for Disk Encryption Set read.&lt;/p&gt;

&lt;h2 id=&quot;wrench-resolution&quot;&gt;:wrench: Resolution&lt;/h2&gt;
&lt;p&gt;The below PowerShell script is designed to duplicate the Virtual Machine Contributor role and will add Disk Encryption Set read access to the new custom role. Then the script duplicates the Azure Policy:
Configure periodic checking for missing system updates on azure virtual machines&lt;/p&gt;

&lt;p&gt;Lastly the script edits the policy and replaces the assigned Role to the newly created custom role created with the script. You will need to edit line 22 to set the subscription name. On line 23 you can see the name of the new Policy that will be created with the script. You can verify the Role Definition is created correctly by searching the display name in your roles: &lt;strong&gt;Virtual Machine Contributor (with Disk Encryption Set read)&lt;/strong&gt;&lt;/p&gt;

&lt;h3 id=&quot;computer-powershell-script&quot;&gt;:computer: PowerShell Script&lt;/h3&gt;

&lt;p&gt;&lt;a href=&quot;https://gist.github.com/blakedrumm/1ed524f72e9bd2456bed96ff409ae17d&quot;&gt;https://gist.github.com/blakedrumm/1ed524f72e9bd2456bed96ff409ae17d&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ============================================================================&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Name: VM Management Role and Update Compliance Policy Setup Script&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ------------------------------------------------------------------&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Description: This PowerShell script automates the creation or updating of a custom Azure role and policy definition &lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# for managing virtual machine (VM) security and compliance. It ensures VMs within specified subscriptions are managed &lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# with enhanced permissions, including disk encryption set reading, and comply with system update policies. If the &lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# targeted custom role does not exist, it creates one by extending the &quot;Virtual Machine Contributor&quot; role. It then &lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# duplicates a built-in Azure policy for system update assessments, integrating the custom role to enforce update &lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# compliance. Designed for Azure administrators, this script streamlines VM management, security, and compliance &lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# within Azure environments.&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ============================================================================&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Author: Blake Drumm (blakedrumm@microsoft.com)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Date Created: February 2nd, 2024&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Date Modified: February 6th, 2024&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ============================================================================&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Edit Variables Below&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Type in the Subscription Scope you want to target for the new Role&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# (You can comma separate Subscriptions you want to apply this role to)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# (Leave this empty if you want to select all subscriptions)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SubscriptionsScope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Visual Studio Enterprise Subscription&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PolicyDefinitionName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Configure periodic checking for missing system updates on azure virtual machines (with Disk Encryption Set read)&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ============================================================================&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SubscriptionScopeDetails&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-AzSubscription&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SubscriptionName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SubscriptionsScope&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Warning&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Experienced an error while gathering the subscription(s): &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n`n&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-AzContext&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Out-String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SubscriptionScopeId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SubscriptionScopeDetails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;do&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$Question&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Read-Host&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Current subscriptions selected (&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SubscriptionScopeId&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Count&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;): &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; ‚Ä¢ &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SubscriptionScopeDetails&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-join&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; ‚Ä¢ &quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n`n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; Are you sure you want to perform actions against the above subscriptions? (Y/N)&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;until&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$Question&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-match&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;^Y|^N&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$Question&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-match&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;^N&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Exiting the script.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Use `return` instead of `break` outside of loops to exit the script&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RoleDefinitionName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Virtual Machine Contributor (with Disk Encryption Set read)&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CheckIfRolePresent&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-AzRoleDefinition&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Virtual Machine Contributor (with Disk Encryption Set read)&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SilentlyContinue&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-WarningAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SilentlyContinue&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-----------------------------------------------------------------------------&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-NOT&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CheckIfRolePresent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Get the built-in &quot;Virtual Machine Contributor&quot; role definition&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$role&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-AzRoleDefinition&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Virtual Machine Contributor&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Clone the role to create a new custom role&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$role&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConvertTo-Json&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConvertFrom-Json&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Set properties for the new custom role&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$null&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RoleDefinitionName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Description&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Lets you manage virtual machines, but not access to them, and not the virtual network or storage account they&apos;re connected to. Also lets you read disk encryption sets.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;IsCustom&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$true&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Replace Actions with a new collection including Disk Encryption Sets read permission&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Actions&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Authorization/*/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Compute/availabilitySets/*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Compute/locations/*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Compute/virtualMachines/*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Compute/virtualMachineScaleSets/*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Compute/cloudServices/*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Compute/disks/write&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Compute/disks/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Compute/disks/delete&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.DevTestLab/schedules/*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Insights/alertRules/*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/applicationGateways/backendAddressPools/join/action&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/loadBalancers/backendAddressPools/join/action&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/loadBalancers/inboundNatPools/join/action&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/loadBalancers/inboundNatRules/join/action&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/loadBalancers/probes/join/action&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/loadBalancers/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/locations/*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/networkInterfaces/*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/networkSecurityGroups/join/action&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/networkSecurityGroups/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/publicIPAddresses/join/action&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/publicIPAddresses/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/virtualNetworks/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Network/virtualNetworks/subnets/join/action&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.RecoveryServices/locations/*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.RecoveryServices/Vaults/backupFabrics/backupProtectionIntent/write&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.RecoveryServices/Vaults/backupFabrics/protectionContainers/protectedItems/*/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.RecoveryServices/Vaults/backupFabrics/protectionContainers/protectedItems/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.RecoveryServices/Vaults/backupFabrics/protectionContainers/protectedItems/write&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.RecoveryServices/Vaults/backupPolicies/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.RecoveryServices/Vaults/backupPolicies/write&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.RecoveryServices/Vaults/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.RecoveryServices/Vaults/usages/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.RecoveryServices/Vaults/write&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.ResourceHealth/availabilityStatuses/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Resources/deployments/*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Resources/subscriptions/resourceGroups/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.SerialConsole/serialPorts/connect/action&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.SqlVirtualMachine/*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Storage/storageAccounts/listKeys/action&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Storage/storageAccounts/read&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Support/*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.Compute/diskEncryptionSets/read&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Replace NotActions with an empty array if needed, or customize as necessary&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;NotActions&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Replace assignable scopes with a new collection&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AssignableScopes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;foreach&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SubscriptionScopeId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AssignableScopes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/subscriptions/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n`t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;‚Ä¢ Getting ready to create Azure Role Definition: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RoleDefinitionName&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Verbose&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Verbose&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Custom Role Variable:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Out-String&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Create the new role definition&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$newAzRole&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-AzRoleDefinition&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Role&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n`t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;‚Ä¢ Successfully created Azure Role Definition!&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ScriptError&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;-- Custom Role:&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$customRole&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ScriptError&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Verbose&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Verbose&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; == Aborting script / See above for error == &quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$newAzRole&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CheckIfRolePresent&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n`t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Role Definition is already created.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$newAzRole&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;-----------------------------------------------------------------------------&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Step 1: Capture the New Role Definition ID&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$newRoleDefinitionId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$newAzRole&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Step 2: Identify the Built-in Azure Policy to Duplicate&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# For example, let&apos;s assume you&apos;ve identified a policy by its definition ID&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$existingPolicyDefinitionId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;59efceea-0c96-497e-a4a1-4eb2290dac15&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Get the existing policy definition&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$existingPolicyDefinition&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-AzPolicyDefinition&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$existingPolicyDefinitionId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Step 3: Duplicate and Update the Policy with the New Role Definition ID&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Convert the existing policy rule to an object to make it editable&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$policyRuleObject&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$existingPolicyDefinition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;PolicyRule&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Assuming the policy involves role assignments, update the rule to include your new role definition ID&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Note: The specific changes depend on the policy&apos;s structure. This is a generic example.&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# If the policy assigns roles, you might find a section in the policy rule to insert the role ID.&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Correctly format the roleDefinitionIds as an array&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$policyRuleObject&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;then&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;details&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;roleDefinitionIds&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/providers/Microsoft.Authorization/roleDefinitions/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$newRoleDefinitionId&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Convert the modified policy rule back to JSON&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$modifiedPolicyRuleJson&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$policyRuleObject&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConvertTo-Json&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Depth&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;20&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;‚Ä¢ Creating/Updating new Policy Definition.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n`t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;  ‚Ä¢ Name: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PolicyDefinitionName&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Step 4: Create the New Policy Definition&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$newPolicyDefinition&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-AzPolicyDefinition&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;PeroidicCheckMissingAzureVMs&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;												  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DisplayName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PolicyDefinitionName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;												  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Description&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Configure auto-assessment (every 24 hours) for OS updates on native Azure virtual machines. You can control the scope of assignment according to machine subscription, resource group, location or tag. Learn more about this for Windows: https://aka.ms/computevm-windowspatchassessmentmode, for Linux: https://aka.ms/computevm-linuxpatchassessmentmode.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;												  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Policy&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$modifiedPolicyRuleJson&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;												  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Mode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$existingPolicyDefinition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Mode&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;												  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Parameter&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$existingPolicyDefinition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Parameters&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConvertTo-Json&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;												  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Metadata&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$existingPolicyDefinition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Metadata&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ConvertTo-Json&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`
&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;												  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Output the new policy definition for verification&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n`t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;‚Ä¢ New policy definition created/updated.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n`t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;  ‚Ä¢ Resource Id: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$newPolicyDefinition&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ResourceId&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Warning&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Experienced an error while creating the Policy Definition:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n`n&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;


&lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;&amp;lt;#
    Copyright (c) Microsoft Corporation. MIT License
    
    Permission is hereby granted, free of charge, to any person obtaining a copy
    of this software and associated documentation files (the &quot;Software&quot;), to deal
    in the Software without restriction, including without limitation the rights
    to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
    copies of the Software, and to permit persons to whom the Software is
    furnished to do so, subject to the following conditions:
    
    The above copyright notice and this permission notice shall be included in all
    copies or substantial portions of the Software.
    
    THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
    IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
    FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
    AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
    WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
    CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
#&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/azure-update-manager-policy-powershell-script.png&quot; alt=&quot;VM Management Role and Update Compliance Policy Setup Script Output&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Leave some feedback if this helped you! :v:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/azure-update-manager-policy-failure-remediation/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>February 14, 2024</pubDate>
        <link>https://blakedrumm.com/blog/azure-update-manager-policy-failure-remediation/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/azure-update-manager-policy-failure-remediation/</guid>
      </item>
    
      <item>
        <title>How to check core usage of ESU licenses - Azure Arc</title>
        <postImage>/assets/img/posts/azure-arc.png</postImage>
        <description>&lt;h2 id=&quot;bulb-introduction&quot;&gt;:bulb: Introduction&lt;/h2&gt;
&lt;p&gt;This is my first blog post regarding the Azure space! On my blog today, I want to shed light on a common issue customers face: tracking the usage of Cores across their licenses. This is vital for understanding how many Cores are being utilized versus what‚Äôs available. Currently, Azure Portal lacks a direct report view for this, forcing customers to manually check each license and linked server to sum up the Core count, which is a hassle.&lt;/p&gt;

&lt;p&gt;Good news, though. When a customer asks for such a report, there‚Äôs a simpler method: querying the Azure Resource Graph (ARG). The query I‚Äôve got does the heavy lifting. It counts the Cores from each linked Arc machine, adjusts the count to meet the minimum requirements (8 vCores per VM and 16 pCores per physical server), and then presents this data alongside the license info.&lt;/p&gt;

&lt;p&gt;This approach is a game-changer. It not only saves time but also gives a more accurate picture of Core usage.&lt;/p&gt;

&lt;h2 id=&quot;chart_with_upwards_trend-steps-to-gather-data&quot;&gt;:chart_with_upwards_trend: Steps to Gather Data&lt;/h2&gt;

&lt;h3 id=&quot;mag-open-resource-graph-explorer&quot;&gt;:mag: Open Resource Graph Explorer&lt;/h3&gt;
&lt;p&gt;Within the Azure Portal open &lt;a href=&quot;https://portal.azure.com/#view/HubsExtension/ArgQueryBlade&quot; target=&quot;_blank&quot;&gt;Resource Graph Explorer&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/resource-graph-explorer.png&quot; alt=&quot;Resource Graph Explorer&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;memo-kusto-query-kql&quot;&gt;:memo: Kusto Query (KQL)&lt;/h3&gt;

&lt;div class=&quot;language-kql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=~&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;microsoft.hybridcompute/licenses&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sku&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tostring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;licenseDetails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;edition&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;totalCores&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tostring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;licenseDetails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;processors&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coreType&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;licenseDetails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=~&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;vCore&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Virtual core&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;licenseDetails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=~&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;pCore&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Physical core&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Unknown&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tostring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;licenseDetails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;state&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;licenseId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tolower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tostring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Depending on what is stored in license profile, might have to get the immutableId instead&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=~&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;microsoft.hybridcompute/machines/licenseProfiles&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;machineId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tolower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tostring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;trim_end&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;@&quot;\/\w+\/(\w|\.)+&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;licenseId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tolower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tostring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;esuProfile&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assignedLicense&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;licenseId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Get count of license profile per license, a license profile is created for each machine that is assigned a license&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;kind&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;inner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resources&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=~&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;microsoft.hybridcompute/machines&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;machineId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tolower&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coreCount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;toint&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;detectedProperties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coreCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;on&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;machineId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c1&quot;&gt;// Get core count by machine&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adjustedCoreCount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;iff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sku&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=~&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Standard&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
                                &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coreCount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coreCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
                                    &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;iff&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sku&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=~&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;DataCenter&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                                        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;case&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coreCount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mf&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coreCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                                        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coreCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;extend&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;machineName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;tostring&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;machineId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;[-1]&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;project&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;machineName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;machineId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;licenseId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;subscriptionId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sku&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;totalCores&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coreType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adjustedCoreCount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;summarize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UsedCoreCount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;adjustedCoreCount&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;k&quot;&gt;by&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;licenseId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;location&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;subscriptionId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resourceGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sku&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;totalCores&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coreType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/esu-core-output-azure-arc.png&quot; alt=&quot;Azure Arc ESU licenses used&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/how-to-check-esu-licenses-azure-arc/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>January 24, 2024</pubDate>
        <link>https://blakedrumm.com/blog/how-to-check-esu-licenses-azure-arc/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/how-to-check-esu-licenses-azure-arc/</guid>
      </item>
    
      <item>
        <title>SCOM Certificate Error - ASN1 Bad Tag Value Met</title>
        <postImage>/assets/img/posts/scom-asn1-bad-tag-value-met.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;
&lt;p&gt;Today I encountered an issue where SCOM fails to generate a certificate for Unix/Linux agents with an error message stating ‚ÄúASN1 bad tag value met‚Äù.&lt;/p&gt;

&lt;h3 id=&quot;error-description&quot;&gt;Error Description&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;p&gt;Task invocation failed with error code -2130771918. Error message was: The SCXCertWriteAction module encountered a DoProcess exception. The workflow ‚ÄúMicrosoft.Unix.Agent.GetCert.Task‚Äù has been unloaded. &lt;br /&gt;
&lt;br /&gt;
&lt;br /&gt;
Module: SCXCertWriteAction &lt;br /&gt;
Location: DoProcess &lt;br /&gt;
Exception type: ScxCertLibException &lt;br /&gt;
Exception message: &lt;span style=&quot;color:yellow&quot;&gt;Unable to create certificate context &lt;br /&gt;
; {ASN1 bad tag value met. &lt;br /&gt;
}
&lt;/span&gt; &lt;br /&gt;
Additional data: Sudo path: /etc/opt/microsoft/scx/conf/sudodir/&lt;/p&gt;

  &lt;p&gt;Management group: SCOM2019 &lt;br /&gt;
Workflow name: Microsoft.Unix.Agent.GetCert.Task &lt;br /&gt;
Object name: UNIX/Linux Resource Pool &lt;br /&gt;
Object ID: {7B5B80D1-5C4A-6643-762D-60F46FB70CB8}&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;mag-possible-causes-and-resolution&quot;&gt;:mag: Possible Causes and Resolution&lt;/h2&gt;
&lt;h3 id=&quot;possible-causes&quot;&gt;Possible Causes&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;Sudoers permissions are missing.&lt;/li&gt;
  &lt;li&gt;Errors in SSHCommandProbe.log (look for &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;errdata&lt;/code&gt;)
    &lt;blockquote&gt;
      &lt;p&gt;3: 08/08/22 12:01:59 : Entering RunSSHCommand &lt;br /&gt;
3: 08/08/22 12:01:59 : Using su command:   su - root -c &lt;br /&gt;
3: 08/08/22 12:01:59 : Using sudo command: ${SUDO_PATH}sudo sh -c &lt;br /&gt;
3: 08/08/22 12:01:59 : sending: if [ -x /etc/opt/microsoft/scx/conf/sudodir/sudo ]; then &lt;br /&gt;
  SUDO_PATH=/etc/opt/microsoft/scx/conf/sudodir/; export SUDO_PATH &lt;br /&gt;
else &lt;br /&gt;
  if [ -x /opt/sfw/bin/sudo ]; then &lt;br /&gt;
    SUDO_PATH=/opt/sfw/bin/; export SUDO_PATH &lt;br /&gt;
  else &lt;br /&gt;
    SUDO_PATH=/usr/bin/; export SUDO_PATH &lt;br /&gt;
  fi &lt;br /&gt;
fi &lt;br /&gt;
echo ‚ÄúSudo path: ${SUDO_PATH}‚Äù &lt;br /&gt;
${SUDO_PATH}sudo sh -c ‚Äòcat /etc/opt/microsoft/scx/ssl/scx.pem‚Äô &lt;br /&gt;
 &lt;br /&gt;
3: 08/08/22 12:01:59 : Enter SSHFacade::RunCommand &lt;br /&gt;
3: 08/08/22 12:02:02 : Leave SSHFacade::RunCommand &lt;br /&gt;
3: 08/08/22 12:02:02 : returned: Sudo path: /etc/opt/microsoft/scx/conf/sudodir/ &lt;br /&gt;
 &lt;br /&gt;
&lt;span style=&quot;color:yellow&quot;&gt;errdata: sudo: a terminal is required to read the password; either use the -S option to read from standard input or configure an askpass helper&lt;/span&gt;&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;In the secure log file on the Linux Server, you should see messages like:
    &lt;blockquote&gt;
      &lt;p&gt;Aug  8 12:32:00 rhel8-5 sshd[2749309]: pam_unix(sshd:session): session opened for user scxmaint by (uid=0) &lt;br /&gt;
Aug  8 12:32:00 rhel8-5 sudo[2749343]: pam_unix(sudo:auth): conversation failed &lt;br /&gt;
Aug  8 12:32:00 rhel8-5 sudo[2749343]: pam_unix(sudo:auth): auth could not identify password for [scxmaint] &lt;br /&gt;
Aug  8 12:32:02 rhel8-5 sudo[2749343]: &lt;span style=&quot;color:yellow&quot;&gt;scxmaint : command not allowed&lt;/span&gt; ; TTY=unknown ; PWD=/home/scxmaint ; USER=root ; COMMAND=/bin/sh -c cat /etc/opt/microsoft/scx/ssl/scx.pem &lt;br /&gt;
Aug  8 12:32:02 rhel8-5 sshd[2749309]: pam_unix(sshd:session): session closed for user scxmaint&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;how-to-fix-it&quot;&gt;How to fix it&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;Check and verify the sudoers are setup correctly: &lt;br /&gt;
&lt;a href=&quot;https://learn.microsoft.com/system-center/scom/manage-security-unix-linux-sudoers-templates&quot;&gt;https://learn.microsoft.com/system-center/scom/manage-security-unix-linux-sudoers-templates&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Leave some feedback if this helped you! :v:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scom-cert-asn1-bad-tag-value-met/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Welcome to GitHub Pages
... [Remaining GitHub Pages content] ...
--&gt;
</description>
        <pubDate>November 14, 2023</pubDate>
        <link>https://blakedrumm.com/blog/scom-cert-asn1-bad-tag-value-met/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scom-cert-asn1-bad-tag-value-met/</guid>
      </item>
    
      <item>
        <title>SCOM Scheduled Reports Fail with AlertConnectionString, PerfConnectionString, or StateConnectionString Error</title>
        <postImage>/assets/img/posts/scom-reports-perfconnection-error.png</postImage>
        <description>&lt;h2 id=&quot;warning-symptoms&quot;&gt;:warning: Symptoms&lt;/h2&gt;

&lt;p&gt;In SCOM 2016, 2019, or 2022, scheduled reports fail to run. If you check report status by opening the Scheduled Reports view in the Operations Console, the status message shows one of the following:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;‚ÄúDefault value or value provided for the report parameter ‚ÄòAlertConnectionString‚Äô is not a valid value.‚Äù&lt;/li&gt;
  &lt;li&gt;‚ÄúDefault value or value provided for the report parameter ‚ÄòPerfConnectionString‚Äô is not a valid value.‚Äù&lt;/li&gt;
  &lt;li&gt;‚ÄúDefault value or value provided for the report parameter ‚ÄòStateConnectionString‚Äô is not a valid value.‚Äù&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;bulb-cause&quot;&gt;:bulb: Cause&lt;/h2&gt;

&lt;p&gt;This can occur if the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;appSettings&amp;gt;&lt;/code&gt; element is missing from the SQL Server Reporting Services (SSRS) configuration file.&lt;/p&gt;

&lt;p&gt;By default, this configuration file is in the following folder on the SCOM Reporting server:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\Program Files\Microsoft SQL Server Reporting Services\SSRS\ReportServer\bin\ReportingServicesService.exe.config&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;The issue described in the Symptoms section occurs when the below element is missing from the configuration file:&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;  &lt;span class=&quot;nt&quot;&gt;&amp;lt;appSettings&amp;gt;&lt;/span&gt;
  	&lt;span class=&quot;nt&quot;&gt;&amp;lt;add&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ManagementGroupId&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;management_group_GUID&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/appSettings&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;wrench-resolution&quot;&gt;:wrench: Resolution&lt;/h2&gt;

&lt;h3 id=&quot;powershell-automatic-method&quot;&gt;PowerShell Automatic Method&lt;/h3&gt;

&lt;hr /&gt;

&lt;h4 id=&quot;what-does-this-powershell-script-do&quot;&gt;What Does This PowerShell Script Do?&lt;/h4&gt;

&lt;p&gt;This script automates the process of configuring SQL Server Reporting Services (SSRS) in a System Center Operations Manager (SCOM) environment. Below are the key steps:&lt;/p&gt;

&lt;h5 id=&quot;step-1-gather-system-information&quot;&gt;Step 1: Gather System Information&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Fetch SSRS Info&lt;/strong&gt;: Gathers essential details about the SSRS installation using Windows Management Instrumentation (WMI).&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Fetch SCOM Info&lt;/strong&gt;: Retrieves System Center Operations Manager Data Warehouse database settings from the Windows registry.&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;step-2-fetch-management-group-id&quot;&gt;Step 2: Fetch Management Group ID&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;SQL Connection&lt;/strong&gt;: Establishes a connection to the System Center Operations Manager Data Warehouse database.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Fetch ID&lt;/strong&gt;: Executes a SQL query to obtain the Management Group ID.&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;step-3-locate-and-check-the-configuration-file&quot;&gt;Step 3: Locate and Check the Configuration File&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Locate Config&lt;/strong&gt;: Determines the path of the SSRS configuration file (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ReportingServicesService.exe.config&lt;/code&gt;).&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Check Config&lt;/strong&gt;: Checks if the configuration file already contains the correct Management Group ID.&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;step-4-update-configuration&quot;&gt;Step 4: Update Configuration&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Backup Config&lt;/strong&gt;: Creates a backup of the original configuration file.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Update Config&lt;/strong&gt;: If necessary, updates the SSRS configuration file with the new Management Group ID.&lt;/li&gt;
&lt;/ul&gt;

&lt;h5 id=&quot;step-5-finalize-changes&quot;&gt;Step 5: Finalize Changes&lt;/h5&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Save Changes&lt;/strong&gt;: Saves the updated configuration.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Restart Service&lt;/strong&gt;: Restarts the SSRS service to apply the changes.&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;ol&gt;
  &lt;li&gt;Run the following script on your System Center Operations Manager Reporting Server. Be sure the PowerShell window is opened as Administrator and you have rights to query the Operations Manager Data Warehouse Database:
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Author: Blake Drumm (blakedrumm@microsoft.com)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Date Created: 10/31/2023&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;root\Microsoft\SqlServer\ReportServer\&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-CimInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;root\Microsoft\SqlServer\ReportServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClassName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Select-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-First&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSV&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-CimInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClassName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Select-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-First&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;\Admin&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSInfo&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-CimInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSV&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClassName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;MSReportServer_ConfigurationSetting&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    	
 	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Output or use $RSInfo as needed&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SSRSConfigPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSInfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;PathName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    	
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWDBInfo&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-ItemProperty&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Path&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;HKLM:\SOFTWARE\Microsoft\System Center Operations Manager\12\Reporting&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Select-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DWDBInstance&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DWDBName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    	
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Host&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;An error occurred: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ForegroundColor&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Red&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
 &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# User-defined SQL Server Instance for the Operations Manager database&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SQLInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWDBInfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DWDBInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DatabaseName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWDBInfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DWDBName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
 &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Get the Management Group ID using SQL query&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$connectionString&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Server=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SQLInstance&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;;Database=&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DatabaseName&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;;Integrated Security=True;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$connection&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;System.Data.SqlClient.SqlConnection&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$connection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ConnectionString&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$connectionString&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$connection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$command&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$connection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CreateCommand&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CommandText&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SELECT ManagementGroupGuid from vManagementGroup&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$reader&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$command&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ExecuteReader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$managementGroupId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$null&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$reader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$managementGroupId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$reader&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ManagementGroupGuid&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$reader&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$connection&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
 &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Check if we got the Management Group ID&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$null&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-eq&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$managementGroupId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Host&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Failed to get Management Group ID.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ForegroundColor&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Red&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#exit 1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SSRSParentDirectory&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Split-Path&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SSRSConfigPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Path to ReportingServicesService.exe.config&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Resolve-Path&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SSRSParentDirectory&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;\bin\ReportingServicesService.exe.config&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Warning&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Unable to access &apos;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SSRSParentDirectory&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;\bin\ReportingServicesService.exe.config&apos; : &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#exit 1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Load the XML content of the config file&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xml&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configXml&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Content&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Path&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
 &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Check if the appSettings element already exists and has the correct ManagementGroupId&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appSettings&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configXml&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SelectSingleNode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/configuration/appSettings/add[@key=&apos;ManagementGroupId&apos;]&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$null&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-ne&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appSettings&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appSettings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-eq&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$managementGroupId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Host&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Configuration is already up to date.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ForegroundColor&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Green&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#exit 0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
 &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Create a backup of the existing config file&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Copy-Item&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Path&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Destination&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configPath&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;.bak&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
 &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Update or create the appSettings element&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$null&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-ne&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appSettings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appSettings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$managementGroupId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appSettings&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configXml&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CreateElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;appSettings&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$addKey&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configXml&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CreateElement&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;add&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$addKey&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;key&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ManagementGroupId&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$addKey&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SetAttribute&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$managementGroupId&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appSettings&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AppendChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$addKey&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configXml&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;SelectSingleNode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;/configuration&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AppendChild&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$appSettings&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
 &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Save the modified XML back to the config file&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configXml&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$configPath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
 &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Restart the SQL Server Reporting Services service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Restart-Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSInfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ServiceName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    
 &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Host&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Configuration updated successfully.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ForegroundColor&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Green&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;manual-method&quot;&gt;Manual Method&lt;/h3&gt;
&lt;p&gt;To resolve the issue, edit the SSRS configuration file to add a valid &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;appSettings&amp;gt;&lt;/code&gt; element.&lt;/p&gt;

&lt;p&gt;The following are the steps:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;On any computer that has the SCOM Operations Console installed, run the following PowerShell commands to get the management group ID:&lt;/p&gt;

    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Import-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;OperationsManager&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMManagementGroup&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;id&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;guid&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Create a copy of the existing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ReportingServicesService.exe.config&lt;/code&gt; file. By default, this file is in the following folder on the SCOM Reporting server:&lt;/p&gt;

    &lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\Program Files\Microsoft SQL Server Reporting Services\SSRS\ReportServer\bin\ReportingServicesService.exe.config&lt;/code&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Open the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ReportingServicesService.exe.config&lt;/code&gt; file in a text editor.&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Add the following element to the file immediately before the closing &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;/configuration&amp;gt;&lt;/code&gt; tag:&lt;/p&gt;

    &lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;appSettings&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;add&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ManagementGroupId&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;management_group_GUID&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;nt&quot;&gt;&amp;lt;/appSettings&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;In the above XML, replace &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;management_group_GUID&lt;/code&gt; with the management group ID you obtained in Step 1.&lt;/p&gt;

    &lt;p&gt;For example, the element will look like the following:&lt;/p&gt;

    &lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;nt&quot;&gt;&amp;lt;startup&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;useLegacyV2RuntimeActivationPolicy=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;true&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
 	&lt;span class=&quot;nt&quot;&gt;&amp;lt;supportedRuntime&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;version=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;v4.0&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;nt&quot;&gt;&amp;lt;/startup&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;nt&quot;&gt;&amp;lt;appSettings&amp;gt;&lt;/span&gt;
 	&lt;span class=&quot;nt&quot;&gt;&amp;lt;add&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;key=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;ManagementGroupId&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;value=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;7f263180-e7d2-9c12-a1cd-0c6c54a7341c&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;nt&quot;&gt;&amp;lt;/appSettings&amp;gt;&lt;/span&gt;
 &lt;span class=&quot;nt&quot;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Save the configuration file.&lt;/li&gt;
  &lt;li&gt;Restart the SQL Server Reporting Services service.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scheduled-reports-perfconnection-error/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Welcome to GitHub Pages

You can use the [editor on GitHub](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/edit/master/docs/index.md) to maintain and preview the content for your website in Markdown files.

Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>October 31, 2023</pubDate>
        <link>https://blakedrumm.com/blog/scheduled-reports-perfconnection-error/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scheduled-reports-perfconnection-error/</guid>
      </item>
    
      <item>
        <title>SCOM SDK not staying on - AzMan Issue</title>
        <postImage>/assets/img/posts/sdk-service-stopped.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;
&lt;p&gt;Today I came across a problem with a customer that had an issue with the System Center Data Access Service (SDK) on all Management Servers crashing immediately after being started. The below errors can be found in the Operations Manager event log:&lt;/p&gt;

&lt;h3 id=&quot;1st-event&quot;&gt;1st Event&lt;/h3&gt;
&lt;pre&gt;
Log Name:      Operations Manager 
Source:        OpsMgr SDK Service 
Date:          10/12/2023 3:10:10 PM 
Event ID:      26380 
Level:         Error 
Computer:      MS01-2019.contoso.com 
Description: 
&lt;span style=&quot;color:yellow&quot;&gt;The System Center Data Access service failed due to an unhandled exception.&lt;/span&gt;  
The service will attempt to restart. 
Exception: 
 
Microsoft.EnterpriseManagement.ConfigurationReaderException: Feature of type &apos;Microsoft.EnterpriseManagement.ServiceDataLayer.IAuthorizationFeature, Microsoft.EnterpriseManagement.DataAccessService.Core, Version=7.0.5000.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35&apos; cannot be added to the container. ---&amp;gt; System.ServiceModel.FaultException\`1\[Microsoft.EnterpriseManagement.Common.UnknownAuthorizationStoreException]: The creator of this fault did not specify a Reason. 
   at Microsoft.EnterpriseManagement.&lt;span style=&quot;color:yellow&quot;&gt;Mom.Sdk.Authorization.AzManHelper.Initialize&lt;/span&gt;(String pathToStore, String appName, AzManHelperModes helperMode, String storeDesc, String appDesc) 
   at Microsoft.EnterpriseManagement.Mom.Sdk.Authorization.AuthManager.Initialize(AuthManagerModes authMode) 
   at Microsoft.EnterpriseManagement.ServiceDataLayer.AuthorizationFeatureImplementation.InitializeAzmanAccessCheckObject() 
   at Microsoft.EnterpriseManagement.ServiceDataLayer.AuthorizationFeatureImplementation.Initialize(IContainer container) 
   at Microsoft.EnterpriseManagement.SingletonLifetimeManager\`1.GetComponent\[K]() 
   at Microsoft.EnterpriseManagement.FeatureContainer.GetFeatureInternal\[T](Type type, String featureName) 
   at Microsoft.EnterpriseManagement.FeatureContainer.AddFeatureInternal\[T,V](ActivationContext`1 context, String featureName) 
   --- End of inner exception stack trace --- 
   at Microsoft.EnterpriseManagement.ConfigurationReaderHelper.ReadFeatures(XPathNavigator navi, IContainer container) 
   at Microsoft.EnterpriseManagement.ConfigurationReaderHelper.Process() 
   at Microsoft.EnterpriseManagement.ServiceDataLayer.DispatcherService.Initialize(InProcEnterpriseManagementConnectionSettings configuration) 
   at Microsoft.EnterpriseManagement.ServiceDataLayer.DispatcherService.InitializeRunner(Object state) 
   at System.Threading.ExecutionContext.RunInternal(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx) 
   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state, Boolean preserveSyncCtx) 
   at System.Threading.ExecutionContext.Run(ExecutionContext executionContext, ContextCallback callback, Object state) 
   at System.Threading.ThreadHelper.ThreadStart(Object obj)
&lt;/pre&gt;
&lt;h3 id=&quot;2nd-event&quot;&gt;2nd Event&lt;/h3&gt;
&lt;pre&gt;
Log Name:      Operations Manager 
Source:        OpsMgr SDK Service 
Date:          10/12/2023 3:10:10 PM 
Event ID:      26339 
Level:         Error 
Computer:      MS01-2019.contoso.com 
Description: 
An exception was thrown while initializing the service container. 
 Exception message: Initialize 
 Full exception: Feature of type &apos;Microsoft.EnterpriseManagement.ServiceDataLayer.&lt;span style=&quot;color:yellow&quot;&gt;IAuthorizationFeature&lt;/span&gt;, Microsoft.EnterpriseManagement.DataAccessService.Core, Version=7.0.5000.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35&apos; cannot be added to the container
&lt;/pre&gt;

&lt;h3 id=&quot;3rd-event&quot;&gt;3rd Event&lt;/h3&gt;
&lt;pre&gt;
Log Name:      Operations Manager 
Source:        OpsMgr SDK Service 
Date:          10/12/2023 3:10:10 PM 
Event ID:      26325 
Level:         Error 
Computer:      MS01-2019.contoso.com 
Description:   An authorization store exception was thrown in the System Center Data Access service. Exception message: &lt;span style=&quot;color:yellow&quot;&gt;Unable to perform the operation because of authorization store errors.&lt;/span&gt;
&lt;/pre&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;page_with_curl-how-to-fix-it&quot;&gt;:page_with_curl: How to fix it&lt;/h2&gt;
&lt;p&gt;First you want to verify this problem is definitely related to Authorization Manager (AzMan).&lt;/p&gt;

&lt;hr /&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;what-is-authorization-manager&quot;&gt;What is Authorization Manager&lt;/h3&gt;
  &lt;p&gt;Authorization Manager, often referred to as &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AzMan&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;AzMan.msc&lt;/code&gt;, is a Microsoft Management Console (MMC) snap-in that provides a flexible framework for integrating role-based access control (RBAC) into applications. It‚Äôs a part of Windows and can be used to manage authorization policies using roles and tasks for applications.&lt;/p&gt;

  &lt;p&gt;Here‚Äôs a basic overview of its functionalities:&lt;/p&gt;

  &lt;ol&gt;
    &lt;li&gt;
      &lt;p&gt;&lt;strong&gt;Role-Based Access Control (RBAC)&lt;/strong&gt;: Authorization Manager allows for the definition of roles, operations, tasks, and scopes to achieve RBAC. This makes it easier for administrators to manage user permissions based on their roles within an organization.&lt;/p&gt;
    &lt;/li&gt;
    &lt;li&gt;
      &lt;p&gt;&lt;strong&gt;Store Policies in AD, AD LDS, and XML&lt;/strong&gt;: Authorization policies can be stored in Active Directory (AD), Active Directory Lightweight Directory Services (AD LDS), or in an XML file. This flexibility allows for the storage and retrieval of policies in a manner best suited to the application‚Äôs needs.&lt;/p&gt;
    &lt;/li&gt;
    &lt;li&gt;
      &lt;p&gt;&lt;strong&gt;Application Integration&lt;/strong&gt;: Applications can be developed to use Authorization Manager for enforcing access control. By doing this, the application offloads the management of roles and permissions to AzMan, making it easier to manage and update permissions without changing application code.&lt;/p&gt;
    &lt;/li&gt;
    &lt;li&gt;
      &lt;p&gt;&lt;strong&gt;Scriptable Interface&lt;/strong&gt;: Authorization Manager provides a scriptable interface, which means you can automate many administrative tasks using scripts.&lt;/p&gt;
    &lt;/li&gt;
    &lt;li&gt;
      &lt;p&gt;&lt;strong&gt;Auditing&lt;/strong&gt;: Authorization Manager can be configured to log access requests, which can then be used for audit purposes.&lt;/p&gt;
    &lt;/li&gt;
    &lt;li&gt;
      &lt;p&gt;&lt;strong&gt;Delegation of Administrative Duties&lt;/strong&gt;: Administrators can delegate certain administrative duties to others, allowing for distributed management of roles and permissions without giving full administrative access.&lt;/p&gt;
    &lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;p&gt;You can either run a PowerShell Script to check the AzMan connectivity or you can use the GUI.&lt;/p&gt;

&lt;h3 id=&quot;powershell-method&quot;&gt;PowerShell Method&lt;/h3&gt;
&lt;p&gt;Open a PowerShell window as Administrator on the SCOM Management Server, copy and paste the below script:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SQLServerAddress&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-ItemPropertyValue&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Path&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;HKLM:\SOFTWARE\Microsoft\System Center\2010\Common\Database&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;DatabaseServerName&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SQLServerOpsDatabase&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-ItemPropertyValue&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Path&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;HKLM:\SOFTWARE\Microsoft\System Center\2010\Common\Database&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;DatabaseName&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Host&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Error automatically gathering the SCOM SQL instance name: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ForegroundColor&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Red&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Uncomment the below lines to set the SQL Server manually instead of trying to automatically grab the information from the registry&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# $SQLServerAddress = &quot;SQL01-2019&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# $SQLServerOpsDatabase = &quot;OperationsManager&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Load the AzMan assembly&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Reflection.Assembly&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;LoadWithPartialName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;AzRoles&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Create a new AzAuthorizationStore object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$azStore&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ComObject&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AzRoles.AzAuthorizationStore&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Initialize the authorization store; replace with your SQL AzMan store connection string&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$azStore&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Initialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;mssql://Driver={SQL Server};Server={&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SQLServerAddress&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;};/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SQLServerOpsDatabase&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/AzmanStore&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Host&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Connection to AzMan store successful.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ForegroundColor&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Green&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Optionally, list applications in the AzMan store to further verify connectivity&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#$azStore.GetApplications() | ForEach-Object { Write-Host $_.Name }&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Catch any exceptions and display the error message&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Host&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Connection failed: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ForegroundColor&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Red&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you are affected you will see an output of:&lt;/p&gt;
&lt;pre&gt;
&lt;span style=&quot;color:red&quot;&gt;Connection failed: The security ID structure is invalid. (Exception from HRESULT: 0x80070539)&lt;/span&gt;
&lt;/pre&gt;

&lt;p&gt;OR&lt;/p&gt;

&lt;h3 id=&quot;gui-method&quot;&gt;GUI Method&lt;/h3&gt;

&lt;ol&gt;
  &lt;li&gt;Open Authorization Manager. Open a run box and type in:
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;AzMan.msc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;Press &lt;strong&gt;Enter&lt;/strong&gt; and you will see the Authorization Manager Window. &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/azman-window.PNG&quot; alt=&quot;Authorization Manager Main Window&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Right Click the text Authorization Manager in the left box, select &lt;strong&gt;Open Authorization Store‚Ä¶&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/azman-window-open-store.PNG&quot; alt=&quot;Open Authorization Store&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Select &lt;strong&gt;&lt;u&gt;M&lt;/u&gt;icrosoft SQL&lt;/strong&gt; and enter into the &lt;strong&gt;Store name&lt;/strong&gt; text box: 
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;mssql://Driver={SQL Server};Server={&amp;lt;SQLServer\Instance,OptionalPort&amp;gt;};/&amp;lt;OpsDatabaseName&amp;gt;/AzmanStore
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;Press &lt;strong&gt;Enter&lt;/strong&gt;. &lt;br /&gt;
You will see the following pop-up: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Cannot open the authorization store. The following problem occurred: The security ID structure is invalid.&lt;/code&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/azman-set-store.png&quot; alt=&quot;AzMan Set Store Error Example&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;mag-find-and-fix-the-issue-in-sql&quot;&gt;:mag: Find and fix the issue in SQL&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;Run the following query to determine the DB Owner for the databases:
    &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DatabaseName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SUSER_SNAME&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;owner_sid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DatabaseOwner&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;databases&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;OR &lt;br /&gt;
You can also see the DB Owner via SQL Server Management Studio.&lt;/p&gt;
    &lt;ol&gt;
      &lt;li&gt;Locate the Operations Manager or Operations Manager Data Warehouse Database in the Object Explorer view.&lt;/li&gt;
      &lt;li&gt;Right Click the Database and select &lt;strong&gt;Properties&lt;/strong&gt;.&lt;/li&gt;
      &lt;li&gt;Click on &lt;strong&gt;Files&lt;/strong&gt; and on the top is the DB Owner.
&lt;img src=&quot;/assets/img/posts/sql-db-owner.png&quot; alt=&quot;SQL DB Owner Example&quot; class=&quot;img-fluid&quot; /&gt; &lt;br /&gt;
Verify the account is not a local SQL account. I usually just set this to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;sa&lt;/code&gt;, as it is a built-in account that will not expire. But be aware as it can be disabled.&lt;/li&gt;
      &lt;li&gt;Run the following query to determine if a local sql account has db_owner permission on the Operations Manager Database &lt;em&gt;(the query is read only)&lt;/em&gt;:
        &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DB_Users&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;TABLE&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DBName&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sysname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;UserName&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sysname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LoginType&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sysname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;AssociatedRole&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;varchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;max&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create_date&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;datetime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;modify_date&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;datetime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;INSERT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DB_Users&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;EXEC&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sp_MSforeachdb&lt;/span&gt;

&lt;span class=&quot;s1&quot;&gt;&apos;
use [?]
SELECT &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; AS DB_Name,
case prin.name when &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;dbo&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; then prin.name + &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; (&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;+ (select SUSER_SNAME(owner_sid) from master.sys.databases where name =&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;?&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;) + &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt; else prin.name end AS UserName,
prin.type_desc AS LoginType,
isnull(USER_NAME(mem.role_principal_id),&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;&apos;&apos;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;) AS AssociatedRole ,create_date,modify_date
FROM sys.database_principals prin
LEFT OUTER JOIN sys.database_role_members mem ON prin.principal_id=mem.member_principal_id
WHERE prin.sid IS NOT NULL and prin.sid NOT IN (0x00) and
prin.is_fixed_role &amp;lt;&amp;gt; 1 AND prin.name NOT LIKE &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;##%&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;dbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;logintype&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create_date&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;modify_date&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;STUFF&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;,&apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CONVERT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;VARCHAR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;500&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;associatedrole&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DB_Users&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user2&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;user1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DBName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DBName&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AND&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UserName&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;user2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UserName&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FOR&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;XML&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PATH&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Permissions_user&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DB_Users&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;user1&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;LoginType&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;SQL_USER&apos;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;UserName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;dbo (sa)&apos;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;UserName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;MS_DataCollectorInternalUser&apos;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;GROUP&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;BY&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;dbname&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;username&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;logintype&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;create_date&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;modify_date&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;ORDER&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;BY&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DBName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;username&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;        &lt;/div&gt;
      &lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;You can use the following query to edit the User Mapping for the local SQL account and remove the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;db_owner&lt;/code&gt; role: &lt;br /&gt;
(&lt;em&gt;Example Local Account Name:&lt;/em&gt; &lt;strong&gt;&lt;em&gt;LocalSQLAccount&lt;/em&gt;&lt;/strong&gt; &amp;lt;‚Äì Replace with your SQL account)
    &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;n&quot;&gt;USE&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;OperationsManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;EXEC&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sp_droprolemember&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;db_owner&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;LocalSQLAccount&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;OR &lt;br /&gt;
 You can edit via SQL Server Management Studio.&lt;/p&gt;
    &lt;ol&gt;
      &lt;li&gt;Go to &lt;strong&gt;Security&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Logins&lt;/strong&gt;, locate the local SQL account, Right Click and go to &lt;strong&gt;Properties&lt;/strong&gt;.&lt;/li&gt;
      &lt;li&gt;Go to &lt;strong&gt;User Mapping&lt;/strong&gt; and select the Operations Manager or Operations Manager Data Warehouse database.&lt;/li&gt;
      &lt;li&gt;Scroll in the &lt;strong&gt;Database role membership&lt;/strong&gt; panel until you see &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;db_owner&lt;/code&gt;, uncheck it and press &lt;strong&gt;OK&lt;/strong&gt;. &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/sql-db-owner-usermapping.png&quot; alt=&quot;SQL Server Management Studio - User Mapping for Local SQL User&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
    &lt;/ol&gt;
  &lt;/li&gt;
  &lt;li&gt;Restart the &lt;strong&gt;System Center Operations Manager Data Access Service&lt;/strong&gt; (omsdk) on the Management Servers:
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Restart-Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;OMSDK&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Leave some feedback if this helped you! :v:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scom-azman-issue/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Welcome to GitHub Pages

You can use the [editor on GitHub](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/edit/master/docs/index.md) to maintain and preview the content for your website in Markdown files.

Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>October 12, 2023</pubDate>
        <link>https://blakedrumm.com/blog/scom-azman-issue/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scom-azman-issue/</guid>
      </item>
    
      <item>
        <title>SCOM License Expired</title>
        <postImage>/assets/img/posts/scom-activation.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;
&lt;p&gt;We attempted to activate the expired license for SCOM but we were unable due to the expiration of the product. The following errors would show when attempting to activate via PowerShell. These errors would show every time we try to activate:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Set-SCOMLicense : Unable to proceed with the command. Ensure you are connecting to correct Management Server and have sufficient privileges to execute the command. 
At line:1 char:1
+ Set-SCOMLicense -ManagementServer localhost -ProductId BZX70-NQZUT-SS ...
+ ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : InvalidOperation: (BZX70-NQZUT-SSFEQ-7PWWZ-9ZOQC:String) [Set-SCOMLicense], InvalidOperationException
    + FullyQualifiedErrorId : InvalidOperation,Microsoft.SystemCenter.OperationsManagerV10.Commands.Commands.AdministrationCmdlets.SetSCOMLicense
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;At the same time two consecutive events are logged in the Application Log:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Log Name:      Application 
Source:        .NET Runtime
Event ID:      1026
Task Category: None
Level:         Error
Keywords:      Classic
User:          N/A
Description:
Application: MonitoringHost.exe
Framework Version: v4.0.30319
Description: The process was terminated due to an unhandled exception.
Exception Info: System.UnauthorizedAccessException
   at Microsoft.EnterpriseManagement.Common.Internal.ExceptionHandlers.HandleChannelExceptions(System.Exception)
   at Microsoft.EnterpriseManagement.Common.Internal.SdkDataLayerProxyCore.CreateEndpoint[[System.__Canon, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]](Microsoft.EnterpriseManagement.EnterpriseManagementConnectionSettings, Microsoft.EnterpriseManagement.Common.Internal.SdkChannelObject`1&amp;lt;Microsoft.EnterpriseManagement.Common.Internal.IDispatcherService&amp;gt;)
   at Microsoft.EnterpriseManagement.Common.Internal.SdkDataLayerProxyCore.ConstructEnterpriseManagementGroupInternal[[System.__Canon, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089],[System.__Canon, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]](Microsoft.EnterpriseManagement.EnterpriseManagementConnectionSettings, Microsoft.EnterpriseManagement.DataAbstractionLayer.ClientDataAccessCore)
   at Microsoft.EnterpriseManagement.Common.Internal.SdkDataLayerProxyCore.RetrieveEnterpriseManagementGroupInternal[[System.__Canon, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089],[System.__Canon, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]](Microsoft.EnterpriseManagement.EnterpriseManagementConnectionSettings, Microsoft.EnterpriseManagement.DataAbstractionLayer.ClientDataAccessCore)
   at Microsoft.EnterpriseManagement.Common.Internal.SdkDataLayerProxyCore.Connect[[System.__Canon, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089],[System.__Canon, mscorlib, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089]](Microsoft.EnterpriseManagement.EnterpriseManagementConnectionSettings, Microsoft.EnterpriseManagement.DataAbstractionLayer.ClientDataAccessCore)
   at Microsoft.EnterpriseManagement.ManagementGroup.InternalInitialize(Microsoft.EnterpriseManagement.EnterpriseManagementConnectionSettings, Microsoft.EnterpriseManagement.ManagementGroupInternal)
   at Microsoft.EnterpriseManagement.ManagementGroup.Connect(System.String)
   at Microsoft.EnterpriseManagement.Mom.ValidateAlertSubscriptionModule.ValidateAlertSubscriptionDataSource.ValidateAlertSubscriptions(System.Object)
   at System.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object, Boolean)
   at System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object, Boolean)
   at System.Threading.TimerQueueTimer.CallCallback()
   at System.Threading.TimerQueueTimer.Fire()
   at System.Threading.TimerQueue.FireNextTimers()
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;and&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Log Name:      Application 
Source:        Application Error
Event ID:      1000
Task Category: (100)
Level:         Error
Keywords:      Classic
User:          N/A
Description:
Faulting application name: MonitoringHost.exe, version: 10.19.10014.0, time stamp: 0x5c45e51b
Faulting module name: KERNELBASE.dll, version: 10.0.14393.5582, time stamp: 0x63882301
Exception code: 0xe0434352
Fault offset: 0x0000000000026ea8
Faulting process id: 0xaf4
Faulting application start time: 0x01d937237975b89c
Faulting application path: C:\Program Files\Microsoft System Center\Operations Manager\Server\MonitoringHost.exe
Faulting module path: C:\Windows\System32\KERNELBASE.dll
Report Id: 21ffc48d-66ca-4aab-9967-47b2201d498f
Faulting package full name: 
Faulting package-relative application ID: 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;page_with_curl-how-to-fix-it&quot;&gt;:page_with_curl: How to fix it&lt;/h2&gt;
&lt;p&gt;Follow the below steps to allow you to fix the Activation issue:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Run the following PowerShell script on your Management Server to unregister the Time Service, set the date 48 hours ahead of the date SCOM was installed on the Management Server, and finally restarting the SCOM services.
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Unregister the Time Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;W32tm&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;/unregister&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

 &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Stop the Time Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Stop-Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;w32time&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

 &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Set the Operating System date 48 hours ahead of the InstalledOn date that is in the registry&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set-Date&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DateTime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ParseExact&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-ItemProperty&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Path&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;HKLM:\SOFTWARE\Microsoft\Microsoft Operations Manager\3.0\Setup&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;InstalledOn&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;M/d/yyyy-HH:mm:ss&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AddHours&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;48&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

 &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Restart the SCOM Services (System Center Data Access Service, System Center Management Configuration, Microsoft Monitoring Agent)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
 &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Restart-Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;omsdk&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;cshost&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;healthservice&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Verify the time has been changed.&lt;/li&gt;
  &lt;li&gt;Open the SCOM Console and navigate to the top of the Console window, click on &lt;strong&gt;Help&lt;/strong&gt; -&amp;gt; &lt;strong&gt;About&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/scom-console-help.png&quot; alt=&quot;SCOM Console Help -&amp;gt; About&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Click on Activate and type in your License key: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/scom-activation.png&quot; alt=&quot;SCOM Console Activation - Help -&amp;gt; About&quot; class=&quot;img-fluid&quot; /&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/scom-activation-button.png&quot; alt=&quot;SCOM Console Activation - Activation Window&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Accept the license agreement: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/scom-activation-license-agreement.png&quot; alt=&quot;SCOM Console Activation Agreement&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Successfully activated! &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/scom-activation-licensed-successfully.png&quot; alt=&quot;SCOM Console Activation Successful&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Register the Time Service to revert the changes made above, close the SCOM Console, and finally restart the SCOM SDK Service (System Center Data Access Service):
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Register the Time Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;W32tm&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;/register&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Close the SCOM Console&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Stop-Process&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Microsoft.EnterpriseManagement.Monitoring.Console&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Force&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
   
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Restart the SCOM SDK Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Restart-Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;omsdk&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Open the SCOM Console and verify if you go to &lt;strong&gt;Help&lt;/strong&gt; -&amp;gt; &lt;strong&gt;About&lt;/strong&gt;. Do you see &lt;strong&gt;(Eval)&lt;/strong&gt; in the Console version? &lt;br /&gt;
If you see &lt;strong&gt;(Retail)&lt;/strong&gt; (as shown below), you are activated! :sun_behind_small_cloud: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/scom-activation-activated.png&quot; alt=&quot;SCOM Console Activation Successful&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scom-license-expired/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Welcome to GitHub Pages

You can use the [editor on GitHub](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/edit/master/docs/index.md) to maintain and preview the content for your website in Markdown files.

Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>September 25, 2023</pubDate>
        <link>https://blakedrumm.com/blog/scom-license-expired/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scom-license-expired/</guid>
      </item>
    
      <item>
        <title>SCOM UNIX/Linux - Failed to find a matching agent kit to install</title>
        <postImage>/assets/img/posts/RHEL8_unable_to_upgrade.png</postImage>
        <description>&lt;h2 id=&quot;what-is-the-problem&quot;&gt;What is the problem?&lt;/h2&gt;

&lt;p&gt;The latest version of the UNIX/Linux Management Pack includes a hotfix for compiler mitigated OMI support. The KB (5028684) needs to be applied, which needs to be applied on the SCOM Management Server and SCOM Console components installed in your environment.&lt;/p&gt;

&lt;h3 id=&quot;unixlinux-versions&quot;&gt;UNIX/Linux versions&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;Linux Agent version:&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1.7.1-0&lt;/code&gt; &lt;br /&gt;
&lt;strong&gt;SCOM 2022 (&lt;em&gt;10.22.1052.0&lt;/em&gt;):&lt;/strong&gt; &lt;a href=&quot;https://www.microsoft.com/download/details.aspx?id=104213&quot;&gt;https://www.microsoft.com/download/details.aspx?id=104213&lt;/a&gt; &lt;br /&gt;
&lt;strong&gt;SCOM 2019 (&lt;em&gt;10.19.1226.0&lt;/em&gt;):&lt;/strong&gt; &lt;a href=&quot;https://www.microsoft.com/download/details.aspx?id=58208&quot;&gt;https://www.microsoft.com/download/details.aspx?id=58208&lt;/a&gt; &lt;br /&gt;
&lt;strong&gt;SCOM 2016 (&lt;em&gt;7.6.1185.0&lt;/em&gt;):&lt;/strong&gt; &lt;a href=&quot;https://www.microsoft.com/download/details.aspx?id=29696&quot;&gt;https://www.microsoft.com/download/details.aspx?id=29696&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/linux-mp-1.7.1-0.png&quot; alt=&quot;Linux Agent versions&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;how-to-fix&quot;&gt;How to fix&lt;/h2&gt;
&lt;p&gt;Download the hotfix listed here: &lt;br /&gt;
&lt;a href=&quot;https://support.microsoft.com/kb/5028684&quot;&gt;https://support.microsoft.com/kb/5028684&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You must apply the hotfix on the SCOM Management Server and SCOM Console components installed in your environment.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/failed-to-find-a-matching-agent-kit-to-install//&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Welcome to GitHub Pages

You can use the [editor on GitHub](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/edit/master/docs/index.md) to maintain and preview the content for your website in Markdown files.

Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>August 14, 2023</pubDate>
        <link>https://blakedrumm.com/blog/failed-to-find-a-matching-agent-kit-to-install/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/failed-to-find-a-matching-agent-kit-to-install/</guid>
      </item>
    
      <item>
        <title>SCOM ETL Trace Gathering Script</title>
        <postImage>/assets/img/posts/etl_trace.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;
&lt;p&gt;This Tool will assist you in gathering ETL Traces. You have the options of selecting specific Tracing to gather with this script.&lt;/p&gt;

&lt;p&gt;The script will perform the following, in this order:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Stops any existing ETL Traces
    &lt;ul&gt;
      &lt;li&gt;&lt;em&gt;Optional:&lt;/em&gt; Stops the SCOM Services&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Starts the ETL Trace
    &lt;ul&gt;
      &lt;li&gt;&lt;em&gt;Optional:&lt;/em&gt; Starts the SCOM Services back up&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Script will wait for issue to occur
    &lt;ul&gt;
      &lt;li&gt;&lt;em&gt;Default:&lt;/em&gt; Pauses Script, waits until you press Enter&lt;/li&gt;
      &lt;li&gt;&lt;em&gt;Optional:&lt;/em&gt; Sleeps for x Seconds (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-SleepSeconds 10&lt;/code&gt;)&lt;/li&gt;
      &lt;li&gt;&lt;em&gt;Optional:&lt;/em&gt; Script will loop until an Event ID is detected  (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-DetectOpsMgrEventID&lt;/code&gt;)&lt;/li&gt;
      &lt;li&gt;&lt;em&gt;Optional:&lt;/em&gt; Script can sleep for any amount of seconds after an Event is detected. (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-SleepAfterEventDetection&lt;/code&gt;)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Stops ETL Trace&lt;/li&gt;
  &lt;li&gt;&lt;em&gt;Optional:&lt;/em&gt; Script can attempt to Format the ETL Trace (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-FormatTrace&lt;/code&gt;)&lt;/li&gt;
  &lt;li&gt;Zips Up Output and Opens Explorer Window for Viewing File&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;arrow_down-how-to-get-it&quot;&gt;:arrow_down: How to get it&lt;/h2&gt;
&lt;p&gt;You can get a copy of the script here: &lt;br /&gt;
&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/SCOM%20ETL%20Trace/Start-ScomETLTrace.ps1&quot;&gt;Start-ScomETLTrace.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Direct Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Start-ScomETLTrace.ps1&quot;&gt;Personal File Server - Start-ScomETLTrace.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Alternative Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Start-ScomETLTrace.txt&quot;&gt;Personal File Server - Start-ScomETLTrace.txt&lt;/a&gt; :arrow_left: &lt;strong&gt;Text Format Alternative Download Link&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;page_with_curl-how-to-use-it&quot;&gt;:page_with_curl: How to use it&lt;/h2&gt;
&lt;p&gt;Open Powershell Prompt as Administrator:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;h4 id=&quot;examples&quot;&gt;Examples&lt;/h4&gt;
  &lt;h5 id=&quot;all-available-commands&quot;&gt;All Available Commands&lt;/h5&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Start-ScomETLTrace.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetAdvisor&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetApmConnector&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetBID&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetConfigService&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetDAS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetFailover&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetManaged&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetNASM&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetNative&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetScript&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetUI&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-VerboseTrace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DebugTrace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-NetworkTrace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SleepSeconds&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-RestartSCOMServices&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DetectOpsMgrEventID&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;

  &lt;h6 id=&quot;get-verbose-native-etl-trace&quot;&gt;Get Verbose Native ETL Trace&lt;/h6&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Start-ScomETLTrace.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetNative&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-VerboseTrace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;

  &lt;blockquote&gt;
    &lt;h6 id=&quot;get-verbose-native-etl-trace-and-format-the-trace&quot;&gt;Get Verbose Native ETL Trace and Format the trace&lt;/h6&gt;
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Start-ScomETLTrace.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetNative&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-VerboseTrace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-FormatTrace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/blockquote&gt;

  &lt;h6 id=&quot;gather-verbose-etl-trace-and-detect-for-1210-event-id-sleep-for-30-seconds-between-checks&quot;&gt;Gather Verbose ETL Trace and detect for 1210 Event ID (Sleep for 30 Seconds between checks)&lt;/h6&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Start-ScomETLTrace.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-VerboseTrace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DetectOpsMgrEventID&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;1210&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SleepSeconds&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;

  &lt;blockquote&gt;
    &lt;h6 id=&quot;gather-verbose-etl-trace-and-detect-for-1210-event-id-sleep-for-30-seconds-between-checks-and-sleep-for-10-seconds-after-finding-the-event-id&quot;&gt;Gather Verbose ETL Trace and detect for 1210 Event ID (Sleep for 30 Seconds between checks) and sleep for 10 seconds after finding the Event ID&lt;/h6&gt;
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Start-ScomETLTrace.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-VerboseTrace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DetectOpsMgrEventID&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;1210&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SleepSeconds&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SleepAfterEventDetection&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/blockquote&gt;

  &lt;h6 id=&quot;restart-scom-services-after-starting-an-etl-trace-sleep-for-2-minutes-and-stop-the-trace-automatically&quot;&gt;Restart SCOM Services after starting an ETL Trace. Sleep for 2 Minutes and stop the Trace Automatically&lt;/h6&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Start-ScomETLTrace.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Sleep&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;120&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-RestartSCOMServices&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;

  &lt;h4 id=&quot;get-all-etl-traces&quot;&gt;Get All ETL Traces&lt;/h4&gt;
  &lt;h6 id=&quot;get-verbose-tracing-for-all-the-default-tracing-available-just-like-running-this--getadvisor--getapmconnector--getbid--getconfigservice--getdas--getfailover--getmanaged--getnasm--getnative--getscript--getui&quot;&gt;Get Verbose Tracing for all the Default Tracing Available (just like running this: -GetAdvisor -GetApmConnector -GetBID -GetConfigService -GetDAS -GetFailover -GetManaged -GetNASM -GetNative -GetScript -GetUI)&lt;/h6&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Start-ScomETLTrace.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-VerboseTrace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;

  &lt;h6 id=&quot;get-debug-tracing-for-all-the-default-tracing-available-just-like-running-this--getadvisor--getapmconnector--getbid--getconfigservice--getdas--getfailover--getmanaged--getnasm--getnative--getscript--getui&quot;&gt;Get Debug Tracing for all the Default Tracing Available (just like running this: -GetAdvisor -GetApmConnector -GetBID -GetConfigService -GetDAS -GetFailover -GetManaged -GetNASM -GetNative -GetScript -GetUI)&lt;/h6&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Start-ScomETLTrace.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DebugTrace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;

  &lt;h6 id=&quot;get-verbose-tracing-for-all-the-default-tracing-available-and-network-tracing-just-like-running-this--getadvisor--getapmconnector--getbid--getconfigservice--getdas--getfailover--getmanaged--getnasm--getnative--getscript--getui&quot;&gt;Get Verbose Tracing for all the Default Tracing Available and Network Tracing (just like running this: -GetAdvisor -GetApmConnector -GetBID -GetConfigService -GetDAS -GetFailover -GetManaged -GetNASM -GetNative -GetScript -GetUI)&lt;/h6&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Start-ScomETLTrace.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-VerboseTrace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-NetworkTrace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;

  &lt;h6 id=&quot;get-verbose-tracing-for-all-the-default-tracing-available-and-opsmgrmodulelogging-for-linux-related-issues&quot;&gt;Get Verbose Tracing for all the Default Tracing Available and OpsMgrModuleLogging for Linux Related Issues&lt;/h6&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Start-ScomETLTrace.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-VerboseTrace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-OpsMgrModuleLogging&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/blockquote&gt;

&lt;p&gt;Leave some feedback if this helped you! :v:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scom-etl-trace/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>June 30, 2023</pubDate>
        <link>https://blakedrumm.com/blog/scom-etl-trace/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scom-etl-trace/</guid>
      </item>
    
      <item>
        <title>Enforce TLS 1.2 &amp; TLS 1.3 in SCOM - The PowerShell Way!</title>
        <postImage>/assets/img/posts/enforce-tls-1-2-scom.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;
&lt;p&gt;This PowerShell script will allow you to enforce TLS 1.2 &amp;amp; TLS 1.3 in your SCOM Environment to help you to secure your environment. (A big thank you to Kevin Holman for the original creation of his &lt;a href=&quot;https://kevinholman.com/2018/05/06/implementing-tls-1-2-enforcement-with-scom/&quot;&gt;TLS 1.2 enforcement script&lt;/a&gt;, which this script originated from.) It will attempt to auto download the prerequisites if they are not present in the local directory (or if you set the parameter &lt;strong&gt;DirectoryForPrerequisites&lt;/strong&gt; to another path it will check there). The script from a high level will do the following:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Creates a log file to Program Data (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\ProgramData\SCOM_TLS_1.2_-_&amp;lt;Month&amp;gt;-&amp;lt;Day&amp;gt;-&amp;lt;Year&amp;gt;.log&lt;/code&gt;).&lt;/li&gt;
  &lt;li&gt;Locate or Download the prerequisites for TLS 1.2 Enforcement.&lt;/li&gt;
  &lt;li&gt;Checks the SCOM Role (&lt;em&gt;Management Server, Web Console, ACS Collector&lt;/em&gt;).&lt;/li&gt;
  &lt;li&gt;Checks the version of System Center Operations Manager to confirm supportability of TLS enforcement.&lt;/li&gt;
  &lt;li&gt;Checks the .NET version to confirm you are on a valid version.&lt;/li&gt;
  &lt;li&gt;Checks the SQL version (on both the Operations Manager and Data Warehouse Database Instances) to confirm your version of SQL supports TLS enforcement.&lt;/li&gt;
  &lt;li&gt;Checks and/or installs the &lt;em&gt;(prerequisite software)&lt;/em&gt; MSOLEDB driver (or SQL Client).&lt;/li&gt;
  &lt;li&gt;Checks and/or installs the &lt;em&gt;(prerequisite software)&lt;/em&gt; ODBC driver.&lt;/li&gt;
  &lt;li&gt;Checks and/or modifies the registry to enforce TLS 1.2 (If your using Window Server 2022 (or newer) or Windows 11 (or newer) it will attempt to enforce TLS 1.2 &lt;strong&gt;and&lt;/strong&gt; TLS 1.3).&lt;/li&gt;
  &lt;li&gt;Ask to reboot the machine to finalize the configuration.&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&quot;classical_building-argument-list&quot;&gt;:classical_building: Argument List&lt;/h2&gt;

&lt;table class=&quot;table table-hover table-text d-block overflow-auto&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parameter&lt;/th&gt;
      &lt;th&gt;Alias&lt;/th&gt;
      &lt;th&gt;ValueFromPipeline&lt;/th&gt;
      &lt;th&gt;Type&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;AssumeYes&lt;/td&gt;
      &lt;td&gt;yes&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Switch&lt;/td&gt;
      &lt;td&gt;The script will not ask any questions. Good for unattended runs.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;DirectoryForPrerequisites&lt;/td&gt;
      &lt;td&gt;dfp&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;The directory to save / load the prerequisites from. Default is the current directory.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ForceDownloadPrerequisites&lt;/td&gt;
      &lt;td&gt;fdp&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Switch&lt;/td&gt;
      &lt;td&gt;Force download the prerequisites to the directory specified in DirectoryForPrerequisites.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SkipDotNetCheck&lt;/td&gt;
      &lt;td&gt;sdnc&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Switch&lt;/td&gt;
      &lt;td&gt;Skip the .NET Check step.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SkipDownloadPrerequisites&lt;/td&gt;
      &lt;td&gt;sdp&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Switch&lt;/td&gt;
      &lt;td&gt;Skip downloading the prerequisite files to current directory.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SkipModifyRegistry&lt;/td&gt;
      &lt;td&gt;smr&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;Skip any registry modifications.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SkipRoleCheck&lt;/td&gt;
      &lt;td&gt;src&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Switch&lt;/td&gt;
      &lt;td&gt;Skip the SCOM Role Check step.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SkipSQLQueries&lt;/td&gt;
      &lt;td&gt;ssq&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Switch&lt;/td&gt;
      &lt;td&gt;Skip any check for SQL version compatibility.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SkipSQLSoftwarePrerequisites&lt;/td&gt;
      &lt;td&gt;sssp&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Switch&lt;/td&gt;
      &lt;td&gt;Skip the ODBC, MSOLEDBSQL, and/or Microsoft SQL Server 2012 Native Client.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SkipVersionCheck&lt;/td&gt;
      &lt;td&gt;svc&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Switch&lt;/td&gt;
      &lt;td&gt;Skip SCOM Version Check step.&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;blockquote&gt;
  &lt;h2 id=&quot;notebook-note&quot;&gt;:notebook: Note&lt;/h2&gt;
  &lt;p&gt;You may edit line &lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/TLS%201.2%20Enforcement/Invoke-EnforceSCOMTLS1.2.ps1#L1904&quot;&gt;1904&lt;/a&gt; in the script to change what happens when the script is run without any arguments or parameters, this also allows you to change what happens when the script is run from the Powershell ISE.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;arrow_down-how-to-get-it&quot;&gt;:arrow_down: How to get it&lt;/h2&gt;
&lt;p&gt;You can get a copy of the script here: &lt;br /&gt;
&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/TLS%201.2%20Enforcement/Invoke-EnforceSCOMTLS1.2.ps1&quot;&gt;Invoke-EnforceSCOMTLS1.2.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Direct Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Invoke-EnforceSCOMTLS1.2.ps1&quot;&gt;Personal File Server - Invoke-EnforceSCOMTLS1.2.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Alternative Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Invoke-EnforceSCOMTLS1.2.txt&quot;&gt;Personal File Server - Invoke-EnforceSCOMTLS1.2.txt&lt;/a&gt; :arrow_left: &lt;strong&gt;Text Format Alternative Download Link&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;page_with_curl-how-to-use-it&quot;&gt;:page_with_curl: How to use it&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;h4 id=&quot;example-1&quot;&gt;Example 1&lt;/h4&gt;
  &lt;p&gt;Normal run:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Invoke-EnforceSCOMTLS1.2.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-2&quot;&gt;Example 2&lt;/h4&gt;
  &lt;p&gt;Set the prerequisites folder:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Invoke-EnforceSCOMTLS1.2.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DirectoryForPrerequisites&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;C:\Temp&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-3&quot;&gt;Example 3&lt;/h4&gt;
  &lt;p&gt;Assume yes to all questions asked by script:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Invoke-EnforceSCOMTLS1.2.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AssumeYes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;check-tls-configuration&quot;&gt;Check TLS Configuration&lt;/h2&gt;
&lt;p&gt;You can run the following PowerShell script to gather your current TLS configuration:&lt;/p&gt;
&lt;h3 id=&quot;arrow_down-how-to-get-it-1&quot;&gt;:arrow_down: How to get it&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/Get-TLSRegistryKeys.ps1&quot;&gt;Get-TLSRegistryKeys.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Direct Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Get-TLSRegistryKeys.ps1&quot;&gt;Personal File Server - Get-TLSRegistryKeys.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Alternative Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Get-TLSRegistryKeys.txt&quot;&gt;Personal File Server - Get-TLSRegistryKeys.txt&lt;/a&gt; :arrow_left: &lt;strong&gt;Text Format Alternative Download Link&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/check-tlssettings.png&quot; alt=&quot;Script example showing how TLS is configured&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;Leave some feedback if this helped you! :v:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/enforce-tls-1-2-scom/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>May 25, 2023</pubDate>
        <link>https://blakedrumm.com/blog/enforce-tls-1-2-scom/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/enforce-tls-1-2-scom/</guid>
      </item>
    
      <item>
        <title>How to Decommission SCOM Gateway</title>
        <postImage>/assets/img/posts/scom-gateway-decommission.png</postImage>
        <description>&lt;h2 id=&quot;the-steps-required&quot;&gt;The Steps Required&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;Move any agents (Agents or Agentless) assigned to the Gateway to another server.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Uninstall the SCOM Gateway through programs and features.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Delete the Gateway with the Gateway Approval Tool.&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;p&gt;The Microsoft.EnterpriseManagement.GatewayApprovalTool.exe tool is needed only on the management server, and it only has to be run once.&lt;/p&gt;

      &lt;p&gt;To copy Microsoft.EnterpriseManagement.GatewayApprovalTool.exe to management servers
From a target management server, open the Operations Manager installation media &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;\SupportTools\&lt;/code&gt; (amd64 or x86) directory.&lt;/p&gt;

      &lt;p&gt;Copy the &lt;strong&gt;&lt;em&gt;Microsoft.EnterpriseManagement.GatewayApprovalTool.exe&lt;/em&gt;&lt;/strong&gt; from the installation media to the Operations Manager installation directory.&lt;/p&gt;
    &lt;/blockquote&gt;

    &lt;p&gt;The command to delete a SCOM Gateway:&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; Microsoft.EnterpriseManagement.GatewayApprovalTool.exe /ManagementServerName=&amp;lt;managementserverFQDN&amp;gt; /GatewayName=&amp;lt;GatewayFQDN&amp;gt; /Action=Delete
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Kevin Holman has a good guide for Management Server‚Äôs here (which some items apply for Gateway‚Äôs as well): &lt;a href=&quot;https://kevinholman.com/2016/02/03/checklist-removing-migrating-old-management-servers-to-new-ones/&quot;&gt;https://kevinholman.com/2016/02/03/checklist-removing-migrating-old-management-servers-to-new-ones/&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;powershell-script-to-move-agentless-managed-machines&quot;&gt;Powershell Script to move Agentless-Managed Machines&lt;/h2&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#Author: Blake Drumm (blakedrumm@microsoft.com)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Date: August 8th, 2023&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#------------------------------- &lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Variables Section &lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#------------------------------- &lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$FromGatewayServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;GW01-2019.contoso-2019.com&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Management Server or Gateway Server to move FROM&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ToGatewayServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;MS01-2019.contoso-2019.com&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Management Server or Gateway Server to move TO &lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#-------------------------------&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$MSList&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMManagementServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$FromGatewayServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$MSList&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Where-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-match&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$FromGatewayServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ToGatewayServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$MSList&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Where-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-match&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ToGatewayServer&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMAgentlessManagedComputer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Where-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ProxyAgentPrincipalName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-match&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$FromGatewayServer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DisplayName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set-SCOMAgentlessManagedComputer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ManagedByManagementServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ToGatewayServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-PassThru&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; 
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;powershell-script-to-move-agents&quot;&gt;Powershell Script to move Agents&lt;/h2&gt;

&lt;p&gt;You can find the below script (and others) here: &lt;br /&gt;
&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/tree/master/Powershell/Agents%20Failover&quot;&gt;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/tree/master/Powershell/Agents%20Failover&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Replace the following variables before running:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;lt;MoveFrom_MS&amp;gt;
&amp;lt;MoveToPrimary_MS&amp;gt;
&amp;lt;MoveToSecondary_MS&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Be aware, the machines will need to be remotely manageable before you can run the below script. More information here: &lt;a href=&quot;https://kevinholman.com/2010/02/20/how-to-get-your-agents-back-to-remotely-manageable-in-scom/&quot;&gt;https://kevinholman.com/2010/02/20/how-to-get-your-agents-back-to-remotely-manageable-in-scom/&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# ===============================&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Author: Blake Drumm (blakedrumm@microsoft.com)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Created: September 30th, 2022&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Modified: September 30th, 2022&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Script location: https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/Agents%20Failover/Set-AgentFailover.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# ===============================&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Import-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;OperationsManager&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#===================================================================&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#region Script Variables&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#We will look for all Agents Managed by this Management Server.&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$movefromManagementServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMManagementServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;MoveFrom_MS&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Primary Management Server&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$movetoPrimaryMgmtServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMManagementServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;MoveToPrimary_MS&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Secondary Management Server&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$movetoFailoverMgmtServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMManagementServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&amp;lt;MoveToSecondary_MS&amp;gt;&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Gather the System Center Agent Class so we can get the Agents:&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$scomAgent&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMClass&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Where-Object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-eq&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Microsoft.SystemCenter.Agent&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMClassInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#endregion Variables&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#===================================================================&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#===================================================================&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#region MainScript&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;foreach&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$agent&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$scomAgent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	
	&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Check the name of the current&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$scomAgentDetails&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMAgent&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ManagementServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$movefromManagementServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DisplayName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-match&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$agent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DisplayName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$scomAgentDetails&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Remove Failover Management Server&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$scomAgent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;) &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$agent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DisplayName&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n`t`t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Removing Failover&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$scomAgentDetails&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set-SCOMParentManagementServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-FailoverServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$null&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Out-Null&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Set Primary Management Server&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`t`t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Current Primary: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$movefromManagementServer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DisplayName&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n`t`t&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Updating Primary to: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$movetoPrimaryMgmtServer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DisplayName&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$scomAgentDetails&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set-SCOMParentManagementServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-PrimaryServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$movetoPrimaryMgmtServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Out-Null&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$movetoFailoverMgmtServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$movetoFailoverMgmtServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-ne&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;&amp;lt;MoveToSecondary_MS&amp;gt;&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Set Secondary Management Server&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;               &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$agent&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DisplayName&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; Failover: &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$movetoFailoverMgmtServer&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DisplayName&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n`n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
			&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$scomAgentDetails&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set-SCOMParentManagementServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-FailoverServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$movetoFailoverMgmtServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Out-Null&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Verbose&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Unable to locate any data.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Script completed!&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#endregion MainScript&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#===================================================================&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/how-to-decommission-scom-gateway/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>April 25, 2023</pubDate>
        <link>https://blakedrumm.com/blog/how-to-decommission-scom-gateway/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/how-to-decommission-scom-gateway/</guid>
      </item>
    
      <item>
        <title>How to change SQL Server Reporting Services to use Kerberos instead of NTLM</title>
        <postImage>/assets/img/posts/sql-server-reporting-services.png</postImage>
        <description>&lt;p&gt;I had a customer ask if SCOM Reporting requires NTLM or not. So when I started digging for information on this, I found this blog post showing how to change SSRS to use Kerberos instead of NTLM:
&lt;a href=&quot;https://mscloud.be/systemcenter/uncategorized/how-to-change-scom-reporting-to-use-kerberos-instead-of-ntlm-2/&quot;&gt;How to change SCOM reporting to use Kerberos instead of NTLM - Cloud management at your fingertips (mscloud.be)&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;I found that the article is missing some screenshots and seems to no longer be maintained. So, I thought it would be a good time to publish something for this.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;book-what-is-kerberos-and-ntlm&quot;&gt;:book: What is Kerberos and NTLM&lt;/h2&gt;

&lt;p&gt;If you are wondering, what is NTLM? What is Kerberos? How do these help or hurt? This article goes into detail to explain the differences: &lt;br /&gt;
&lt;a href=&quot;https://www.geeksforgeeks.org/difference-between-kerberos-and-ntlm/&quot;&gt;Difference between Kerberos and NTLM&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;exclamation-scom-reporting-installation-quirk&quot;&gt;:exclamation: SCOM Reporting Installation Quirk&lt;/h2&gt;

&lt;p&gt;Something you need to take into account is that the SCOM installation for Reporting will overwrite the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsreportserver.config&lt;/code&gt; file and reverse any changes you may perform (which will set authentication back to NTLM). Which means you will need to apply the steps to change to Kerberos again &lt;strong&gt;AFTER&lt;/strong&gt; SCOM Reporting Installation.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;page_with_curl-how-to-change-ssrs-authentication&quot;&gt;:page_with_curl: How to change SSRS Authentication&lt;/h2&gt;

&lt;h3 id=&quot;memo-manually-change-ssrs-authentication&quot;&gt;:memo: Manually change SSRS Authentication&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;To change the report server authentication settings, edit the value in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;rsreportserver.config&lt;/code&gt; file:
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\Program Files\Microsoft SQL Server Reporting Services\SSRS\ReportServer\rsreportserver.config
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;Replace &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RSWindowsNTLM&lt;/code&gt; with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;RSWindowsNegotiate&lt;/code&gt; in the config file.&lt;/p&gt;

    &lt;p&gt;My config file: &lt;a href=&quot;https://files.blakedrumm.com/rsreportserver.config&quot;&gt;https://files.blakedrumm.com/rsreportserver.config&lt;/a&gt;&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;zap-automatically-change-ssrs-authentication-with-powershell&quot;&gt;:zap: Automatically change SSRS Authentication with PowerShell&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;This script will allow you to automatically set the Authentication for SSRS to &lt;strong&gt;Windows Negotiate&lt;/strong&gt; instead of &lt;strong&gt;NTLM&lt;/strong&gt;:
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$RS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;root\Microsoft\SqlServer\ReportServer\&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-CimInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;root\Microsoft\SqlServer\ReportServer&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClassName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__Namespace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CimInstanceProperties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Select-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-First&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSV&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-CimInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClassName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Select-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-First&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;\Admin&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSInfo&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-CimInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSV&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClassName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;MSReportServer_ConfigurationSetting&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Content&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;PathName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;RSWindowsNTLM&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;RSWindowsNegotiate&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Out-File&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;PathName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Encoding&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;UTF8&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;page_with_curl-set-ssrs-spns&quot;&gt;:page_with_curl: Set SSRS SPN‚Äôs&lt;/h2&gt;

&lt;p&gt;Using RSWindowsNegotiate will result in a Kerberos authentication error if you configured the Report Server service to run under a domain user account and you did not register a Service Principal Name (SPN) for the account. For more information on SPN‚Äôs for SSRS see: &lt;br /&gt;
&lt;a href=&quot;https://learn.microsoft.com/sql/reporting-services/report-server/register-a-service-principal-name-spn-for-a-report-server&quot;&gt;Register a Service Principal Name (SPN) for a Report Server - SQL Server Reporting Services (SSRS) | Microsoft Learn&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;memo-check-ssrs-spns&quot;&gt;:memo: Check SSRS SPN‚Äôs&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;The following command allows you to check the SPN‚Äôs for the SSRS Server, you will need to replace the username with the service account running SSRS:
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;setspn -l &amp;lt;domain&amp;gt;\&amp;lt;domain-user-account&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;memo-manually-set-ssrs-spns&quot;&gt;:memo: Manually set SSRS SPN‚Äôs&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;The following command allows you to set the SPN‚Äôs for the SSRS Server:
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;setspn -s http/&amp;lt;computer-name&amp;gt;.&amp;lt;domain-name&amp;gt; &amp;lt;domain&amp;gt;\&amp;lt;domain-user-account&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;zap-automatically-set-ssrs-spns&quot;&gt;:zap: Automatically set SSRS SPN‚Äôs&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;The following script allows you to automatically set the SSRS SPN‚Äôs:
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$RS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;root\Microsoft\SqlServer\ReportServer\&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-CimInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;root\Microsoft\SqlServer\ReportServer&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClassName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__Namespace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CimInstanceProperties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Select-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-First&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSV&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-CimInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClassName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Select-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-First&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;\Admin&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSInfo&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-CimInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSV&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClassName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;MSReportServer_ConfigurationSetting&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Get Computer FQDN&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DNSComputerName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;COMPUTERNAME&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;.&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-CimInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Win32_ComputerSystem&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Domain&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Set SSRS SPN&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$setspn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setspn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;http/&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DNSComputerName&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSInfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WindowsServiceIdentityActual&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$setspn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-match&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;^Duplicate SPN found, aborting operation!$&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SPN is already set or duplicate SPN found.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Check SSRS SPN&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;setspn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSInfo&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;WindowsServiceIdentityActual&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;closed_lock_with_key-set-the-kerberos-aes-encryption-support&quot;&gt;:closed_lock_with_key: Set the Kerberos AES Encryption Support&lt;/h2&gt;
&lt;p&gt;Enable ‚ÄúThis account supports Kerberos AES 128 bit encryption.‚Äù and ‚ÄúThis account supports Kerberos AES 256 bit encryption.‚Äù&lt;/p&gt;

&lt;h3 id=&quot;memo-manually-set-the-kerberos-aes-encryption-support&quot;&gt;:memo: Manually set the Kerberos AES Encryption Support&lt;/h3&gt;
&lt;ol&gt;
  &lt;li&gt;Open a run box (&lt;strong&gt;Windows Key + R&lt;/strong&gt;).&lt;/li&gt;
  &lt;li&gt;Type in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;dsa.msc&lt;/code&gt; and press Enter.&lt;/li&gt;
  &lt;li&gt;Select the domain, right click and select &lt;strong&gt;Find&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Locate the Service Account for your &lt;strong&gt;Data Reader Account&lt;/strong&gt; and &lt;strong&gt;Data Access Service Account&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Open the properties and go to the Account Tab.&lt;/li&gt;
  &lt;li&gt;Scroll down in the &lt;strong&gt;Account options:&lt;/strong&gt; section and locate ‚ÄúThis account supports Kerberos AES 128 bit encryption.‚Äù and ‚ÄúThis account supports Kerberos AES 256 bit encryption.‚Äù &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/kerberos-aes-encryption.png&quot; alt=&quot;Example of Kerberos AES encryption support checkboxes (OMRead)&quot; class=&quot;img-fluid&quot; /&gt; &lt;br /&gt;
¬† &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/kerberos-aes-encryption-2.png&quot; alt=&quot;Example of Kerberos AES encryption support checkboxes (OMDAS)&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;zap-set-the-kerberos-aes-encryption-support-via-powershell&quot;&gt;:zap: Set the Kerberos AES Encryption Support via PowerShell&lt;/h3&gt;
&lt;p&gt;Enable Kerberos AES Encryption for &lt;strong&gt;OMDAS&lt;/strong&gt; (Data Access Service Account) and &lt;strong&gt;OMRead&lt;/strong&gt; (Data Reader account) via PowerShell, you only have to modify the bottom line in the below script to your UserNames:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cm&quot;&gt;&amp;lt;#
&lt;/span&gt;&lt;span class=&quot;cs&quot;&gt;.SYNOPSIS&lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;
This PowerShell script is designed to manage Kerberos AES encryption settings for specified user accounts in Active Directory.

&lt;/span&gt;&lt;span class=&quot;cs&quot;&gt;.DESCRIPTION&lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;
The Set-KerberosAESEncryption function enables or disables Kerberos Advanced Encryption Standard (AES) 128-bit and 256-bit encryption for given Active Directory user accounts. It provides options to either enable or disable these encryption settings based on the provided parameters.

The script uses the System.DirectoryServices.AccountManagement namespace for accessing and modifying the properties of Active Directory user accounts. It updates the &apos;msDS-SupportedEncryptionTypes&apos; property to set or unset AES 128 and AES 256 encryption types.

&lt;/span&gt;&lt;span class=&quot;cs&quot;&gt;.PARAMETER&lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;S
- UserNames: An array of user account names (strings) in Active Directory for which the encryption settings will be modified.
- EnableEncryption: A switch parameter. When used, the script sets the Kerberos AES 128 and 256-bit encryption for the specified user accounts.
- DisableEncryption: A switch parameter. When used, the script unsets the Kerberos AES 128 and 256-bit encryption for the specified user accounts.

.OUTPUT
The script outputs a table with the following columns for each user account processed:
- UserName: The name of the user account.
- PreviousEncryptionTypes: The encryption types (AES 128, AES 256, both, or Not Set) before the script execution.
- UpdatedEncryptionTypes: The encryption types after the script execution.
- UpdateApplied: Indicates whether an update was applied (&apos;Yes&apos; or &apos;No&apos;).

&lt;/span&gt;&lt;span class=&quot;cs&quot;&gt;.EXAMPLE&lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;
To enable Kerberos AES encryption for users &apos;OMDAS&apos; and &apos;OMRead&apos;:
Set-KerberosAESEncryption -UserNames @(&quot;OMDAS&quot;, &quot;OMRead&quot;) -EnableEncryption

&lt;/span&gt;&lt;span class=&quot;cs&quot;&gt;.EXAMPLE&lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;
To disable Kerberos AES encryption for users &apos;OMDAS&apos; and &apos;OMRead&apos;:
Set-KerberosAESEncryption -UserNames @(&quot;OMDAS&quot;, &quot;OMRead&quot;) -DisableEncryption

&lt;/span&gt;&lt;span class=&quot;cs&quot;&gt;.NOTES&lt;/span&gt;&lt;span class=&quot;cm&quot;&gt;
Ensure you have appropriate permissions to modify user properties in Active Directory before running this script. It&apos;s recommended to test the script in a non-production environment first.

  Author: Blake Drumm (blakedrumm@microsoft.com)
  Date Created: November 21st, 2023

#&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Add required assembly references&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Add-Type&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AssemblyName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;System.DirectoryServices.AccountManagement&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Function to manage Kerberos AES encryption settings&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Set-KerberosAESEncryption&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;param&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;string&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$UserNames&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EnableEncryption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DisableEncryption&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-NOT&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EnableEncryption&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-NOT&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DisableEncryption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Warning&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Missing required parameter: -EnableEncryption OR -DisableEncryption&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;break&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Define encryption type values&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$AES128&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x08&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$AES256&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x10&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Combine AES 128 and AES 256 bit encryption support&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$newEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$AES128&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-bor&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$AES256&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Function to convert encryption type value to readable format&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ConvertTo-EncryptionTypeName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;param&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$encryptionTypeValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;switch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$encryptionTypeValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;       &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Not Set&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x08&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;   &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;AES 128&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x10&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;   &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;AES 256&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;24&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;     &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;AES 128, AES 256&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Default&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Unknown&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Initialize an array to store output data&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$outputData&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;foreach&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$userName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$UserNames&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Create a principal context for the domain&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$context&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;System.DirectoryServices.AccountManagement.PrincipalContext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;System.DirectoryServices.AccountManagement.ContextType&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Domain&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

            &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Find the user&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$user&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;System.DirectoryServices.AccountManagement.UserPrincipal&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]::&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;FindByIdentity&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$context&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$userName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

            &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$user&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-ne&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Access the underlying DirectoryEntry&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$de&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$user&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;GetUnderlyingObject&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

                &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Get current encryption types&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$currentEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$de&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;msDS-SupportedEncryptionTypes&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$currentEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$currentEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-ne&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$currentEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-as&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

                &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Determine if update is needed&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$changeNeeded&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EnableEncryption&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$currentEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-ne&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$newEncryptionTypes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-or&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                                &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DisableEncryption&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$currentEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-ne&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

                &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Update encryption types if needed&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$changeNeeded&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$de&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;msDS-SupportedEncryptionTypes&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$EnableEncryption&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$newEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$null&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$de&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CommitChanges&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

                &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Add data to the output array&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$updatedEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$de&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Properties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;msDS-SupportedEncryptionTypes&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$updatedEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$updatedEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-ne&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$null&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$updatedEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-as&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

                &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$outputData&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;PSObject&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Property&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;@{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;UserName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$userName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;PreviousEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ConvertTo&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;EncryptionTypeName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;encryptionTypeValue&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$currentEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;UpdatedEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ConvertTo&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;EncryptionTypeName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;encryptionTypeValue&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$updatedEncryptionTypes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                    &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;UpdateApplied&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;err&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$changeNeeded&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Yes&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;No&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
                &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Warning&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;User &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$userName&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; not found.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
            &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Host&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Error updating user &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$userName&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`:&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

    &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Output the results in a single table&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$outputData&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Format-Table&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AutoSize&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Example usage of the function&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set-KerberosAESEncryption&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserNames&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;OMDAS&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;OMRead&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-EnableEncryption&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;memo-restart-ssrs-service&quot;&gt;:memo: Restart SSRS Service&lt;/h2&gt;

&lt;p&gt;The following script allows you to restart the SSRS Service:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;root\Microsoft\SqlServer\ReportServer\&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-CimInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;root\Microsoft\SqlServer\ReportServer&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClassName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__Namespace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CimInstanceProperties&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Select-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-First&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSV&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;\&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-CimInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClassName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;__Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Select-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-First&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;\Admin&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSInfo&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-CimInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Namespace&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSV&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ClassName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;MSReportServer_ConfigurationSetting&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

  &lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Restart SSRS Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Restart-Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$RSInfo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;ServiceName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/how-to-change-reporting-to-use-kerberos-instead-of-ntlm/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>April 19, 2023</pubDate>
        <link>https://blakedrumm.com/blog/how-to-change-reporting-to-use-kerberos-instead-of-ntlm/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/how-to-change-reporting-to-use-kerberos-instead-of-ntlm/</guid>
      </item>
    
      <item>
        <title>All Operations Manager Event ID&apos;s</title>
        <postImage>/assets/img/posts/operations-manager-event-log.png</postImage>
        <description>&lt;table id=&quot;scom_event_ids_table&quot; class=&quot;table table-dark table-hover table-sm&quot; data-toggle=&quot;table&quot; data-url=&quot;/assets/js/post_asset/scom_event_ids.json&quot; data-show-columns=&quot;true&quot; data-cookie=&quot;true&quot; data-cookie-id-table=&quot;saveId&quot; data-pagination=&quot;true&quot; data-search=&quot;true&quot; data-click-to-select=&quot;true&quot; data-show-copy-rows=&quot;true&quot; data-show-print=&quot;true&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th data-checkbox=&quot;true&quot;&gt;&lt;/th&gt;
      &lt;th scope=&quot;col&quot; data-field=&quot;Event&quot;&gt;Event&lt;/th&gt;
      &lt;th scope=&quot;col&quot; data-field=&quot;Source&quot;&gt;Source&lt;/th&gt;
      &lt;th scope=&quot;col&quot; data-field=&quot;Log Name&quot;&gt;Log Name&lt;/th&gt;
      &lt;th scope=&quot;col&quot; data-field=&quot;LongID&quot;&gt;LongID&lt;/th&gt;
      &lt;th scope=&quot;col&quot; data-field=&quot;Description&quot;&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
&lt;/table&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/excel-icon.png&quot; alt=&quot;Excel Icon&quot; class=&quot;img-fluid&quot; /&gt; &lt;br /&gt;
Link to download excel file: &lt;a href=&quot;https://files.blakedrumm.com/All%20SCOM%20Event%20Ids.xlsx&quot;&gt;https://files.blakedrumm.com/All%20SCOM%20Event%20Ids.xlsx&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/all-scom-event-ids/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>March 28, 2023</pubDate>
        <link>https://blakedrumm.com/blog/all-scom-event-ids/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/all-scom-event-ids/</guid>
      </item>
    
      <item>
        <title>SCOM Certificate Checker Script</title>
        <postImage>/assets/img/posts/scom-certificate-script.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;
&lt;p&gt;This tool will allow you to check your SCOM Certificate. It is very efficient and has been improved upon over time. You may edit line &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;751&lt;/code&gt; to allow you to change what happens when you run from Powershell ISE. Copying and pasting the script to Powershell ISE after you run MOMCertImport on a certificate is the most common way to run the script, which requires no arguments or modifications. Just run the script and you will see where the issue may be.&lt;/p&gt;

&lt;h2 id=&quot;memo-authors&quot;&gt;:memo: Authors&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Tyson Paul (&lt;strong&gt;&lt;em&gt;https://monitoringguys.com/&lt;/em&gt;&lt;/strong&gt;)&lt;/li&gt;
  &lt;li&gt;Lincoln Atkinson (&lt;strong&gt;&lt;em&gt;https://latkin.org/blog/&lt;/em&gt;&lt;/strong&gt;)&lt;/li&gt;
  &lt;li&gt;Mike Kallhoff&lt;/li&gt;
  &lt;li&gt;Blake Drumm (&lt;strong&gt;&lt;em&gt;https://blakedrumm.com/&lt;/em&gt;&lt;/strong&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;page_with_curl-where-to-get-it&quot;&gt;:page_with_curl: Where to get it&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/Test-SCOMCertificate.ps1&quot;&gt;Test-SCOMCertificate.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Direct Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Test-SCOMCertificate.ps1&quot;&gt;Personal File Server - Test-SCOMCertificate.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Alternative Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Test-SCOMCertificate.txt&quot;&gt;Personal File Server - Test-SCOMCertificate.txt&lt;/a&gt; :arrow_left: &lt;strong&gt;Text Format Alternative Download Link&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;classical_building-argument-list&quot;&gt;:classical_building: Argument List&lt;/h2&gt;

&lt;table class=&quot;table table-hover table-text d-block overflow-auto&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Argument¬†List¬†&lt;/th&gt;
      &lt;th&gt;Description¬†&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;-All¬†&lt;/td&gt;
      &lt;td&gt;Check¬†All¬†Certificates¬†in¬†Local¬†Machine¬†Store.¬†&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;-Servers¬†&lt;/td&gt;
      &lt;td&gt;Each¬†Server¬†you¬†want¬†to¬†Check¬†SCOM¬†Certificates¬†on.¬†&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;-SerialNumber¬†&lt;/td&gt;
      &lt;td&gt;Check¬†a¬†specific¬†Certificate¬†serial¬†number¬†in¬†the¬†Local¬†Machine¬†Personal¬†Store.¬†Not¬†reversed.¬†&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;-OutputFile¬†&lt;/td&gt;
      &lt;td&gt;Where¬†to¬†Output¬†the¬†File¬†(txt,¬†log,¬†etc)¬†for¬†Script¬†Execution.¬†&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;question-examples&quot;&gt;:question: Examples&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;h4 id=&quot;example-1&quot;&gt;Example 1&lt;/h4&gt;
  &lt;p&gt;Check the certificate you have currently configured for SCOM on the local machine:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C:\&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;\Test-SCOMCertificate.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-2&quot;&gt;Example 2&lt;/h4&gt;
  &lt;p&gt;Check for a specific Certificate Serial number in the Local Machine Personal Certificate store:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C:\&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;\Test-SCOMCertificate.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SerialNumber&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;1f00000008c694dac94bcfdc4a000000000008&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-3&quot;&gt;Example 3&lt;/h4&gt;
  &lt;p&gt;Check all certificates on the local machine:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C:\&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;\Test-SCOMCertificate.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-All&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-4&quot;&gt;Example 4&lt;/h4&gt;
  &lt;p&gt;Check All Certificates on 4 Servers and outputting the results to C:\Temp\Output.txt:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;PS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C:\&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;\Test-SCOMCertificate.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Servers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ManagementServer1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ManagementServer2.contoso.com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Gateway.contoso.com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Agent1.contoso.com&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-All&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-OutputFile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C:\Temp\Output.txt&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;example-of-failure&quot;&gt;Example of Failure&lt;/h2&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/example-of-failure-scom-cert-checker.png&quot; alt=&quot;Picture of an example of the script failing&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scom-certificate-checker-script/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>February 27, 2023</pubDate>
        <link>https://blakedrumm.com/blog/scom-certificate-checker-script/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scom-certificate-checker-script/</guid>
      </item>
    
      <item>
        <title>SCOM SDK Crashing - Cannot Generate SSPI Context</title>
        <postImage>/assets/img/posts/udl-test-sspi-context.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;
&lt;p&gt;I had a case recently for a customer that is having issues when opening the SCOM Console. Ultimately this was due to the SCOM SDK Service crashing, with the following Event in the Operations Manager Event Log:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Log Name:¬†¬†¬†¬†¬† Operations Manager
Source:¬†¬†¬†¬†¬†¬†¬† OpsMgr Management Configuration
Date:¬†¬†¬†¬†¬†¬†¬†¬†¬† 1/24/2023 12:11:06 PM
Event ID:¬†¬†¬†¬†¬† 29112
Task Category: None
Level:¬†¬†¬†¬†¬†¬†¬†¬† Error
User:¬†¬†¬†¬†¬†¬†¬†¬†¬† N/A
Computer:¬†¬†¬†¬†¬† MS01.contoso.com
Description:
OpsMgr Management Configuration Service failed to execute bootstrap work item &apos;ConfigurationDataProviderInitializeWorkItem&apos; due to the following exception



System.Data.SqlClient.SqlException (0x80131904): The target principal name is incorrect.¬† Cannot generate SSPI context.
 ¬† at System.Data.SqlClient.SqlInternalConnectionTds..ctor(DbConnectionPoolIdentity identity, SqlConnectionString connectionOptions, SqlCredential credential, Object providerInfo, String newPassword, SecureString newSecurePassword, Boolean redirectedUserInstance, SqlConnectionString userConnectionOptions, SessionData reconnectSessionData, DbConnectionPool pool, String accessToken, Boolean applyTransientFaultHandling, SqlAuthenticationProviderManager sqlAuthProviderManager)
 ¬† at System.Data.SqlClient.SqlConnectionFactory.CreateConnection(DbConnectionOptions options, DbConnectionPoolKey poolKey, Object poolGroupProviderInfo, DbConnectionPool pool, DbConnection owningConnection, DbConnectionOptions userOptions)
 ¬† at System.Data.ProviderBase.DbConnectionFactory.CreatePooledConnection(DbConnectionPool pool, DbConnection owningObject, DbConnectionOptions options, DbConnectionPoolKey poolKey, DbConnectionOptions userOptions)
 ¬† at System.Data.ProviderBase.DbConnectionPool.CreateObject(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
 ¬† at System.Data.ProviderBase.DbConnectionPool.UserCreateRequest(DbConnection owningObject, DbConnectionOptions userOptions, DbConnectionInternal oldConnection)
 ¬† at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, UInt32 waitForMultipleObjectsTimeout, Boolean allowCreate, Boolean onlyOneCheckConnection, DbConnectionOptions userOptions, DbConnectionInternal&amp;amp; connection)
 ¬† at System.Data.ProviderBase.DbConnectionPool.TryGetConnection(DbConnection owningObject, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal&amp;amp; connection)
 ¬† at System.Data.ProviderBase.DbConnectionFactory.TryGetConnection(DbConnection owningConnection, TaskCompletionSource`1 retry, DbConnectionOptions userOptions, DbConnectionInternal oldConnection, DbConnectionInternal&amp;amp; connection)
 ¬† at System.Data.ProviderBase.DbConnectionInternal.TryOpenConnectionInternal(DbConnection outerConnection, DbConnectionFactory connectionFactory, TaskCompletionSource`1 retry, DbConnectionOptions userOptions)
 ¬† at System.Data.SqlClient.SqlConnection.TryOpenInner(TaskCompletionSource`1 retry)
 ¬† at System.Data.SqlClient.SqlConnection.TryOpen(TaskCompletionSource`1 retry)
 ¬† at System.Data.SqlClient.SqlConnection.Open()
 ¬† at Microsoft.EnterpriseManagement.ManagementConfiguration.DataAccessLayer.ConnectionManagementOperation.Execute()
 ¬† at Microsoft.EnterpriseManagement.ManagementConfiguration.DataAccessLayer.DataAccessOperation.ExecuteSynchronously(Int32 timeoutSeconds, WaitHandle stopWaitHandle)
 ¬† at Microsoft.EnterpriseManagement.ManagementConfiguration.CmdbOperations.CmdbDataProvider.Initialize()
 ¬† at Microsoft.EnterpriseManagement.ManagementConfiguration.Engine.ConfigurationDataProviderInitializeWorkItem.ExecuteWorkItem()
 ¬† at Microsoft.EnterpriseManagement.ManagementConfiguration.Interop.ConfigServiceEngineWorkItem.Execute()
ClientConnectionId:c0z7eb24-124d-46ed-xe78-36q2ba9f7949
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;page_with_curl-how-to-fix-1&quot;&gt;:page_with_curl: How to fix #1&lt;/h2&gt;
&lt;p&gt;In order to resolve this issue for my customer, first we verified if RC4 was disabled (RC4 was disabled) &lt;strong&gt;&lt;em&gt;(More Information here: &lt;a href=&quot;https://techcommunity.microsoft.com/t5/core-infrastructure-and-security/decrypting-the-selection-of-supported-kerberos-encryption-types/ba-p/1628797&quot;&gt;Decrypting the Selection of Supported Kerberos Encryption Types - Microsoft Tech Community&lt;/a&gt;)&lt;/em&gt;&lt;/strong&gt;. Then we had to verify the user account running the Operations Manager SQL Service has AES Attributes enabled. Navigate to the user object in Active Directory and verify that the Account options have the following:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Check This account supports Kerberos AES 128 bit encryption.&lt;/li&gt;
  &lt;li&gt;Check This account supports Kerberos AES 256 bit encryption.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/attributes-domain-controller.png&quot; alt=&quot;Attributes for SCOM Account&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We were no longer having an issue with the SDK Service crashing after this change.&lt;/p&gt;

&lt;p&gt;Relevant Article: &lt;a href=&quot;https://learn.microsoft.com/system-center/scom/install-with-rc4-disabled#configure-the-encryption-types-allowed-for-kerberos&quot;&gt;https://learn.microsoft.com/system-center/scom/install-with-rc4-disabled#configure-the-encryption-types-allowed-for-kerberos&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;page_with_curl-how-to-fix-2&quot;&gt;:page_with_curl: How to fix #2&lt;/h2&gt;
&lt;p&gt;You may also resolve the above issue by fixing SPN information for the MSSQLSvc &lt;em&gt;(thank you Joana da Rocha Carvalho!)&lt;/em&gt;:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nslookup&lt;/code&gt; the SCOM SQL Database Instance(s)&lt;/li&gt;
  &lt;li&gt;Update the SPN information for the SQL Service Account with the following command:
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;setspn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-S&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;MSSQLSvc/SERVER.contoso.com:1433&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;emea\SQLSVCaccount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Check SPN for SQL Service Account:
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;setspn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-L&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;emea\SQLSVCaccount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/cannot-generate-sspi-context/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>January 24, 2023</pubDate>
        <link>https://blakedrumm.com/blog/cannot-generate-sspi-context/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/cannot-generate-sspi-context/</guid>
      </item>
    
      <item>
        <title>SCOM Agent Installation Error - Microsoft ESENT Keys are required</title>
        <postImage>/assets/img/scom-agent-esent-error.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;
&lt;p&gt;I had a case recently for a customer that is having issues when installing an SCOM Agent (&lt;strong&gt;&lt;em&gt;MOMAgent.msi&lt;/em&gt;&lt;/strong&gt;) with an warning which stated:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Microsoft ESENT Keys are required to install this application.
Please see the release notes for more information.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;page_with_curl-how-to-fix&quot;&gt;:page_with_curl: How to fix&lt;/h2&gt;
&lt;p&gt;In order to resolve this issue for my customer, we had to run the installer as administrator. Which we accomplished by opening a Powershell window as administrator and navigating to the directory of the SCOM Agent installer (&lt;strong&gt;&lt;em&gt;MOMAgent.msi&lt;/em&gt;&lt;/strong&gt;).&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/esent-keys-required/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>January 5, 2023</pubDate>
        <link>https://blakedrumm.com/blog/esent-keys-required/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/esent-keys-required/</guid>
      </item>
    
      <item>
        <title>Create Custom PowerShell CPU Monitor</title>
        <postImage>/assets/img/posts/custom-cpu-usage-monitor-alert.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;
&lt;p&gt;Recently I had a case and I needed to assist my customer with a CPU Monitor that targets all Windows Computers. The customer is using the PowerShell Authoring Community MP by Cookdown. I will document my steps to get this working as intended.&lt;/p&gt;

&lt;h2 id=&quot;red_circle-prerequisites&quot;&gt;:red_circle: Prerequisites&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;Import Cookdown PowerShell Monitoring - Community Management Pack (&lt;a href=&quot;https://www.cookdown.com/scom-essentials/powershell-authoring/&quot;&gt;https://www.cookdown.com/scom-essentials/powershell-authoring/&lt;/a&gt;)&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;heavy_check_mark-example-mp&quot;&gt;:heavy_check_mark: Example MP&lt;/h2&gt;
&lt;p&gt;You can get a copy of the Management Pack I created in this guide, here: &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/custom.monitor.for.cpu.usage.xml&quot;&gt;Custom Monitor for CPU Usage&lt;/a&gt; :arrow_left: &lt;strong&gt;Direct Download Link&lt;/strong&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h2 id=&quot;notebook-note&quot;&gt;:notebook: Note&lt;/h2&gt;
  &lt;p&gt;This guide will require you to edit the Management Pack directly, be aware that you need to be careful when editing any Management Pack to ensure you do not accidently change the wrong thing.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;h2 id=&quot;page_with_curl-start-of-guide&quot;&gt;:page_with_curl: Start of Guide&lt;/h2&gt;

&lt;h3 id=&quot;step-1-create-a-new-unit-monitor&quot;&gt;Step 1. Create a new Unit Monitor&lt;/h3&gt;
&lt;p&gt;You will need to create a new Unit Monitor.&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Open the SCOM Console and navigate to the &lt;strong&gt;&lt;em&gt;Authoring Tab&lt;/em&gt;&lt;/strong&gt; -&amp;gt; &lt;strong&gt;&lt;em&gt;Monitors&lt;/em&gt;&lt;/strong&gt; -&amp;gt; Right Click &lt;strong&gt;&lt;em&gt;Monitors&lt;/em&gt;&lt;/strong&gt; -&amp;gt; Hover over &lt;strong&gt;&lt;em&gt;Create a Monitor&lt;/em&gt;&lt;/strong&gt; and select &lt;strong&gt;&lt;em&gt;Unit Monitor‚Ä¶&lt;/em&gt;&lt;/strong&gt;: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/create-a-unit-monitor.png&quot; alt=&quot;Create Unit Monitor in SCOM Console&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Open the &lt;strong&gt;&lt;em&gt;Scripting&lt;/em&gt;&lt;/strong&gt; folder -&amp;gt; &lt;strong&gt;&lt;em&gt;PowerShell Based&lt;/em&gt;&lt;/strong&gt; -&amp;gt; &lt;strong&gt;&lt;em&gt;PowerShell Script Two State Monitor (Community)&lt;/em&gt;&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/select-unit-monitor-type-scripting.png&quot; alt=&quot;Select Scripting and PowerShell Script&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Select the appropriate Management Pack to save the new Monitor. &lt;br /&gt;
&lt;strong&gt;It is HIGHLY recommended to save to a new MP instead of any existing MPs!&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Select &lt;strong&gt;Next &amp;gt;&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Type in an appropriate name / description, I used: &lt;strong&gt;Custom CPU Monitor&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Change the Monitor Target to &lt;strong&gt;Windows Computer&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/windows-computer-target.png&quot; alt=&quot;Select Windows Computer as Target&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Click &lt;strong&gt;Next &amp;gt;&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/create-unit-monitor-step1.png&quot; alt=&quot;Verify data matches&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Run every &lt;strong&gt;15 minutes&lt;/strong&gt; by default, this is a good interval to start with. Click &lt;strong&gt;Next &amp;gt;&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Type in the File Name you want to use, I used: &lt;strong&gt;my_custom_cpu_monitoring_script.ps1&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Copy and Paste the below script into the &lt;strong&gt;&lt;em&gt;Script&lt;/em&gt;&lt;/strong&gt; section and click &lt;strong&gt;Next &amp;gt;&lt;/strong&gt;:
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$api&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;New-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ComObject&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MOM.ScriptAPI&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PropertyBag&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$api&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CreatePropertyBag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$Result&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]((&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Counter&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;\Processor(_Total)\% Processor Time&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CounterSamples&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;CookedValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PropertyBag&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AddValue&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CPUUsage&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$Result&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$PropertyBag&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;&lt;img src=&quot;/assets/img/posts/create-unit-monitor-script-pane.png&quot; alt=&quot;Copy and paste the above script to your script pane&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;Copy and paste the below, when everything below has been copied, click &lt;strong&gt;Next &amp;gt;&lt;/strong&gt;:
    &lt;ul&gt;
      &lt;li&gt;Parameter Name column: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Property[@Name=&quot;CPUUsage&quot;]&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;Operator: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Greater than or equal to&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;Value: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;50&lt;/code&gt;
&lt;img src=&quot;/assets/img/posts/create-unit-monitor-unhealthy.png&quot; alt=&quot;Verify values are set for Unhealthy expression&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Copy and paste the below, when everything below has been copied, click &lt;strong&gt;Next &amp;gt;&lt;/strong&gt;:
    &lt;ul&gt;
      &lt;li&gt;Parameter Name column: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Property[@Name=&quot;CPUUsage&quot;]&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;Operator: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Less than&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;Value: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;50&lt;/code&gt;
&lt;img src=&quot;/assets/img/posts/create-unit-monitor-healthy.png&quot; alt=&quot;Verify values are set for Healthy expression&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Optional: Change Unhealthy from Warning to Critical.
&lt;img src=&quot;/assets/img/posts/create-unit-monitor-configurehealth.png&quot; alt=&quot;Configure Monitor Health&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Click the &lt;strong&gt;&lt;em&gt;Generate alerts for this monitor&lt;/em&gt;&lt;/strong&gt; checkbox and change the Alert Description text to this:
    &lt;div class=&quot;language-text highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;The CPU has reached at or above 50% usage.

      Current CPU usage is: $Data/Context/Property[@Name=&quot;CPUUsage&quot;]$%
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Done creating the unit monitor, now onto the more advanced stuff!&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;step-2-modify-the-management-pack&quot;&gt;Step 2. Modify the Management Pack&lt;/h3&gt;
&lt;p&gt;We will need to modify the Management Pack in order to allow the expressions to evaluate correctly. The Monitor is setup to use string values instead of integers, which will cause problems when we try to evaluate the health of the monitor.&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Go to &lt;strong&gt;&lt;em&gt;Administration Tab&lt;/em&gt;&lt;/strong&gt; -&amp;gt; &lt;strong&gt;&lt;em&gt;Management Packs&lt;/em&gt;&lt;/strong&gt; -&amp;gt; &lt;strong&gt;&lt;em&gt;Installed Management Packs&lt;/em&gt;&lt;/strong&gt; -&amp;gt; Search for the Management Pack where your Monitor is saved. Select and export the Management Pack to any location. &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/create-unit-monitor-export-mp.png&quot; alt=&quot;Export Management Pack&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Navigate to the exported Management Pack xml file, open the MP XML with Notepad.&lt;/li&gt;
  &lt;li&gt;Find and replace: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;XPathQuery&amp;gt;Property[@Name=&quot;CPUUsage&quot;]&amp;lt;/XPathQuery&amp;gt;&lt;/code&gt;
    &lt;ul&gt;
      &lt;li&gt;Replace any occurrences with the following: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;XPathQuery Type=&quot;Integer&quot;&amp;gt;Property[@Name=&quot;CPUUsage&quot;]&amp;lt;/XPathQuery&amp;gt;&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;The above change allows us to interpret the output as integer, instead of string.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Find and replace: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;Value Type=&quot;String&quot;&amp;gt;50&amp;lt;/Value&amp;gt;&lt;/code&gt;
    &lt;ul&gt;
      &lt;li&gt;Replace any occurrences with the following: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;Value Type=&quot;Integer&quot;&amp;gt;50&amp;lt;/Value&amp;gt;&lt;/code&gt;&lt;/li&gt;
      &lt;li&gt;The above change allows us to interpret the output as integer, instead of string.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Modify Line 5 (the version of the Management Pack) in the xml file from: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;Version&amp;gt;1.0.0.0&amp;lt;/Version&amp;gt;&lt;/code&gt; &lt;br /&gt;
to &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;&amp;lt;Version&amp;gt;1.0.0.1&amp;lt;/Version&amp;gt;&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Save the Management Pack XML and import the Management Pack back into your environment.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;Leave some feedback if this helped you! :v:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/create-custom-powershell-cpu-monitor/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>December 17, 2022</pubDate>
        <link>https://blakedrumm.com/blog/create-custom-powershell-cpu-monitor/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/create-custom-powershell-cpu-monitor/</guid>
      </item>
    
      <item>
        <title>Reconfigure System Center Operations Manager for Database Move Tool</title>
        <postImage>/assets/img/scom-db-move-tool.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;

&lt;p&gt;Welcome to the official page for the Reconfigure System Center Operations Manager for Database Move Tool. This tool is compatible with all versions of Operations Manager and is designed to help you manage SQL connections used by Operations Manager.&lt;/p&gt;

&lt;p&gt;This script automates the steps outlined here: &lt;a href=&quot;https://learn.microsoft.com/system-center/scom/manage-move-opsdb&quot;&gt;https://learn.microsoft.com/system-center/scom/manage-move-opsdb&lt;/a&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h4 id=&quot;spiral_notepad-note&quot;&gt;:spiral_notepad: Note&lt;/h4&gt;
  &lt;p&gt;The script does not edit the Reporting Services &lt;strong&gt;Data Warehouse Data Source&lt;/strong&gt; -&amp;gt; &lt;strong&gt;&lt;em&gt;Connection String&lt;/em&gt;&lt;/strong&gt; &lt;br /&gt;
(shown here (change to https if you are using SSL Certificates): &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;http://&amp;lt;reportingServerURL&amp;gt;/Reports/manage/catalogitem/properties/Data%20Warehouse%20Main&lt;/code&gt;) &lt;br /&gt;
¬†
You will need to update the Connection String value to the correct data, here is an example of mine:&lt;/p&gt;
  &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;data source=SQL01-2022;initial catalog=OperationsManagerDW;Integrated Security=SSPI
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;p&gt;&lt;img src=&quot;/assets/img/posts/sql-server-reporting-services-data-source-example.png&quot; alt=&quot;SQL Server Reporting Services Data Source Example&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;features&quot;&gt;Features&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;Update / Verify the System Center Operations Manager SQL
    &lt;ul&gt;
      &lt;li&gt;SQL Instance Configuration for CLR and SQL Service Broker.&lt;/li&gt;
      &lt;li&gt;Database Tables for data related to SQL Connections in SCOM.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Update / Verify the Registry data
    &lt;ul&gt;
      &lt;li&gt;Local SCOM Management Servers.&lt;/li&gt;
      &lt;li&gt;Remote SCOM Management Servers.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Update / Verify the Configuration File
    &lt;ul&gt;
      &lt;li&gt;Local SCOM Management Servers.&lt;/li&gt;
      &lt;li&gt;Remote SCOM Management Servers.&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Language Changer combo-box which adds automatic support for 8 Languages:
    &lt;ul&gt;
      &lt;li&gt;English&lt;/li&gt;
      &lt;li&gt;Spanish (Espa√±ol)&lt;/li&gt;
      &lt;li&gt;Arabic (ÿπÿ±ÿ®Ÿä)&lt;/li&gt;
      &lt;li&gt;Turkish (T√ºrk√ße)&lt;/li&gt;
      &lt;li&gt;Chinese (‰∏≠ÂõΩ‰∫∫)&lt;/li&gt;
      &lt;li&gt;Portuguese (Portugu√™s)&lt;/li&gt;
      &lt;li&gt;French (Fran√ßais)&lt;/li&gt;
      &lt;li&gt;German (Deutsch)
        &lt;h4 id=&quot;a-huge-thank-you-to-the-following-individuals-for-assisting-with-translation-in-the-different-languages&quot;&gt;A HUGE THANK YOU to the following individuals for assisting with translation in the different languages:&lt;/h4&gt;
      &lt;/li&gt;
      &lt;li&gt;Rafael Lujan (Spanish)&lt;/li&gt;
      &lt;li&gt;Fayez Al Saadi (Arabic)&lt;/li&gt;
      &lt;li&gt;Murat Coskun (Turkish)&lt;/li&gt;
      &lt;li&gt;Wendi Cai (Chinese)&lt;/li&gt;
      &lt;li&gt;Wagner da Costa Carvalho (Portuguese)&lt;/li&gt;
      &lt;li&gt;Joana da Rocha Carvalho (French)&lt;/li&gt;
      &lt;li&gt;Stefan Wuchenauer (German)&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;requirements&quot;&gt;Requirements&lt;/h3&gt;
&lt;ul&gt;
  &lt;li&gt;System Center Operations Manager installation&lt;/li&gt;
  &lt;li&gt;Powershell 5&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;arrow_down_small-latest-version&quot;&gt;:arrow_down_small: Latest Version&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Reconfigure-DB-Move-Tool/releases/latest&quot; class=&quot;img-shields-io&quot;&gt;&lt;img src=&quot;https://img.shields.io/github/v/release/blakedrumm/SCOM-Reconfigure-DB-Move-Tool&quot; alt=&quot;Latest Version&quot; /&gt;&lt;/a&gt; &lt;br /&gt;
&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Reconfigure-DB-Move-Tool/releases&quot; class=&quot;img-shields-io&quot;&gt;&lt;img src=&quot;https://img.shields.io/github/downloads/blakedrumm/SCOM-Reconfigure-DB-Move-Tool/total.svg?style=for-the-badge&amp;amp;color=brightgreen&quot; alt=&quot;Download Count Releases&quot; /&gt;&lt;/a&gt; &lt;br /&gt;
&lt;a href=&quot;https://aka.ms/SCOM-DB-Move-Tool&quot; class=&quot;img-shields-io&quot;&gt;&lt;img src=&quot;https://img.shields.io/github/downloads/blakedrumm/SCOM-Reconfigure-DB-Move-Tool/latest/SCOM-Reconfigure-DB-Move-Tool-EXE.zip?style=for-the-badge&amp;amp;color=brightgreen&quot; alt=&quot;Download Count Latest&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Check the changelog for the latest version: &lt;a href=&quot;https://github.com/blakedrumm/SCOM-Reconfigure-DB-Move-Tool/releases/latest&quot;&gt;Latest Changes&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;page_with_curl-how-to-use&quot;&gt;:page_with_curl: How to Use&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Reconfigure-DB-Move-Tool/releases/latest/download/SCOM-Reconfigure-DB-Move-Tool-EXE.zip&quot; target=&quot;_&quot;&gt;&lt;button class=&quot;btn btn-primary navbar-btn&quot;&gt;Get Started&lt;/button&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://aka.ms/SCOM-DB-Move-Tool&quot;&gt;https://aka.ms/SCOM-DB-Move-Tool&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You have multiple ways to download the SCOM Reconfigure DB Move GUI Tool:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Download and install the MSI: &lt;a href=&quot;https://github.com/blakedrumm/SCOM-Reconfigure-DB-Move-Tool/releases/latest/download/SCOM-Reconfigure-DB-Move-Tool-MSI.zip&quot;&gt;MSI Download&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Download and run the EXE: &lt;a href=&quot;https://github.com/blakedrumm/SCOM-Reconfigure-DB-Move-Tool/releases/latest/download/SCOM-Reconfigure-DB-Move-Tool-EXE.zip&quot;&gt;EXE Downloads&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Download or Copy the Powershell Script to Powershell ISE: &lt;a href=&quot;https://github.com/blakedrumm/SCOM-Reconfigure-DB-Move-Tool/releases/latest/download/SCOM-Reconfigure-DB-Move-Tool.ps1&quot;&gt;Powershell Script&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Download or Copy the Powershell Script to Powershell ISE: &lt;a href=&quot;https://files.blakedrumm.com/SCOM-ReconfigureDatabaseLocations.txt&quot;&gt;Text Format Alternative Download Link&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;The script by default will attempt to gather the current database connection from the local registry. If it is unable to locate the registry keys the Database Connection box will be empty. If it is empty you will need to manually type the values in here. The Values to Set section is required for the script to run and you will need to manually populate these fields. The Management Servers section is also required for you to be able to set which Management Servers to update the Database information on.&lt;/p&gt;

&lt;p&gt;This script will log actions to the Application Event Log. Look for the Event Source: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SCOMDBMoveTool&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;page_facing_up-more-information&quot;&gt;:page_facing_up: More Information&lt;/h2&gt;

&lt;p&gt;You will get prompted each time you run the script to accept the license agreement, unless you select do not ask me again, when you select this it will save a file to your ProgramData Directory:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;C:\ProgramData\SCOM-DBMoveTool-AgreedToLicense.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Attribution for the icon:
&lt;a href=&quot;https://www.flaticon.com/free-icons/database&quot; title=&quot;database icons&quot;&gt;Database icons created by manshagraphics - Flaticon&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scom-db-move-tool/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Welcome to GitHub Pages

You can use the [editor on GitHub](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/edit/master/docs/index.md) to maintain and preview the content for your website in Markdown files.

Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>November 23, 2022</pubDate>
        <link>https://blakedrumm.com/blog/scom-db-move-tool/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scom-db-move-tool/</guid>
      </item>
    
      <item>
        <title>Remove Data from the SCOM Database Instantly - The PowerShell Way!</title>
        <postImage>/assets/img/posts/remove-scombasemanagedentity.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;
&lt;p&gt;I have had many cases where I‚Äôve had to run the following SQL Queries by Kevin Holman: &lt;a href=&quot;https://kevinholman.com/2018/05/03/deleting-and-purging-data-from-the-scom-database/&quot;&gt;Deleting and Purging data from the SCOM Database (kevinholman.com)&lt;/a&gt; &lt;strong&gt;&lt;em&gt;(A big thank you to Kevin Holman for his guide!)&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;After the 6th or 7th time running the tsql queries I decided that I should automate this process in Powershell, and make it very easy to do this automatically for as many servers as needed. This script will query the Operations Manager database and run all the steps in Kevin Holman‚Äôs queries. The script will ask questions at each step to verify the action is correct. You have to answer &lt;strong&gt;Y&lt;/strong&gt; or &lt;strong&gt;N&lt;/strong&gt; before the script will proceed.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;exclamation-important&quot;&gt;:exclamation: Important!&lt;/h3&gt;
  &lt;p&gt;It is recommended to only run the script when requested by a Microsoft Support Engineer. &lt;strong&gt;This script can be dangerous if used incorrectly.&lt;/strong&gt; &lt;br /&gt;
¬† &lt;br /&gt;
If you absolutely need to run the script, make sure you have full backups of your SCOM SQL Instances / Databases!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;arrow_down-how-to-get-it&quot;&gt;:arrow_down: How to get it&lt;/h2&gt;
&lt;p&gt;You can get a copy of the script here: &lt;br /&gt;
&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/Quick%20Fixes/Remove-SCOMBaseManagedEntity.ps1&quot;&gt;Remove-SCOMBaseManagedEntity.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Direct Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Remove-SCOMBaseManagedEntity.ps1&quot;&gt;Personal File Server - Remove-SCOMBaseManagedEntity.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Alternative Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Remove-SCOMBaseManagedEntity.txt&quot;&gt;Personal File Server - Remove-SCOMBaseManagedEntity.txt&lt;/a&gt; :arrow_left: &lt;strong&gt;Text Format Alternative Download Link&lt;/strong&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h2 id=&quot;notebook-note&quot;&gt;:notebook: Note&lt;/h2&gt;
  &lt;p&gt;You may edit line &lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/Quick%20Fixes/Remove-SCOMBaseManagedEntity.ps1#L769&quot;&gt;769&lt;/a&gt; in the script to change what happens when the script is run without any arguments or parameters, this also allows you to change what happens when the script is run from the Powershell ISE.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;h2 id=&quot;classical_building-argument-list&quot;&gt;:classical_building: Argument List&lt;/h2&gt;

&lt;table class=&quot;table table-hover table-text d-block overflow-auto&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parameter&lt;/th&gt;
      &lt;th&gt;Alias&lt;/th&gt;
      &lt;th&gt;ValueFromPipeline&lt;/th&gt;
      &lt;th&gt;Type&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;AssumeYes&lt;/td&gt;
      &lt;td&gt;yes&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Switch&lt;/td&gt;
      &lt;td&gt;Optionally assume yes to any question asked by this script.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Database&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;The name of the OperationsManager Database for SCOM.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;DontStop&lt;/td&gt;
      &lt;td&gt;ds&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Switch&lt;/td&gt;
      &lt;td&gt;Optionally force the script to not stop when an error occurs connecting to the Management Server.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Id&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Array&lt;/td&gt;
      &lt;td&gt;You may provide any Base Managed Entity Id‚Äôs to be deleted specifically from the Operations Manager Database.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;InputFile&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;A file you would like to have the script input as a list of Agents. The file should have a new line for each server.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;ManagementServer&lt;/td&gt;
      &lt;td&gt;ms&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;SCOM Management Server that we will remotely connect to. If running on a Management Server, there is no need to provide this parameter.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Name&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;Array&lt;/td&gt;
      &lt;td&gt;The Base Managed Entity Display Name of the object you are wanting to delete from the Operations Manager Database.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;Servers&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;True&lt;/td&gt;
      &lt;td&gt;Array&lt;/td&gt;
      &lt;td&gt;Each Server (comma separated) you want to Remove related BME ID‚Äôs related to the Display Name in the OperationsManager Database. This will also remove from Agent Managed.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SqlServer&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;¬†&lt;/td&gt;
      &lt;td&gt;String&lt;/td&gt;
      &lt;td&gt;SQL Server/Instance, Port that hosts OperationsManager Database for SCOM.&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;page_with_curl-how-to-use-it&quot;&gt;:page_with_curl: How to use it&lt;/h2&gt;
&lt;blockquote&gt;
  &lt;h4 id=&quot;example-1&quot;&gt;Example 1&lt;/h4&gt;
  &lt;p&gt;Remove SCOM BME Related Data from the OperationsManager DB, for Agent1 in the Management Group:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMAgent&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Agent1.contoso.com&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Remove-SCOMBaseManagedEntity.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Servers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DisplayName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-2&quot;&gt;Example 2&lt;/h4&gt;
  &lt;p&gt;Remove SCOM BME Related Data for 2 Agent machines:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Remove-SCOMBaseManagedEntity.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Servers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;IIS-Server.contoso.com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;WindowsServer.contoso.com&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-3&quot;&gt;Example 3&lt;/h4&gt;
  &lt;p&gt;Remove SCOM BME Related Data for 2 Agent machines automatically with no prompts / questions:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Remove-SCOMBaseManagedEntity.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Servers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;IIS-Server.contoso.com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;WindowsServer.contoso.com&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AssumeYes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-4&quot;&gt;Example 4&lt;/h4&gt;
  &lt;p&gt;Remove SCOM BME IDs from the Operations Manager Database:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Remove-SCOMBaseManagedEntity.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Id&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C1E9B41B-0A35-C069-16EB-00AC43BB9C47&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CB29ECDE-BCE8-2213-D5DD-0353116EDA6B&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-5&quot;&gt;Example 5&lt;/h4&gt;
  &lt;p&gt;If you need to input a file that contains Agents (CSV or TXT):&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Remove-SCOMBaseManagedEntity.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-InputFile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C:\Temp\List_Of_Servers.txt&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/blockquote&gt;

&lt;p&gt;Leave some feedback if this helped you! :v:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/remove-data-from-scom-database/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>October 2, 2022</pubDate>
        <link>https://blakedrumm.com/blog/remove-data-from-scom-database/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/remove-data-from-scom-database/</guid>
      </item>
    
      <item>
        <title>Data Reader account provided is not same as that in the management group</title>
        <postImage>/assets/img/posts/opsmgr-setup-data-reader-account-issue.jpg</postImage>
        <description>&lt;p&gt;&lt;sub&gt;Thank you to Luis D√©cio for the original creation of the KB!&lt;/sub&gt;&lt;/p&gt;

&lt;p&gt;During installation of SCOM Reporting services, you may see the following error:
Data Reader account provided is not same as that in the management group.&lt;/p&gt;

&lt;h2 id=&quot;how-to-fix&quot;&gt;How to fix&lt;/h2&gt;
&lt;h3 id=&quot;reconfigure-the-data-warehouse-report-deployment-account-profile&quot;&gt;Reconfigure the ‚ÄúData Warehouse Report Deployment Account‚Äù Profile&lt;/h3&gt;
&lt;p&gt;Set the Data Warehouse Report Deployment Account to the Class ‚ÄúCollection Server‚Äù and ‚ÄúData Warehouse Synchronization Server‚Äù&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/dw-report-deployment-account-profile.png&quot; alt=&quot;/assets/img/posts/dw-report-deployment-account-profile.png&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;reconfigure-the-data-warehouse-account-profile&quot;&gt;Reconfigure the ‚ÄúData Warehouse Account‚Äù Profile&lt;/h3&gt;
&lt;p&gt;Data Warehouse Action Account to the Class ‚ÄúCollection Server‚Äù, ‚ÄúData Warehouse Synchronization Server‚Äù, ‚ÄúData Set‚Äù and ‚ÄúOperations Manager APM Data Transfer Service‚Äù&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/data-warehouse-account-profile.jpg&quot; alt=&quot;/assets/img/posts/data-warehouse-account-profile.jpg&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After configuring the above, the SCOM Reporting component installed successfully with the &lt;strong&gt;Data Warehouse Report Deployment Account&lt;/strong&gt; as expected.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;automate-with-powershell&quot;&gt;Automate with Powershell&lt;/h2&gt;

&lt;p&gt;You can use Powershell to automate fixing the DW RunAs Profiles. I would suggest that you remove all RunAs accounts from both RunAs profiles (‚ÄúData Warehouse Account‚Äù and ‚ÄúData Warehouse Report Deployment Account‚Äù) prior to running the below Powershell script.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Blog post from Udish Mudiar:&lt;/strong&gt; &lt;a href=&quot;https://udishtech.com/associate-scom-data-warehouse-profile-using-powershell/&quot;&gt;https://udishtech.com/associate-scom-data-warehouse-profile-using-powershell/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Here is my own take on Udish‚Äôs Powershell script: &lt;br /&gt;
&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/Quick%20Fixes/Resolve-DWRunAsProfileAssociation.ps1&quot;&gt;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/Quick%20Fixes/Resolve-DWRunAsProfileAssociation.ps1&lt;/a&gt;&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Original Author: Udish Mudiar&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Original Blog Post: https://udishtech.com/associate-scom-data-warehouse-profile-using-powershell/&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# =========================================================================================================================&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Modified by: Blake Drumm (blakedrumm@microsoft.com)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Last Modified: March 8th, 2024&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# Blog Post: https://blakedrumm.com/blog/data-reader-account-provided-is-not-same-as-that-in-the-management-group/&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;function&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Invoke-TimeStamp&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TimeStamp&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Date&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;DateTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;return&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$TimeStamp&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; - &quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Host&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n`n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;------------------------------------------------------------&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ForegroundColor&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Green&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Associate Run As Account association in Data Warehouse and Report Deployment Run As Profile.&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Invoke-TimeStamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Script started&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Import-Module&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;OperationsManager&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Get the run as profiles&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWActionAccountProfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMRunAsProfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DisplayName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Data Warehouse Account&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ReportDeploymentProfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMRunAsProfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DisplayName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Data Warehouse Report Deployment Account&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Get the run as accounts&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWActionAccount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMrunAsAccount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Data Warehouse Action Account&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWReportDeploymentAccount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMrunAsAccount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Data Warehouse Report Deployment Account&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Get all the required classes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CollectionServerClass&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMClass&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DisplayName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Collection Server&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DataSetClass&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMClass&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DisplayName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Data Set&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$APMClass&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMClass&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DisplayName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Operations Manager APM Data Transfer Service&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWSyncClass&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMClass&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-DisplayName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Data Warehouse Synchronization Server&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Setting the association&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Invoke-TimeStamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Setting the Run As Account Association for Data Warehouse Account Profile&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$APMClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set-SCOMRunAsProfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Action&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Add&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Profile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWActionAccountProfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Account&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWActionAccount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Class&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CollectionServerClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DataSetClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$APMClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWSyncClass&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set-SCOMRunAsProfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Action&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Add&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Profile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWActionAccountProfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Account&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWActionAccount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Class&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CollectionServerClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DataSetClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWSyncClass&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Invoke-TimeStamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Completed Successfully!&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Invoke-TimeStamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Unable to set the RunAs accounts, try removing all accounts from inside the RunAs Profile (&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Data Warehouse Account&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;), and run the script again.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Warning&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Invoke-TimeStamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Invoke-TimeStamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Setting the Run As Account Association for Data Warehouse Report Deployment Account Profile&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Set-SCOMRunAsProfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Action&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Add&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Profile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ReportDeploymentProfile&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Account&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWReportDeploymentAccount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Class&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$CollectionServerClass&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$DWSyncClass&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Invoke-TimeStamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Completed Successfully!&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Invoke-TimeStamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Unable to set the RunAs accounts, try removing all accounts from inside the RunAs Profile (&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Data Warehouse Report Deployment Account&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`&quot;&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;), and run the script again.&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Warning&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Invoke-TimeStamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;

&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Invoke-TimeStamp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Script ended&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Host&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;------------------------------------------------------------&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ForegroundColor&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Green&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/data-reader-account-provided-is-not-same-as-that-in-the-management-group/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>September 19, 2022</pubDate>
        <link>https://blakedrumm.com/blog/data-reader-account-provided-is-not-same-as-that-in-the-management-group/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/data-reader-account-provided-is-not-same-as-that-in-the-management-group/</guid>
      </item>
    
      <item>
        <title>SCOM Uptime Availability Report</title>
        <postImage>/assets/img/posts/uptime-availability-report.png</postImage>
        <description>&lt;p&gt;In order to properly report on the uptime of a machine, you will need to target the Health Service Watcher object class. This class will allow you to return the availability of the machine itself, and not all of the rollup monitors underneath that may affect the report accuracy.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/open-availability-report.png&quot; alt=&quot;Open Availability Report&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;Open SCOM Console, Click on the &lt;em&gt;Reporting&lt;/em&gt; tab&lt;/li&gt;
  &lt;li&gt;Click on &lt;strong&gt;Microsoft Generic Report Library&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Open the &lt;strong&gt;Availability&lt;/strong&gt; Report&lt;/li&gt;
  &lt;li&gt;Add Object: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/add-object-report.png&quot; alt=&quot;Add object to report&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Click on &lt;strong&gt;Options‚Ä¶&lt;/strong&gt; -&amp;gt; Click on &lt;strong&gt;Add&lt;/strong&gt; -&amp;gt; Type &lt;strong&gt;Health Service Watcher&lt;/strong&gt; in the search field -&amp;gt; Add &lt;strong&gt;Health Service Watcher&lt;/strong&gt;: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/add-object-hsw-class.png&quot; alt=&quot;Add Health Service Watcher Object Class&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Click OK on the Options Window: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/health-service-watcher-options.png&quot; alt=&quot;Options - Health Service Watcher&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Type in the machines you want to discover (or you can just press search and it will return all related items): &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/select-hsw-agentwatcher-objects.png&quot; alt=&quot;Select Health Service Watcher Computer Objects&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;Modify the time range and run the report.&lt;/li&gt;
  &lt;li&gt;Resulting output: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/availability-report-output.png&quot; alt=&quot;Availability Report Results&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;notebook-note&quot;&gt;:notebook: Note&lt;/h3&gt;
  &lt;p&gt;Quick tip, you can modify the parameters for the report at any time with the Show or Hide Parameter Area button: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/show-hide-parameter-area-reporting.png&quot; alt=&quot;Show and Hide Parameter in Reports&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;dynamic-agent-health-service-watcher-group&quot;&gt;Dynamic Agent Health Service Watcher Group&lt;/h2&gt;

&lt;p&gt;If you would like to make it easier to run the report again, you can create a group for the Health Service Watchers. Just create a group in &lt;strong&gt;Authoring&lt;/strong&gt; -&amp;gt; &lt;strong&gt;Groups&lt;/strong&gt;, with the following Dynamic Member Rule: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/scom-agent-hsw-group.png&quot; alt=&quot;Dynamic Member Rule&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Membership Result:&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/all-agent-hsw-objects-group.png&quot; alt=&quot;Membership Result&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scom-uptime-availability-report/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Welcome to GitHub Pages

You can use the [editor on GitHub](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/edit/master/docs/index.md) to maintain and preview the content for your website in Markdown files.

Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>August 17, 2022</pubDate>
        <link>https://blakedrumm.com/blog/scom-uptime-availability-report/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scom-uptime-availability-report/</guid>
      </item>
    
      <item>
        <title>Event 26319 - Assembly Trust Issues with SQL 2017+</title>
        <postImage>/assets/img/posts/event-26319-error-assembly-trust-issues.png</postImage>
        <description>&lt;p&gt;&lt;sub&gt;Thank you to Lorne Sepaugh for the original creation of the KB!&lt;/sub&gt;&lt;/p&gt;

&lt;h2 id=&quot;symptom&quot;&gt;Symptom&lt;/h2&gt;
&lt;p&gt;I had a customer today that had an issue with being unable to open any SCOM Console without receiving the following error:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Date: 6/8/2022 1:57:24 AM
Application: Operations Manager
Application Version: 10.19.10505.0
Severity: Error
Message: 

An error occurred in the Microsoft .NET Framework while trying to load assembly id 65537. The server may be running out of resources, or the assembly may not be trusted. Run the query again, or check documentation to see how to solve the assembly trust issues. For more information about this error: 
System.IO.FileLoadException: Could not load file or assembly &apos;microsoft.enterprisemanagement.sql.userdefineddatatype, Version=0.0.0.0, Culture=neutral, PublicKeyToken=null&apos; or one of its dependencies. An error relating to security occurred. (Exception from HRESULT: 0x8013150A)
System.IO.FileLoadException: 
   at System.Reflection.RuntimeAssembly._nLoad(AssemblyName fileName, String codeBase, Evidence assemblySecurity, RuntimeAssembly locationHint, StackCrawlMark&amp;amp; stackMark, IntPtr pPrivHostBinder, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks)
   at System.Reflection.RuntimeAssembly.InternalLoadAssemblyName(AssemblyName assemblyRef, Evidence assemblySecurity, RuntimeAssembly reqAssembly, StackCrawlMark&amp;amp; stackMark, IntPtr pPrivHostBinder, Boolean throwOnFileNotFound, Boolean forIntrospection, Boolean suppressSecurityChecks)
   at System.Reflection.RuntimeAssembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp;amp; stackMark, IntPtr pPrivHostBinder, Boolean forIntrospection)
   at System.Reflection.RuntimeAssembly.InternalLoad(String assemblyString, Evidence assemblySecurity, StackCrawlMark&amp;amp; stackMark, Boolean forIntrospection)
   at System.Reflection.Assembly.Load(String assemblyString)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This error is due to a change in the SQL 2017 security approach for CLR, as stated in the SQL Server 2017 docs: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/clr-sql-2017-security-approach.png&quot; alt=&quot;CLR SQL 2017 documentation highlight&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;There are two assemblies used by SCOM that are marked as &lt;em&gt;UNSAFE&lt;/em&gt; and not allowed to run by default in one of these scenarios - as such we need to mark them as safe and trusted on each server instance. The assemblies are:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Microsoft.EnterpriseManagement.SQL.DataAccessLayer&lt;/li&gt;
  &lt;li&gt;Microsoft.EnterpriseManagement.SQL.UserDefinedDataType&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;how-to-resolve&quot;&gt;How to Resolve&lt;/h2&gt;
&lt;h3 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;*If using availability groups, this is to be completed after the databases are added&lt;/strong&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Ensure that CLR is enabled on all SQL Server instances with this script:
    &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Sp_configure&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;show advanced options&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;RECONFIGURE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;Sp_configure&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;clr enabled&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt; 
&lt;span class=&quot;n&quot;&gt;RECONFIGURE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Make sure that you have SQL admin access, or a DBA on hand&lt;/li&gt;
  &lt;li&gt;(Optional) Stop all the SCOM services on each management server - don‚Äôt forget to restart when finished&lt;/li&gt;
  &lt;li&gt;Make sure you have a database backup&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;step-1-verify-clr-strict-security-state&quot;&gt;Step 1: Verify CLR Strict Security State&lt;/h3&gt;
&lt;p&gt;Run this query in SQL Management Studio:&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;configurations&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;name&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;LIKE&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;clr strict security&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You should get a return like this, ‚Äúvalue_in_use‚Äù and ‚Äúvalue‚Äù should be 1: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/clr-value-in-use.png&quot; alt=&quot;Example showing sys.configurations value_in_use&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This table describes what the values mean:&lt;/p&gt;

&lt;table class=&quot;table table-hover table-text d-block overflow-auto&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Value&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;0&lt;/td&gt;
      &lt;td&gt;Disabled - Provided for backwards compatibility. Disabled value is not recommended&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;1&lt;/td&gt;
      &lt;td&gt;Enabled - Causes the Database Engine to ignore the PERMISSION_SET information on the assemblies, and always interpret them as UNSAFE. Enabled is the default value for SQL Server 2017 (14.x)&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;note&quot;&gt;Note&lt;/h3&gt;
  &lt;p&gt;By default, CLR strict security will be &lt;strong&gt;OFF&lt;/strong&gt; after upgrading to SQL Server 2017&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;If the value is 0 - check this doc for more info on how to set it to 1 - &lt;a href=&quot;https://docs.microsoft.com/sql/database-engine/configure-windows/clr-strict-security?view=sql-server-2017&quot;&gt;https://docs.microsoft.com/sql/database-engine/configure-windows/clr-strict-security?view=sql-server-2017&lt;/a&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-2-create-the-trusted-assemblies&quot;&gt;Step 2: Create the Trusted Assemblies&lt;/h3&gt;
&lt;p&gt;To create the Trusted Assemblies, run the below TSQL Query on each SQL 2017+ instance(s) hosting the Operations Manager Database:&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;USE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;master&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;-- First Trusted Assembly&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clrName1&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nvarchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Microsoft.EnterpriseManagement.Sql.DataAccessLayer&apos;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PRINT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Trusted Assembly: &apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CAST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clrName1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nvarchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;120&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hash1&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;varbinary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xEC312664052DE020D0F9631110AFB4DCDF14F477293E1C5DE8C42D3265F543C92FCF8BC1648FC28E9A0731B3E491BCF1D4A8EB838ED9F0B24AE19057BDDBF6EC&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;-- Drop trusted assembly if exists&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXISTS&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;trusted_assemblies&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clrName1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;BEGIN&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PRINT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos; - Dropping Trusted Assembly&apos;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;EXEC&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SYS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sp_drop_trusted_assembly&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hash1&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;END&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;--Add to trusted assembly&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PRINT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos; - Adding Trusted Assembly&apos;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;EXEC&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sp_add_trusted_assembly&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hash&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hash1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                 &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clrName1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;PRINT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos; &apos;&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;-- Second Trusted Assembly&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clrName2&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nvarchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4000&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Microsoft.EnterpriseManagement.Sql.UserDefinedDataType&apos;&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PRINT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Trusted Assembly: &apos;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;CAST&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clrName2&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;nvarchar&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;120&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;DECLARE&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hash2&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;varbinary&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;64&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;xFAC2A8ECA2BE6AD46FBB6EDFB53321240F4D98D199A5A28B4EB3BAD412BEC849B99018D9207CEA045D186CF67B8D06507EA33BFBF9A7A132DC0BB1D756F4F491&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;-- Drop trusted assembly if exists&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;IF&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;EXISTS&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;trusted_assemblies&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clrName2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;BEGIN&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PRINT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos; - Dropping Trusted Assembly&apos;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;EXEC&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SYS&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sp_drop_trusted_assembly&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hash2&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;END&lt;/span&gt;

&lt;span class=&quot;c1&quot;&gt;--Add to trusted assembly&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PRINT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos; - Adding Trusted Assembly&apos;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;EXEC&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;sp_add_trusted_assembly&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hash&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hash2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
                                 &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;description&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;clrName2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can verify the currently trusted assemblies with the following query:&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;USE&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;OperationsManager&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;assemblies&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;FROM&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sys&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;trusted_assemblies&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once done on all SQL Server instance(s) that host the Operations Manager Database, restart the SCOM Console on the management servers and everything should load correctly.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/event-26319-assembly-trust-issues/&quot; alt=&quot;Page Views&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>August 5, 2022</pubDate>
        <link>https://blakedrumm.com/blog/event-26319-assembly-trust-issues/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/event-26319-assembly-trust-issues/</guid>
      </item>
    
      <item>
        <title>Resolve SCOM Agent Deployment Error: 80070643</title>
        <postImage>/assets/img/posts/SCOM-Agent-Deployment-Error-80070643.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;

&lt;p&gt;I had a case where my customer is experiencing an error on their SCOM Console when attempting to resolve an agent Pending Upgrade in Pending Management. The Agent needed to be upgraded from the SCOM 2019 Agent to the SCOM 2022 Agent. We reviewed the Log file: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Agent1AgentInstall.Log&lt;/code&gt; located in the following directory: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\Program Files\Microsoft System Center\Operations Manager\Server\AgentManagement\AgentLogs&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Discovery Wizard Error:&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;The Agent Management Operation Agent Install failed for remote computer Agent1.contoso.com. 


Install account: CONTOSO\SCOMAdmin 


Error Code: 80070643 


Error Description: Fatal error during installation. 


Microsoft Installer Error Description: 


For more information, see Windows Installer log file &quot;C:\Program Files\Microsoft System Center\Operations Manager\Server\AgentManagement\AgentLogs\Agent1AgentInstall.log&quot; on the Management Server. 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;page_with_curl-how-to-fix&quot;&gt;:page_with_curl: How to fix&lt;/h2&gt;
&lt;p&gt;The MSI error highlighted below was the main cause for the installation failure:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;Action start 16:18:53: _SuppressComputerReboot. &lt;br /&gt;
MSI (s) (AC:F0) [16:18:53:021]: Skipping action: SetIS_NETFRAMEWORK_472_OR_LATER_INSTALLED (condition is false) &lt;br /&gt;
MSI (s) (AC:F0) [16:18:53:021]: Doing action: LaunchConditions &lt;br /&gt;
Action ended 16:18:53: _SuppressComputerReboot. Return value 1. &lt;br /&gt;
Action start 16:18:53: LaunchConditions. &lt;br /&gt;
MSI (s) (AC:F0) [16:18:53:021]: Product: Microsoft Monitoring Agent ‚Äì &lt;span style=&quot;color:yellow&quot;&gt;The .NET Framework 4.7.2 is required to install this application.&lt;/span&gt;&lt;/p&gt;

  &lt;p&gt;The .NET Framework 4.7.2 is required to install this application. &lt;br /&gt;
Action ended 16:18:53: LaunchConditions. Return value 3. &lt;br /&gt;
Action ended 16:18:53: INSTALL. Return value 3.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;We also attempted a manual install and this will also show you the error: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/dotNET-4_7_2-missing.png&quot; alt=&quot;DotNET Missing MSI Error&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After installing &lt;a href=&quot;https://dotnet.microsoft.com/download/dotnet-framework/net472&quot;&gt;.NET Framework 4.7.2&lt;/a&gt; as required for the SCOM 2022 Agent, the installation succeeded. &lt;br /&gt;
&lt;a href=&quot;https://docs.microsoft.com/system-center/scom/system-requirements?view=sc-om-2022#microsoft-monitoring-agent-operating-system&quot;&gt;SCOM 2022 Agent Requirements&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/resolve-scom-agent-deployment-80070643/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>July 29, 2022</pubDate>
        <link>https://blakedrumm.com/blog/resolve-scom-agent-deployment-80070643/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/resolve-scom-agent-deployment-80070643/</guid>
      </item>
    
      <item>
        <title>SCOM Unix/Linux Discovery Errors + How To Fix Them</title>
        <postImage>/assets/img/posts/unix-linux-discovery-wizard.png</postImage>
        <description>&lt;h2 id=&quot;errors-you-may-see&quot;&gt;Errors you may see&lt;/h2&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;error-example-1&quot;&gt;Error Example 1&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;DiscoveryResult.ErrorData type. Please file bug report - Parameter Name: s&lt;/strong&gt; &lt;br /&gt;
When discovering a Unix/Linux machine, the wizard shows the machine as unmanageable in the discovery results with below error:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Unexpected DiscoveryResult.ErrorData type.‚ÄØ Please file bug report. 
ErrorData: System.ArgumentNullException 
Value cannot be null. 
Parameter name: s 
at System.Activities.WorkflowApplication.Invoke(Activity activity, IDictionary`2 inputs, WorkflowInstanceExtensionManager extensions, TimeSpan timeout) 
at System.Activities.WorkflowInvoker.Invoke(Activity workflow, IDictionary`2 inputs, TimeSpan timeout, WorkflowInstanceExtensionManager extensions) 
at Microsoft.SystemCenter.CrossPlatform.ClientActions.DefaultDiscovery.InvokeWorkflow(IManagedObject managementActionPoint, DiscoveryTargetEndpoint criteria, IInstallableAgents installableAgents) 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;how-to-fix&quot;&gt;How to Fix&lt;/h3&gt;
&lt;p&gt;Sometimes this can happen because WinHTTP proxy settings have been configured on the management servers in the Unix/Linux Resource Pool, and the agent which we are trying to discover is not included in the Bypass List&lt;/p&gt;

&lt;p&gt;Open a CMD prompt as Administrator on the management servers in the Unix/Linux Resource Pool and run the following command&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;netsh winhttp show proxy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If there is a WinHTTP proxy server configured, add the FQDN for the server which we are trying to discover in the Bypass List by running the following command&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;netsh winhttp set proxy proxy-server=&quot;&amp;lt;proxyserver:port&amp;gt;&quot; bypass-list=&quot;*.ourdomain.com;*.yourdomain.com*;&amp;lt;serverFQDN&amp;gt;&quot; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once the Bypass List has been configured, check if discovery of the agent is now successful&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h2 id=&quot;note&quot;&gt;Note&lt;/h2&gt;
  &lt;p&gt;You can disable WinHTTP Proxy by running the following command, this will remove a proxy server and configure &lt;strong&gt;‚ÄúDirect Access‚Äù&lt;/strong&gt;:&lt;/p&gt;
  &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;netsh winhttp reset proxy
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h3 id=&quot;error-example-2&quot;&gt;Error Example 2&lt;/h3&gt;
&lt;p&gt;&lt;strong&gt;DiscoveryResult.ErrorData type. Please file bug report - Parameter name: lhs&lt;/strong&gt; &lt;br /&gt;
When discovering a Linux machine, the wizard shows the machine as unmanageable in the discovery results with below error:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Discovery not successful
Message: Unspecified failure
Details: Unexpected DiscoveryResult.ErrorData type. Please file bug report.
ErrorData: System.ArgumentNullException
Value cannot be null.
Parameter name: lhs
at System.Activities.WorkflowApplication.Invoke(Activity activity, IDictionary`2 inputs, WorkflowInstanceExtensionManager extensions, TimeSpan timeout)
at System.Activities.WorkflowInvoker.Invoke(Activity workflow, IDictionary`2 inputs, TimeSpan timeout, WorkflowInstanceExtensionManager extensions)
at Microsoft.SystemCenter.CrossPlatform.ClientActions.DefaultDiscovery.InvokeWorkflow(IManagedObject managementActionPoint, DiscoveryTargetEndpoint criteria, IInstallableAgents installableAgents)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;how-to-fix-1&quot;&gt;How to fix&lt;/h3&gt;
&lt;p&gt;Sometimes this can happen because of omsagent shell files in the installed kits folder.&lt;/p&gt;

&lt;p&gt;Navigate to the following directory in file explorer: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\Program Files\Microsoft System Center\Operations Manager\Server\AgentManagement\UnixAgents\DownloadedKits&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;If there are omsagent files listed here, move them to a temporary directory outside of the SCOM files.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/unix-linux-discovery-example-fix.png&quot; alt=&quot;Example of how to fix&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Once they have been moved from the DownloadedKits folder, retry discovery and discovery should now succeed (or you should get a different error which would indicate additional troubleshooting is needed such as sudoers, connectivity, etc.)&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/unix-linux-discovery-errors/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Welcome to GitHub Pages

You can use the [editor on GitHub](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/edit/master/docs/index.md) to maintain and preview the content for your website in Markdown files.

Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>June 22, 2022</pubDate>
        <link>https://blakedrumm.com/blog/unix-linux-discovery-errors/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/unix-linux-discovery-errors/</guid>
      </item>
    
      <item>
        <title>Error while installing SCOM 2019 Reporting</title>
        <postImage>/assets/img/posts/reporting-error-scom-ssrs.png</postImage>
        <description>&lt;h2 id=&quot;issue-description&quot;&gt;Issue Description&lt;/h2&gt;
&lt;p&gt;The issue I have seen is the following error message in the SCOM Reporting Services installer:&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;&lt;em&gt;‚ÄúUnable to connect to the Data Access service for this management server. Ensure the Data Access service is running and that the service, the management group, and setup are all the same version.‚Äù&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;The problem stems from an SCOM 2019 Update Rollup that was previously applied to the Management Server and this causes the SCOM Reporting Services to fail due to the Reporting Services installer expecting the RTM version to be present.&lt;/p&gt;

&lt;p&gt;The regression was introduced in &lt;a href=&quot;https://support.microsoft.com/en-us/topic/update-rollup-1-for-system-center-operations-manager-2019-kb4533415-e5ce3191-2403-684f-1980-43aa61b50cb6&quot;&gt;Update Rollup 1 for System Center Operations Manager 2019 (KB4533415)&lt;/a&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;The ‚ÄúOperations Manager Products‚Äù view in the Admin console did not update the Version column for the installed component version. This column now reflects the updated version of all the listed components.&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;solution&quot;&gt;Solution&lt;/h2&gt;
&lt;p&gt;The following may resolve the above error for you:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Start by connecting to the Operations Manager database via SQL Server Management Studio. &lt;strong&gt;(Create a backup of your Databases prior to any direct edits)&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Get the current version of the Management Server you are connecting SSRS with note the version &lt;em&gt;(we will use this later to revert the changes to the DB)&lt;/em&gt;&lt;/p&gt;

    &lt;h3 id=&quot;get-version&quot;&gt;Get Version&lt;/h3&gt;
    &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;c1&quot;&gt;-- SCOM 2019 RTM&lt;/span&gt;
 &lt;span class=&quot;c1&quot;&gt;-- 10.19.10050.0&lt;/span&gt;

 &lt;span class=&quot;c1&quot;&gt;-- SCOM 2019 UR1&lt;/span&gt;
 &lt;span class=&quot;c1&quot;&gt;-- 10.19.10311.0&lt;/span&gt;

 &lt;span class=&quot;c1&quot;&gt;-- SCOM 2019 UR1 - Hotfix for Alert Management&lt;/span&gt;
 &lt;span class=&quot;c1&quot;&gt;-- 10.19.10349.0&lt;/span&gt;

 &lt;span class=&quot;c1&quot;&gt;-- SCOM 2019 UR2&lt;/span&gt;
 &lt;span class=&quot;c1&quot;&gt;-- 10.19.10407.0&lt;/span&gt;

 &lt;span class=&quot;c1&quot;&gt;-- SCOM 2019 UR2 - Hotfix for Event Log Channel&lt;/span&gt;
 &lt;span class=&quot;c1&quot;&gt;-- 10.19.10475.0&lt;/span&gt;

 &lt;span class=&quot;c1&quot;&gt;-- SCOM 2019 UR3&lt;/span&gt;
 &lt;span class=&quot;c1&quot;&gt;-- 10.19.10505.0&lt;/span&gt;

 &lt;span class=&quot;c1&quot;&gt;-- SCOM 2019 UR3 - Hotfix for Web Console&lt;/span&gt;
 &lt;span class=&quot;c1&quot;&gt;-- 10.19.10550.0&lt;/span&gt;

 &lt;span class=&quot;c1&quot;&gt;-- SCOM 2019 UR3 - Hotfix Oct 2021&lt;/span&gt;
 &lt;span class=&quot;c1&quot;&gt;-- 10.19.10552.0&lt;/span&gt;

 &lt;span class=&quot;k&quot;&gt;select&lt;/span&gt;
     &lt;span class=&quot;n&quot;&gt;PrincipalName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
     &lt;span class=&quot;k&quot;&gt;Version&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MTV_HealthService&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;where&lt;/span&gt;
     &lt;span class=&quot;n&quot;&gt;IsManagementServer&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;and&lt;/span&gt; 
     &lt;span class=&quot;n&quot;&gt;PrincipalName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;MS01-2019.contoso.com&apos;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;&lt;img src=&quot;/assets/img/posts/ssrs-example-1.png&quot; alt=&quot;Example output for Management Server version SQL Query&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;We will run the following query to update the Management Server to the RTM version of SCOM 2019 (&lt;em&gt;10.19.10050.0&lt;/em&gt;):
    &lt;h3 id=&quot;update-version-to-rtm&quot;&gt;Update Version to RTM&lt;/h3&gt;
    &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;update&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MTV_HealthService&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;Version&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;10.19.10050.0&apos;&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;-- SCOM 2019 RTM&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PrincipalName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;MS01-2019.contoso.com&apos;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Install SCOM Reporting Services! :sunglasses: :thumbsup: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/install-scom-reporting.png&quot; alt=&quot;Install SCOM Reporting Services&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
  &lt;li&gt;After SCOM Reporting Services installs, you will need to revert the changes to the SCOM SQL Operations Manager database, run the following SQL Query to return the Management Server version back to the version returned in Step 2:
    &lt;h3 id=&quot;revert-change&quot;&gt;Revert Change&lt;/h3&gt;
    &lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;update&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;MTV_HealthService&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;set&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;Version&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;10.19.10552.0&apos;&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;-- SCOM 2019 UR3 - Hotfix Oct 2021&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;where&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PrincipalName&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;MS01-2019.contoso.com&apos;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=/blog/fix-install-bug-scom-2019-reporting/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Welcome to GitHub Pages

You can use the [editor on GitHub](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/edit/master/docs/index.md) to maintain and preview the content for your website in Markdown files.

Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>June 9, 2022</pubDate>
        <link>https://blakedrumm.com/blog/fix-install-bug-scom-2019-reporting/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/fix-install-bug-scom-2019-reporting/</guid>
      </item>
    
      <item>
        <title>Rebuild Performance Counters</title>
        <postImage>/assets/img/posts/recreate-perf-counters.png</postImage>
        <description>&lt;h2 id=&quot;how-to-rebuild&quot;&gt;How to Rebuild&lt;/h2&gt;
&lt;p&gt;Rebuild the Performance counters with the following Powershell Script, you can copy and paste the below script to a Powershell ISE Window running as &lt;strong&gt;Administrator&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Push-Location&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$PWD&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$FirstPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;C:\Windows\System32&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SecondPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;C:\Windows\SysWOW64&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cd&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$FirstPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;---------------------------------------------------------&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Recreating Performance Counters in: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$FirstPath&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos; - Running: lodctr /R&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lodctr&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;/R&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cd&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SecondPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;Recreating Performance Counters in: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$SecondPath&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos; - Running: lodctr /R&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;lodctr&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;/R&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;---------------------------------------------------------&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Resyncing the Performance Counters with Windows Management Instrumentation (WMI)&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos; - Running: C:\Windows\System32\wbem\WinMgmt.exe /RESYNCPERF&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;C:\Windows\System32\wbem\WinMgmt.exe&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;/RESYNCPERF&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;---------------------------------------------------------&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Restarting Service: Performance Logs &amp;amp; Alerts (pla)&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;pla&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Restart-Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Out-Null&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Warning&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;A Failure has occurred: &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Clear&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Output&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Restarting Service: Windows Management Instrumentation (winmgmt)&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;winmgmt&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Restart-Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Force&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Stop&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Out-Null&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Write-Warning&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;A Failure has occurred: &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Pop-Location&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/rebuild-perf-counters/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Introduction
The following event id inspired me to write this article:

```
Log Name:      Operations Manager
Source:        Health Service Modules
Date:          5/16/2022 2:47:00 PM
Event ID:      10103
Task Category: None
Level:         Warning
Keywords:      Classic
User:          N/A
Computer:      &lt;ManagementServerFQDN&gt;
Description:
In PerfDataSource, could not resolve counter instance OpsMgr DW Writer Module, Dropped Data Item Count, All Instances. Module will not be unloaded. 

One or more workflows were affected by this.  

Workflow name: Microsoft.SystemCenter.DataWarehouse.CollectionRule.Performance.Writer.DroppedDataItemCount 
Instance name: &lt;ManagementServerFQDN&gt; 
Instance ID: {3Z4DF6FB-B78C-33D9-BE0F-C84F7278AB92} 
Management group: &lt;ManagementGroupName&gt;
```

The above tells me: `could not resolve counter instance OpsMgr DW Writer Module` for some reason SCOM is no longer able to resolve some Performance Counter names on the Management Server, which causes some of the workflows for the SCOM Data Warehouse to fail.
--&gt;

&lt;!--
## Welcome to GitHub Pages

You can use the [editor on GitHub](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/edit/master/docs/index.md) to maintain and preview the content for your website in Markdown files.

Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>June 6, 2022</pubDate>
        <link>https://blakedrumm.com/blog/rebuild-perf-counters/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/rebuild-perf-counters/</guid>
      </item>
    
      <item>
        <title>Custom SQL Management Pack Invoke-SqlCmd Exception</title>
        <postImage>/assets/img/posts/invoke-sqlcmd.png</postImage>
        <description>&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;The customer noticed the issue was occurring inside of one of their custom Management Packs (MP) for SCOM SQL Blocking monitoring. They deployed this custom MP to two SCOM Management Groups. The Agents where we were seeing the issue were dual (multi) homed SCOM Agents that were SQL Servers (due to the way the MP was designed).&lt;/p&gt;

&lt;h2 id=&quot;script-section&quot;&gt;Script Section&lt;/h2&gt;
&lt;p&gt;The command inside of the custom Management Pack was &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Invoke-SqlCmd&lt;/code&gt;, which is apart of the built in &lt;a href=&quot;https://docs.microsoft.com/en-us/sql/powershell/sql-server-powershell?view=sql-server-ver15&quot;&gt;SQL Powershell Cmdlets&lt;/a&gt;:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$conn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MSSQL-2019&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ScriptName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Custom.SQLBlocking.Timed.Monitor.DataSource.ps1&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$WaitTimeMS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$WaitTime&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1000&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$blocked_session&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$null&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$sql1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;use master
                  SELECT r.session_id,
                  r.blocking_session_id,
                  s.login_name,
                  s.login_time,
                  s.program_name,
                  s.host_name,
                  s.memory_usage as Memory,
                  DB_NAME(r.database_id) AS DatabaseName,
                  r.wait_time,
                  r.command,
                  r.status,
                  r.cpu_time,
                  t.text as Query_Text
                  FROM sys.dm_exec_requests r
                  CROSS APPLY sys.dm_exec_sql_text(sql_handle) t
                  INNER JOIN sys.dm_exec_sessions s ON r.session_id = s.session_id
                  WHERE r.blocking_session_id &amp;lt;&amp;gt; 0 and wait_time &amp;gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$WaitTimeMS&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
          
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Clear&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;Try&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$blocked_session&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Invoke-Sqlcmd&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Query&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$sql1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ServerInstance&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$conn&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;Catch&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$momapi&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;LogScriptEvent&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$ScriptName&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;9994&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$error&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;...&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Invoke-SqlCmd&lt;/code&gt; in the above context should be able to successfully run with Local System (or a User Account) as the Action Account.&lt;/p&gt;

&lt;h2 id=&quot;catching-the-error&quot;&gt;Catching the error&lt;/h2&gt;
&lt;p&gt;We noticed the following error after the script above ran as a part of the Management Pack:&lt;/p&gt;

&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Custom.SQLBlocking.Timed.Monitor.DataSource.ps1 : ManagedBatchParser.ParserException
    at ManagedBatchParser.Parser.Parse()
    at Microsoft.SqlServer.Management.PowerShell.ExecutionProcessor.ExecuteTSql(String sqlCommand)
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;resolution&quot;&gt;Resolution&lt;/h2&gt;
&lt;p&gt;You will need to set the time intervals between the rules / monitors to run at a different interval than the other Management Group that is reporting to this same Agent / Group to cause it to be multi-homed.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;OR&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;You can remove the other Management Group and allow only 1 Management Server in the Agent Management control panel.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/custom-sql-mp-exception/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Welcome to GitHub Pages

You can use the [editor on GitHub](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/edit/master/docs/index.md) to maintain and preview the content for your website in Markdown files.

Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>May 2, 2022</pubDate>
        <link>https://blakedrumm.com/blog/custom-sql-mp-exception/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/custom-sql-mp-exception/</guid>
      </item>
    
      <item>
        <title>Verify Assemblies are loaded with GACUtil</title>
        <postImage>/assets/img/posts/gacutil-check.png</postImage>
        <description>&lt;h2 id=&quot;what-is-gac&quot;&gt;What is GAC?&lt;/h2&gt;

&lt;p&gt;Each computer where the Common Language Runtime is installed has a machine-wide code cache called the Global Assembly Cache. The Global Assembly Cache stores assemblies specifically designated to be shared by several applications on the computer. More information can be found here: &lt;a href=&quot;https://docs.microsoft.com/dotnet/framework/app-domains/gac&quot;&gt;https://docs.microsoft.com/dotnet/framework/app-domains/gac&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;prerequisites&quot;&gt;Prerequisites&lt;/h2&gt;
&lt;p&gt;Download and install the &lt;strong&gt;.NET 4.8 Framework Developer Pack&lt;/strong&gt; on the affected machine: &lt;a href=&quot;https://dotnet.microsoft.com/download/dotnet-framework/net48&quot;&gt;https://dotnet.microsoft.com/download/dotnet-framework/net48&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;check-the-currently-installed-assemblies&quot;&gt;Check the currently installed Assemblies&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;Open a &lt;strong&gt;&lt;em&gt;Powershell&lt;/em&gt;&lt;/strong&gt; or &lt;strong&gt;&lt;em&gt;Command Prompt&lt;/em&gt;&lt;/strong&gt; as &lt;strong&gt;Administrator&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Navigate to the installation directory: &lt;br /&gt;
 &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;cd &quot;C:\Program Files (x86)\Microsoft SDKs\Windows\v10.0A\bin\NETFX 4.8 Tools&quot;&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Run this GACUtil Command to List the Assemblies installed: &lt;br /&gt;
 &lt;strong&gt;Powershell:&lt;/strong&gt;
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\gacutil&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;/L&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;&lt;strong&gt;Command Prompt:&lt;/strong&gt;&lt;/p&gt;
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; gacutil /L
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/verify-assemblies-loaded-with-gacutil/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Welcome to GitHub Pages

You can use the [editor on GitHub](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/edit/master/docs/index.md) to maintain and preview the content for your website in Markdown files.

Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>April 22, 2022</pubDate>
        <link>https://blakedrumm.com/blog/verify-assemblies-loaded-with-gacutil/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/verify-assemblies-loaded-with-gacutil/</guid>
      </item>
    
      <item>
        <title>System Center Operations Manager - Data Warehouse Grooming Tool</title>
        <postImage>/assets/img/scom-dw-grooming-tool.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;

&lt;p&gt;This tool can be used to modify the System Center Operations Manager Data Warehouse Grooming retention days, allows you to see grooming history, you can manually run grooming, and you may also export the current configuration so you can keep a backup of your settings. You have the option of resetting the values to Defaults for the typical data sets in the Data Warehouse.&lt;/p&gt;

&lt;h2 id=&quot;arrow_down_small-latest-version&quot;&gt;:arrow_down_small: Latest Version&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/blakedrumm/SCOM-DW-Grooming-Tool/releases/latest&quot; class=&quot;img-shields-io&quot;&gt;&lt;img src=&quot;https://img.shields.io/github/v/release/blakedrumm/SCOM-DW-Grooming-Tool&quot; alt=&quot;Latest Version&quot; /&gt;&lt;/a&gt; &lt;br /&gt;
&lt;a href=&quot;https://github.com/blakedrumm/SCOM-DW-Grooming-Tool/releases&quot; class=&quot;img-shields-io&quot;&gt;&lt;img src=&quot;https://img.shields.io/github/downloads/blakedrumm/SCOM-DW-Grooming-Tool/total.svg?style=for-the-badge&amp;amp;color=brightgreen&quot; alt=&quot;Download Count Releases&quot; /&gt;&lt;/a&gt; &lt;br /&gt;
&lt;a href=&quot;https://aka.ms/SCOM-DW-Tool&quot; class=&quot;img-shields-io&quot;&gt;&lt;img src=&quot;https://img.shields.io/github/downloads/blakedrumm/SCOM-DW-Grooming-Tool/latest/SCOM-DW-GroomingGUI-EXE-64bit.zip?style=for-the-badge&amp;amp;color=brightgreen&quot; alt=&quot;Download Count Latest&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Check the changelog for the latest version: &lt;a href=&quot;https://github.com/blakedrumm/SCOM-DW-Grooming-Tool/releases/latest&quot;&gt;Latest Changes&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;page_with_curl-how-to-use&quot;&gt;:page_with_curl: How to Use&lt;/h2&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/blakedrumm/SCOM-DW-Grooming-Tool/releases/latest/download/SCOM-DW-GroomingGUI-EXE-64bit.zip&quot; target=&quot;_&quot;&gt;&lt;button class=&quot;btn btn-primary navbar-btn&quot;&gt;Get Started&lt;/button&gt;&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://aka.ms/SCOM-DW-Grooming-Tool&quot;&gt;https://aka.ms/SCOM-DW-Grooming-Tool&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;You have multiple ways to download the SCOM DW Grooming GUI Tool:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Download and install the MSI: &lt;a href=&quot;https://github.com/blakedrumm/SCOM-DW-Grooming-Tool/releases/latest/download/SCOM-DW-GroomingGUI-MSI.zip&quot;&gt;MSI Download&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Download and run the EXE: &lt;a href=&quot;https://github.com/blakedrumm/SCOM-DW-Grooming-Tool/releases/latest/download/SCOM-DW-GroomingGUI-EXE-64bit.zip&quot;&gt;EXE Downloads&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Download or Copy the Powershell Script to Powershell ISE: &lt;a href=&quot;https://github.com/blakedrumm/SCOM-DW-Grooming-Tool/releases/latest/download/SCOM-DW-GroomingGUI.ps1&quot;&gt;Powershell Script&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;Download or Copy the Powershell Script to Powershell ISE: &lt;a href=&quot;https://files.blakedrumm.com/SCOM-DW-GroomingGUI.txt&quot;&gt;Text Format Alternative Download Link&lt;/a&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;You will need to provide the Data Warehouse DB Server Name or Address, and the Data Warehouse Database Name. The script may auto detect these variables from the local registry on the machine you are running the script from. You can run on any machine that has network connectivity to the SCOM DW SQL Server. To get started, you will need to press the &lt;strong&gt;Get Current Settings&lt;/strong&gt; button. This will allow the script to gather the information from the Data Warehouse database server. Once you make the changes you can save the change with &lt;strong&gt;Set&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;This script will log some actions to the Application Event Log. Look for the Event Source: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SCOMDWTool&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;page_facing_up-more-information&quot;&gt;:page_facing_up: More Information&lt;/h2&gt;

&lt;p&gt;You will get prompted each time you run the script to accept the license agreement, unless you select do not ask me again, when you select this it will save a file to your ProgramData Directory: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\ProgramData\SCOM-DataWarehouseGUI-AgreedToLicense.log&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;If you have any questions or concerns, please leave a comment and I will do my best to assist!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scom-dw-grooming-tool/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Welcome to GitHub Pages

You can use the [editor on GitHub](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/edit/master/docs/index.md) to maintain and preview the content for your website in Markdown files.

Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>March 22, 2022</pubDate>
        <link>https://blakedrumm.com/blog/scom-dw-grooming-tool/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scom-dw-grooming-tool/</guid>
      </item>
    
      <item>
        <title>How to create a Certificate Template for Operations Manager</title>
        <postImage>/assets/img/posts/certificate-authority-template-guide/certificate-authority.png</postImage>
        <description>&lt;h2 id=&quot;steps-to-create-certificate-template&quot;&gt;Steps to Create Certificate Template&lt;/h2&gt;
&lt;h3 id=&quot;step-1&quot;&gt;Step 1&lt;/h3&gt;
&lt;p&gt;Open the Certificate Authority Tool: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-1.png&quot; alt=&quot;Open the Certificate Authority Tool&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-2&quot;&gt;Step 2&lt;/h3&gt;
&lt;p&gt;Expand the tree on the left and Right Click on &lt;strong&gt;Certificate Templates&lt;/strong&gt; and select &lt;strong&gt;Manage&lt;/strong&gt;: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-2.png&quot; alt=&quot;Open the Manage Certificate Templates Snap-In&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-3&quot;&gt;Step 3&lt;/h3&gt;
&lt;p&gt;Right Click on the &lt;strong&gt;IPSec (Offline request)&lt;/strong&gt; template display name, and select Duplicate Template: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-3.png&quot; alt=&quot;Select Duplicate Template on the IPSec (Offline request) template&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-4&quot;&gt;Step 4&lt;/h3&gt;
&lt;p&gt;Confirm the &lt;strong&gt;Compatibility&lt;/strong&gt; tab: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-4.png&quot; alt=&quot;Confirm Compatibility Tab&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-5&quot;&gt;Step 5&lt;/h3&gt;
&lt;p&gt;Confirm you have modified the following in the &lt;strong&gt;General&lt;/strong&gt; tab:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Template Display Name:&lt;/strong&gt; &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;System Center Operations Manager&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Validity period:&lt;/strong&gt; &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;5 years&lt;/code&gt; (change this per your security policy)&lt;/li&gt;
  &lt;li&gt;Check &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Publish certificate in Active Directory&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-5.png&quot; alt=&quot;Confirm General Tab&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-6&quot;&gt;Step 6&lt;/h3&gt;
&lt;p&gt;Confirm you have modified the following in the &lt;strong&gt;Request Handling&lt;/strong&gt; tab:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Check &lt;strong&gt;Allow private key to be exportable&lt;/strong&gt; (this is required for Server Authentication)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-6.png&quot; alt=&quot;Confirm Request Handling Tab&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-7&quot;&gt;Step 7&lt;/h3&gt;
&lt;p&gt;Confirm you have modified the following in the &lt;strong&gt;Cryptography&lt;/strong&gt; tab:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Verify &lt;strong&gt;Microsoft RSA SChannel Cryptographic Provider&lt;/strong&gt; is Checked&lt;/li&gt;
  &lt;li&gt;Under &lt;strong&gt;Providers&lt;/strong&gt; Check &lt;strong&gt;Microsoft Enhanced Cryptographic Provider v1.0&lt;/strong&gt; and move it to below &lt;strong&gt;Microsoft RSA SChannel Cryptographic Provider&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Verify &lt;strong&gt;Minimum key size&lt;/strong&gt; is set to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;2048&lt;/code&gt; or &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;1024&lt;/code&gt; (2048 adds CPU overhead)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-7.png&quot; alt=&quot;Confirm Cryptography Tab&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-8&quot;&gt;Step 8&lt;/h3&gt;
&lt;p&gt;Confirm that &lt;strong&gt;None&lt;/strong&gt; is selected for the &lt;strong&gt;Key Attestation&lt;/strong&gt; tab: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-8.png&quot; alt=&quot;Confirm Key Attestation Tab&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;step-9&quot;&gt;Step 9&lt;/h3&gt;
&lt;p&gt;Confirm you have modified the following in the &lt;strong&gt;Extensions&lt;/strong&gt; tab: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-9.png&quot; alt=&quot;Confirm Extensions Tab&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Click on &lt;strong&gt;Application Policies&lt;/strong&gt; and &lt;strong&gt;Edit&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;Remove &lt;strong&gt;IP security IKE intermediate&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-9-1.png&quot; alt=&quot;Confirm Extensions Tab - Application Policies Extension Removal&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
      &lt;li&gt;Add:
        &lt;ul&gt;
          &lt;li&gt;&lt;strong&gt;Client Authentication&lt;/strong&gt;&lt;/li&gt;
          &lt;li&gt;&lt;strong&gt;Server Authentication&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-9-2.png&quot; alt=&quot;Confirm Extensions Tab - Application Policies Extension Adding&quot; class=&quot;img-fluid&quot; /&gt;
            &lt;ul&gt;
              &lt;li&gt;Click &lt;strong&gt;OK&lt;/strong&gt;&lt;/li&gt;
            &lt;/ul&gt;
          &lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;Click on &lt;strong&gt;Key Usage&lt;/strong&gt; and &lt;strong&gt;Edit&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;Confirm you have checked:
        &lt;ul&gt;
          &lt;li&gt;&lt;strong&gt;Make this extension critical&lt;/strong&gt;&lt;/li&gt;
          &lt;li&gt;Click &lt;strong&gt;OK&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-9-3.png&quot; alt=&quot;Confirm Extensions Tab - Key Usage Extension Adding&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;step-10&quot;&gt;Step 10&lt;/h3&gt;
&lt;p&gt;Confirm you have modified the following in the &lt;strong&gt;Security&lt;/strong&gt; tab:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;You can add multiple types of objects here: Users, Computers, Service Accounts, Groups, or Built-in security principals. &lt;br /&gt;
  For simplicity I will keep the defaults and &lt;strong&gt;only&lt;/strong&gt; add the following permissions on &lt;strong&gt;Authenticated Users&lt;/strong&gt;:
    &lt;ul&gt;
      &lt;li&gt;&lt;strong&gt;Read&lt;/strong&gt;&lt;/li&gt;
      &lt;li&gt;&lt;strong&gt;Enroll&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-10.png&quot; alt=&quot;Confirm Security Tab&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
      &lt;li&gt;Click &lt;strong&gt;OK&lt;/strong&gt; to confirm / create the Certificate Template &lt;br /&gt;
  &lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-10-1.png&quot; alt=&quot;Certificate Template Created&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;step-11&quot;&gt;Step 11&lt;/h3&gt;
&lt;p&gt;Close the certificate templates Console.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;In the Certificate Authority tool, right click on &lt;strong&gt;Certificate Templates&lt;/strong&gt;
    &lt;ul&gt;
      &lt;li&gt;Hover over &lt;strong&gt;New&lt;/strong&gt; -&amp;gt; Select &lt;strong&gt;Certificate Template to Issue&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-11.png&quot; alt=&quot;Deploy with Certificate Template to Issue&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
      &lt;li&gt;Select the Certificate Template Display Name you created in Step 5: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-11-1.png&quot; alt=&quot;Select Certificate Template you Created&quot; class=&quot;img-fluid&quot; /&gt;
        &lt;ul&gt;
          &lt;li&gt;Click &lt;strong&gt;OK&lt;/strong&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;step-12&quot;&gt;Step 12&lt;/h3&gt;
&lt;p&gt;Verify you are seeing the Certificate Template on your Management Server.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Open Local Machine Certificate Store: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;certlm.msc&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Open Personal -&amp;gt; Certificates&lt;/li&gt;
  &lt;li&gt;Right Click Certificates and hover over &lt;strong&gt;All Tasks&lt;/strong&gt; -&amp;gt; Select &lt;strong&gt;Request New Certificate‚Ä¶&lt;/strong&gt; &lt;br /&gt;
  &lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-12.png&quot; alt=&quot;Select Request New Certificate on Management Server&quot; class=&quot;img-fluid&quot; /&gt;
    &lt;ul&gt;
      &lt;li&gt;Skip through the first screen
        &lt;ul&gt;
          &lt;li&gt;Click &lt;strong&gt;Next&lt;/strong&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Verify that you have selected &lt;strong&gt;Active Directory Enrollment Policy&lt;/strong&gt;
        &lt;ul&gt;
          &lt;li&gt;Click &lt;strong&gt;Next&lt;/strong&gt;
&lt;!-- ![Request Certificate from Management Server](/assets/img/posts/certificate-authority-template-guide/step-12.png){:class=&quot;img-fluid&quot;} --&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;Select the checkbox  next to the Certificate Template you created and click on the Warning sign below the Certificate Template, it says &lt;strong&gt;click here to configure settings.&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-12-1.png&quot; alt=&quot;Certificate Template showing up on Management Server&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;Example of how to configure the certificate to be used by a Management Server &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-12-2.png&quot; alt=&quot;Configure Certificate&quot; class=&quot;img-fluid&quot; /&gt;
        &lt;ul&gt;
          &lt;li&gt;Click &lt;strong&gt;OK&lt;/strong&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;Click on &lt;strong&gt;Enroll&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-authority-template-guide/step-12-3.png&quot; alt=&quot;Configure Certificate&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;step-13&quot;&gt;Step 13&lt;/h3&gt;
&lt;p&gt;In order to use certificates with System Center Operations Manager you will need to generate / perform run the MOMCertImport tool on atleast one of the Management Servers, and any servers that will communicate via Certificates (DMZ servers, Workgroup Machines, etc.).&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MOMCertImport.exe&lt;/code&gt; is located in your System Center Operations Manager Installation Media inside of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SupportTools\AMD64&lt;/code&gt;.
    &lt;ul&gt;
      &lt;li&gt;Right Click on &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;MOMCertImport.exe&lt;/code&gt; and select &lt;strong&gt;Run as administrator&lt;/strong&gt;
        &lt;ul&gt;
          &lt;li&gt;Select the certificate you generated via the System Center Operations Manager Certificate Template.&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;step-14&quot;&gt;Step 14&lt;/h3&gt;
&lt;p&gt;Restart the Microsoft Monitoring Agent with the following Powershell Command:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Restart-Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;HealthService&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After restarting the Microsoft Monitoring Agent (HealthService). You will wait until you see the following Event (&lt;strong&gt;Event ID:&lt;/strong&gt; 20053) in the Operations Manager Event Log confirming that the certificate has been loaded:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Log Name: Operations Manager
Source: OpsMgr Connector
Date: 2/28/2022 10:35:36 AM
Event ID: 20053
Task Category: None
Level: Information
Keywords: Classic
User: N/A
Computer: MS01-2019.contoso.com
Description:
The OpsMgr Connector has loaded the specified authentication certificate successfully.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;h2 id=&quot;bangbang-important&quot;&gt;:bangbang: Important&lt;/h2&gt;
  &lt;p&gt;You may experience issues when a certificate Re-enrolls automatically. Operations Manager needs the certificate to be imported with MOMCertImport.exe prior to being able to be used by SCOM. Unfortunately, there is not an automated method for SCOM Certificate Management.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;blockquote&gt;
  &lt;h2 id=&quot;notebook-note&quot;&gt;:notebook: Note&lt;/h2&gt;
  &lt;p&gt;You may experience issues with connectivity between the remote machine and the Management Server(s), verify you have checked these things:&lt;/p&gt;
  &lt;ol&gt;
    &lt;li&gt;Ensure all SPN‚Äôs are correctly registered for Management Servers, Operations Manager &amp;amp; Data Warehouse Databases, and services that are utilizing them.&lt;/li&gt;
    &lt;li&gt;Event ID &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;20071&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;21016&lt;/code&gt; on Gateway point to Firewall, SPN, or Certificate issue in most cases.&lt;/li&gt;
    &lt;li&gt;Run the Gateway Approval Tool using the SDK (Data Access Service) account OR an account with high permission level (SysAdmin privileges) to Operations Manager SQL DB.&lt;/li&gt;
    &lt;li&gt;Verify you selected the appropriate certificate when you run MOMCertImport, check the certificate properties.
      &lt;ul&gt;
        &lt;li&gt;You may also check the following registry path: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HKEY_LOCAL_MACHINE\Software\Microsoft\Microsoft OperationsManager\3.0\Machine Settings&lt;/code&gt;
          &lt;ul&gt;
            &lt;li&gt;Check the key: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;ChannelCertificateSerialNumber&lt;/code&gt; this is the serial number of the certificate you imported, reversed.&lt;/li&gt;
          &lt;/ul&gt;
        &lt;/li&gt;
      &lt;/ul&gt;
    &lt;/li&gt;
    &lt;li&gt;Verify that there are not any other certificates in the Local Machine Personal Store that have matching Subject Names.&lt;/li&gt;
    &lt;li&gt;Operations Manager only uses the first CN name in the Subject of the Certificate.&lt;/li&gt;
    &lt;li&gt;Cryptography API Key Storage Provider (&lt;a href=&quot;/windows/win32/secgloss/k-gly?redirectedfrom=MSDN#_security_key_storage_provider_gly&quot;&gt;KSP&lt;/a&gt;) is not supported for Operations Manager certificates.&lt;/li&gt;
  &lt;/ol&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/create-operations-manager-certificate-template/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>February 28, 2022</pubDate>
        <link>https://blakedrumm.com/blog/create-operations-manager-certificate-template/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/create-operations-manager-certificate-template/</guid>
      </item>
    
      <item>
        <title>SCOM Unix/Linux RunAs Account View - System.Xml.XmlException</title>
        <postImage>/assets/img/posts/unix-linux-runas-accounts-missing.png</postImage>
        <description>&lt;p&gt;I received a case today for a customer who is having issues when attempting to open the RunAs Account view for Unix/Linux RunAs Accounts in the SCOM Console (&lt;strong&gt;Administration Tab-&amp;gt; Run As Configuration -&amp;gt; Unix/Linux Accounts&lt;/strong&gt;). We were unable to return any Unix/Linux RunAs Accounts in the SCOM Console, even though we can create new ones, they are not populating in the list of RunAs Accounts for Unix/Linux.&lt;/p&gt;

&lt;p&gt;We noticed an exception that will pop-up intermittently (while Console is idle or active):&lt;/p&gt;

&lt;h2 id=&quot;pop-up-exception&quot;&gt;Pop-Up Exception&lt;/h2&gt;
&lt;pre&gt;
   __Date:__ 2/1/2022 1:29:19 PM 
   __Application:__ Operations Manager 
   __Application Version:__ 10.19.10505.0 
   __Severity:__ Error 
   __Message:__ 
   System.Xml.XmlException: Data at the root level is invalid. Line 1, position 1. 
   at System.Xml.XmlTextReaderImpl.Throw(Exception e) 
   at System.Xml.XmlTextReaderImpl.ParseRootLevelWhitespace() 
   at System.Xml.XmlTextReaderImpl.ParseDocumentContent() 
   at System.Xml.XmlLoader.Load(XmlDocument doc, XmlReader reader, Boolean preserveWhitespace) 
   at System.Xml.XmlDocument.Load(XmlReader reader) 
   at System.Xml.XmlDocument.LoadXml(String xml)  
   at Microsoft.SystemCenter.CrossPlatform.ClientLibrary.CredentialManagement.Core.ScxRunAsAccountHelper. DeserializeToScxRunAsAccount(ScxCredentialRef credentialRef) 
   at System.Linq.Enumerable.WhereSelectListIterator\`2.MoveNext() 
   at System.Collections.Generic.List\`1..ctor(IEnumerable\`1 collection) 
   at System.Linq.Enumerable.ToList\[TSource](IEnumerable\`1 source)  
   at Microsoft.SystemCenter.CrossPlatform.ClientLibrary.CredentialManagement.Core.ScxRunAsAccountHelper. EnumerateScxRunAsAccount(IManagementGroupConnection managementGroupConnection) 
   at Microsoft.SystemCenter.CrossPlatform.UI.OM.Integration.Administration.ScxRunAsAccountInfoFactory.EnumerateScxRunAsAccount() 
   at Microsoft.SystemCenter.CrossPlatform.UI.OM.Integration.Administration.ScxRunAsAccountHelper.&lt;span style=&quot;color:yellow&quot;&gt;&amp;lt;GetScxRunAsAccountInstances&amp;gt;&lt;/span&gt;b__6(Object sender, ConsoleJobEventArgs e) 
   at Microsoft.EnterpriseManagement.Mom.Internal.UI.Console.ConsoleJobExceptionHandler.ExecuteJob(IComponent component, EventHandler`1 job, Object sender, ConsoleJobEventArgs args)
   &lt;/pre&gt;

&lt;h2 id=&quot;full-exception&quot;&gt;Full Exception&lt;/h2&gt;
&lt;pre&gt;
DetailID = 4
Count: 1
Type: System.Xml.XmlException
Message: Data at the root level is invalid. Line 1, position 1.
Stack:
[HelperMethodFrame]
System.Xml.XmlTextReaderImpl.Throw(System.Exception)
System.Xml.XmlTextReaderImpl.ParseRootLevelWhitespace()
System.Xml.XmlTextReaderImpl.ParseDocumentContent()
System.Xml.XmlLoader.Load(System.Xml.XmlDocument, System.Xml.XmlReader, Boolean)
System.Xml.XmlDocument.Load(System.Xml.XmlReader)
System.Xml.XmlDocument.LoadXml(System.String)
Microsoft.SystemCenter.CrossPlatform.ClientLibrary.CredentialManagement.Core.ScxRunAsAccountHelper.DeserializeToScxRunAsAccount(Microsoft.SystemCenter.CrossPlatform.ClientLibrary.Common.SDKAbstraction.ScxCredentialRef)
System.Linq.Enumerable+WhereSelectListIterator`2[[System.__Canon, mscorlib],[System.__Canon, mscorlib]].MoveNext()
System.Collections.Generic.List`1[[System.__Canon, mscorlib]]..ctor(System.Collections.Generic.IEnumerable`1&amp;lt;System.__Canon&amp;gt;)
System.Linq.Enumerable.ToList[[System.__Canon, mscorlib]](System.Collections.Generic.IEnumerable`1&amp;lt;System.__Canon&amp;gt;)
Microsoft.SystemCenter.CrossPlatform.ClientLibrary.CredentialManagement.Core.ScxRunAsAccountHelper.EnumerateScxRunAsAccount(Microsoft.SystemCenter.CrossPlatform.ClientLibrary.Common.SDKAbstraction.IManagementGroupConnection)
Microsoft.SystemCenter.CrossPlatform.UI.OM.Integration.Administration.ScxRunAsAccountInfoFactory.EnumerateScxRunAsAccount()
Microsoft.SystemCenter.CrossPlatform.UI.OM.Integration.Administration.ScxRunAsAccountHelper.&lt;span style=&quot;color:yellow&quot;&gt;&amp;lt;GetScxRunAsAccountInstances&amp;gt;&lt;/span&gt;b__6(System.Object, Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobEventArgs)
Microsoft.EnterpriseManagement.Mom.Internal.UI.Console.ConsoleJobExceptionHandler.ExecuteJob(System.ComponentModel.IComponent, System.EventHandler`1&amp;lt;Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobEventArgs&amp;gt;, System.Object, Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobEventArgs)
Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobsService.RunJob(Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobDescription)
Microsoft.EnterpriseManagement.ConsoleFramework.WindowJobsService.RunAsyncJobInThisThread(Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobDescription)
Microsoft.EnterpriseManagement.ConsoleFramework.WindowJobsService.RunJob(Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobDescription)
Microsoft.EnterpriseManagement.ConsoleFramework.WindowJobsService.RunJob(System.ComponentModel.IComponent, System.EventHandler`1&amp;lt;Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobEventArgs&amp;gt;, System.EventHandler`1&amp;lt;Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobErrorEventArgs&amp;gt;, System.Object[])
Microsoft.EnterpriseManagement.ConsoleFramework.WindowJobsService.RunJob(System.ComponentModel.IComponent, System.EventHandler`1&amp;lt;Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobEventArgs&amp;gt;, System.Object[])
Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobs.RunJob(System.ComponentModel.IComponent, System.EventHandler`1&amp;lt;Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobEventArgs&amp;gt;, System.Object[])
Microsoft.SystemCenter.CrossPlatform.UI.OM.Integration.Administration.RunAsAccountQuery.DoQuery(System.String)
Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.Query`1[[System.__Canon, mscorlib]].DoQuery(System.String, System.Nullable`1&amp;lt;System.DateTime&amp;gt;)
Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.Query`1[[System.__Canon, mscorlib]].FullUpdateQuery(Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.CacheSession, Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.IndexTable ByRef, Boolean, System.DateTime)
Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.Query`1[[System.__Canon, mscorlib]].InternalSyncQuery(Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.CacheSession, Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.IndexTable, Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.UpdateReason, Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.UpdateType)
Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.Query`1[[System.__Canon, mscorlib]].InternalQuery(Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.CacheSession, Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.UpdateReason)
Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.Query`1[[System.__Canon, mscorlib]].TryDoQuery(Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.UpdateReason, Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.CacheSession)
Microsoft.EnterpriseManagement.Mom.Internal.UI.Console.ConsoleJobExceptionHandler.ExecuteJob(System.ComponentModel.IComponent, System.EventHandler`1&amp;lt;Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobEventArgs&amp;gt;, System.Object, Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobEventArgs)
Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobsService.RunJob(Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobDescription)
Microsoft.EnterpriseManagement.ConsoleFramework.WindowJobsService.RunAsyncJobInThisThread(Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobDescription)
Microsoft.EnterpriseManagement.ConsoleFramework.WindowJobsService.RunJob(Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobDescription)
Microsoft.EnterpriseManagement.ConsoleFramework.WindowJobsService.RunJob(System.ComponentModel.IComponent, System.EventHandler`1&amp;lt;Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobEventArgs&amp;gt;, System.EventHandler`1&amp;lt;Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobErrorEventArgs&amp;gt;, System.Object[])
Microsoft.EnterpriseManagement.ConsoleFramework.WindowJobsService.RunJob(System.ComponentModel.IComponent, System.EventHandler`1&amp;lt;Microsoft.EnterpriseManagement.ConsoleFramework.ConsoleJobEventArgs&amp;gt;, System.Object[])
Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.Query`1[[System.__Canon, mscorlib]].DoQuery(Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.UpdateReason, Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.CacheSession)
Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.QueryBase.Update(Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.UpdateReason, Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.CacheSession)
Microsoft.EnterpriseManagement.Mom.Internal.UI.Cache.DataCache.Polling()
System.Threading.ExecutionContext.RunInternal(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object, Boolean)
System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object, Boolean)
System.Threading.ExecutionContext.Run(System.Threading.ExecutionContext, System.Threading.ContextCallback, System.Object)
System.Threading.ThreadHelper.ThreadStart()
[GCFrame]
[DebuggerU2MCatchHandlerFrame]
&lt;/pre&gt;

&lt;h2 id=&quot;how-to-resolve&quot;&gt;How to Resolve&lt;/h2&gt;
&lt;p&gt;First we ran the following Powershell command output to gather RunAs Accounts related to Unix/Linux:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMRunAsAccount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;AccountType&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-like&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SCX*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We compared the above output to the accounts we can choose in the RunAs Profile for Unix/Linux Action Account. We noticed an entry that was not in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Get-SCOMRunAsAccount&lt;/code&gt; command run above:
&lt;img src=&quot;/assets/img/posts/unix-linux-runas-accounts-orphaned.png&quot; alt=&quot;Orphaned RunAs Accounts&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I asked the customer if he is comfortable with removing the RunAs Account and re-adding the Account. He said this was fine, so we proceeded to remove the RunAs Account like this:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMRunAsAccount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-eq&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Test&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Remove-SCOMRunAsAccount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h1 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h1&gt;
&lt;p&gt;Removing the &lt;strong&gt;Orphaned RunAs account&lt;/strong&gt; allowed the Unix/Linux RunAs Account view to populate as intended. You can only remove these Orphaned RunAs accounts with the Powershell Commands: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Get-SCOMRunAsAccount&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Remove-SCOMRunAsAccount&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scom-unix-linux-runasaccount-view-error/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>February 1, 2022</pubDate>
        <link>https://blakedrumm.com/blog/scom-unix-linux-runasaccount-view-error/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scom-unix-linux-runasaccount-view-error/</guid>
      </item>
    
      <item>
        <title>How to resolve SCOM Notifications Stopped &amp; No New Alerts</title>
        <postImage>/assets/img/posts/SCOM-Notification-Bell-Email.png</postImage>
        <description>&lt;p&gt;First thing I noticed was that the SCOM Management Servers had an SCOM Agent Installed on it. We verifing by navigating to the following location, you can see the &lt;strong&gt;Agent Management Groups&lt;/strong&gt;:
 &lt;img src=&quot;/assets/img/posts/agent-registry-scom-ms.png&quot; alt=&quot;Management Server - Bad Registry Keys&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Apparently the Operations Manager Management Server received a package from SCCM, and this attempted to automatically install the SCOM Agent (Microsoft Monitoring Agent). And during this process the installer overwrote some registry keys inside of the following location: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Microsoft Operations Manager\3.0\&lt;/code&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h2 id=&quot;precaution&quot;&gt;Precaution&lt;/h2&gt;
  &lt;p&gt;Take care when directly modifying the Registry via &lt;a href=&quot;https://support.microsoft.com/windows/how-to-open-registry-editor-in-windows-10-deab38e6-91d6-e0aa-4b7c-8878d9e07b11&quot;&gt;regedit.exe&lt;/a&gt;. If you insist on making changes, always backup the registry first. There is always the possibility you can cause more damage than you are fixing.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;I had the customer Delete the &lt;strong&gt;Agent Management Groups&lt;/strong&gt; key and we matched / created the Registry Values for &lt;strong&gt;Server Management Groups&lt;/strong&gt; compared to my lab environment. We needed to create the Management Group Name Key in my situation.
&lt;img src=&quot;/assets/img/posts/management-server-registry.png&quot; alt=&quot;Management Server - Good Registry Keys&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After doing this we cleared the cache on the SCOM Management Servers by running the following PowerShell script: &lt;br /&gt;
&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/Clear-SCOMCache.ps1&quot;&gt;SCOM-Scripts-and-SQL/Clear-SCOMCache.ps1 at master ¬∑ blakedrumm/SCOM-Script-and-SQL&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We waited for a few minutes after clearing the SCOM Management Server cache. The Management Servers were coming back online, but they were still not receiving new Alerts, and there were not any Notification Emails.&lt;/p&gt;

&lt;p&gt;While reviewing the Operations Manager Event Logs, we found that there were 2115 Errors indicating an issue with the insertion of Discovery and other related data:&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;event-1&quot;&gt;Event 1&lt;/h2&gt;
&lt;pre&gt;
  __Log Name:__      Operations Manager 
  __Source:__        HealthService 
  __Date:__          1/20/2022 3:42:02 PM 
  __Event ID:__      2115 
  __Task Category:__ None 
  __Level:__         Warning 
  __Keywords:__      Classic 
  __User:__          N/A 
  __Computer:__      ManagementServer1.contoso.com 
  __Description:__ 
  A Bind Data Source in Management Group ManagementGroup1 has posted items to the workflow, but has not received a response in 480 seconds.  This indicates a performance or functional problem with the workflow. 
  __Workflow Id :__ &lt;span style=&quot;color:yellow&quot;&gt;Microsoft.SystemCenter.CollectEventData&lt;/span&gt; 
  __Instance    :__ ManagementServer1.contoso.com 
  __Instance Id :__ {AEC38E5Z-67A9-0406-20DB-ACC33BB9C4A4}
  &lt;/pre&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;event-2&quot;&gt;Event 2&lt;/h2&gt;
&lt;pre&gt;
  __Log Name:__      Operations Manager 
  __Source:__        HealthService 
  __Date:__          1/20/2022 3:42:02 PM 
  __Event ID:__      2115 
  __Task Category:__ None 
  __Level:__         Warning 
  __Keywords:__      Classic 
  __User:__          N/A 
  __Computer:__      ManagementServer1.contoso.com 
  __Description:__ 
  A Bind Data Source in Management Group ManagementGroup1 has posted items to the workflow, but has not received a response in 480 seconds.  This indicates a performance or functional problem with the workflow. 
  __Workflow Id :__ &lt;span style=&quot;color:yellow&quot;&gt;Microsoft.SystemCenter.CollectPerformanceData&lt;/span&gt; 
  __Instance    :__ ManagementServer1.contoso.com 
  __Instance Id :__ {AEC38E5Z-67A9-0406-20DB-ACC33BB9C4A4}
  &lt;/pre&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;event-3&quot;&gt;Event 3&lt;/h2&gt;
&lt;pre&gt;
  __Log Name:__      Operations Manager 
  __Source:__        HealthService 
  __Date:__          1/20/2022 3:42:02 PM 
  __Event ID:__      2115 
  __Task Category:__ None 
  __Level:__         Warning 
  __Keywords:__      Classic 
  __User:__          N/A 
  __Computer:__      ManagementServer1.contoso.com 
  __Description:__ 
  A Bind Data Source in Management Group ManagementGroup1 has posted items to the workflow, but has not received a response in 480 seconds.  This indicates a performance or functional problem with the workflow. 
  __Workflow Id :__ &lt;span style=&quot;color:yellow&quot;&gt;Microsoft.SystemCenter.CollectPublishedEntityState&lt;/span&gt; 
  __Instance    :__ ManagementServer1.contoso.com 
  __Instance Id :__ {AEC38E5Z-67A9-0406-20DB-ACC33BB9C4A4}
  &lt;/pre&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;event-4&quot;&gt;Event 4&lt;/h2&gt;
&lt;pre&gt;
  __Log Name:__      Operations Manager 
  __Source:__        HealthService 
  __Date:__          1/20/2022 3:42:03 PM 
  __Event ID:__      2115 
  __Task Category:__ None 
  __Level:__         Warning 
  __Keywords:__      Classic 
  __User:__          N/A 
  __Computer:__      ManagementServer1.contoso.com 
  __Description:__ 
  A Bind Data Source in Management Group ManagementGroup1 has posted items to the workflow, but has not received a response in 480 seconds.  This indicates a performance or functional problem with the workflow. 
  __Workflow Id :__ &lt;span style=&quot;color:yellow&quot;&gt;Microsoft.SystemCenter.CollectSignatureData&lt;/span&gt; 
  __Instance    :__ ManagementServer1.contoso.com 
  __Instance Id :__ {AEC38E5Z-67A9-0406-20DB-ACC33BB9C4A4}
  &lt;/pre&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;event-5&quot;&gt;Event 5&lt;/h2&gt;
&lt;pre&gt;
  __Log Name:__      Operations Manager 
  __Source:__        HealthService 
  __Date:__          1/20/2022 3:42:30 PM 
  __Event ID:__      2115 
  __Task Category:__ None 
  __Level:__         Warning 
  __Keywords:__      Classic 
  __User:__          N/A 
  __Computer:__      ManagementServer1.contoso.com 
  __Description:__ 
  A Bind Data Source in Management Group ManagementGroup1 has posted items to the workflow, but has not received a response in 480 seconds.  This indicates a performance or functional problem with the workflow. 
  __Workflow Id :__ &lt;span style=&quot;color:yellow&quot;&gt;Microsoft.SystemCenter.CollectDiscoveryData&lt;/span&gt; 
  __Instance    :__ ManagementServer1.contoso.com 
  __Instance Id :__ {AEC38E5Z-67A9-0406-20DB-ACC33BB9C4A4}
  &lt;/pre&gt;

&lt;hr /&gt;

&lt;p&gt;We reviewed the current SQL Logs and found that there were authentication failures that indicated the &lt;strong&gt;Computer Account&lt;/strong&gt; for the SCOM Management Server didnt have permission to the Database. This lead us to check the &lt;strong&gt;Default Action Account&lt;/strong&gt; in Run As Profiles. We modified the &lt;strong&gt;Default Action Account&lt;/strong&gt; for the Management Servers to be assigned an &lt;strong&gt;Windows Action Account&lt;/strong&gt; instead of &lt;strong&gt;Local System&lt;/strong&gt;. This resolved the issue and now Notifications and Alerts are being being sent normally.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scom-notifications-and-alerts-stopped-working/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>January 28, 2022</pubDate>
        <link>https://blakedrumm.com/blog/scom-notifications-and-alerts-stopped-working/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scom-notifications-and-alerts-stopped-working/</guid>
      </item>
    
      <item>
        <title>UNIX/Linux System Center Operations Manager Agents Troubleshooting Tips</title>
        <postImage>/assets/img/posts/prerequisite-software-unix-linux.png</postImage>
        <description>&lt;p&gt;&lt;sub&gt;This post was last updated on September 27th, 2023&lt;/sub&gt;&lt;/p&gt;
&lt;h2 id=&quot;build-list-containing-the-scom-linux-agent-versions&quot;&gt;Build list containing the SCOM Linux Agent versions&lt;/h2&gt;
&lt;p&gt;The following url contains the versions of the SCX Agent: &lt;a href=&quot;https://docs.microsoft.com/system-center/scom/release-build-versions&quot;&gt;https://docs.microsoft.com/system-center/scom/release-build-versions&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;verify-the-versions-for-all-prerequisite-software&quot;&gt;Verify the versions for all prerequisite software&lt;/h2&gt;
&lt;p&gt;You can run the following command on a monitored and not monitored server to compare the software installed, or verify with the official list &lt;a href=&quot;https://docs.microsoft.com/system-center/scom/plan-supported-crossplat-os&quot;&gt;https://docs.microsoft.com/system-center/scom/plan-supported-crossplat-os&lt;/a&gt;:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rpm &lt;span class=&quot;nt&quot;&gt;-qa&lt;/span&gt; | egrep &lt;span class=&quot;s2&quot;&gt;&quot;^glibc|^openssl|^pam|^scx|^omi&quot;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;table class=&quot;table table-hover table-text d-block overflow-auto&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Agent Version&lt;/th&gt;
      &lt;th&gt;Version&lt;/th&gt;
      &lt;th&gt;Management Group Version&lt;/th&gt;
      &lt;th&gt;Release Date&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;scx-1.5.1-242.e16.x86_64&lt;/td&gt;
      &lt;td&gt;7.5.1068.0&lt;/td&gt;
      &lt;td&gt;SCOM 2012 R2 UR12&lt;/td&gt;
      &lt;td&gt;01/27/2017&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Working Example:&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/prerequisite-software-unix-linux-example2.png&quot; alt=&quot;Example 2 - Prerequisite Software&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;Non-working Example:&lt;/strong&gt; &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/prerequisite-software-unix-linux-example3-notworking.png&quot; alt=&quot;Example 3 - Prerequisite Software&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;h2 id=&quot;clearing-the-system-security-services-daemon-sssd-cache&quot;&gt;Clearing the System Security Services Daemon (SSSD) Cache&lt;/h2&gt;
&lt;p&gt;The System Security Services Daemon (SSSD) provides access to identity and authentication providers. Basically rather than relying on locally configured authentication, SSSD is used to lookup its local cache. The entries within this cache may come from different remote identity providers, such as an LDAP directory, Kerberos, or Active Directory for example.&lt;/p&gt;

&lt;p&gt;SSSD caches the results of users and credentials from these remote locations so that if the identity provider goes offline, the user credentials are still available and users can still login. This helps to improve performance and facilitates scalability with a single user that can login over many systems, rather than using local accounts everywhere.&lt;/p&gt;

&lt;p&gt;The cached results can potentially be problematic if the stored records become stale and are no longer in sync with the identity provider, so it is important to know how to flush the SSSD cache to fix various problems and update the cache.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;notebook-note&quot;&gt;:notebook: Note&lt;/h3&gt;
  &lt;p&gt;It‚Äôs recommend to only clear the sssd cache if the identity provider servers performing the authentication within the domain are available, otherwise users will not be able to log in once the sssd cache has been flushed.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;stop-sssd-service&quot;&gt;Stop SSSD Service&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Service sssd stop; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;clear-sssd-cache&quot;&gt;Clear SSSD Cache&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;rm -rf /var/lib/sss/db/*; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;start-sssd-service&quot;&gt;Start SSSD Service&lt;/h3&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;service sssd start
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;SSSD should now start up correctly with an empty cache, any user login will now first go directly to the defined identity provider for authentication, and then be cached locally afterwards.&lt;/p&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;h2 id=&quot;tail-the-logs&quot;&gt;Tail the Logs&lt;/h2&gt;
&lt;h3 id=&quot;enable-verbose-scx-logs&quot;&gt;Enable Verbose SCX Logs&lt;/h3&gt;
&lt;p&gt;Use the below command to enable verbose logging for the SCX Provider:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;scxadmin &lt;span class=&quot;nt&quot;&gt;-log-set&lt;/span&gt; all verbose
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;enable-verbose-logging-for-omi-server&quot;&gt;Enable Verbose logging for OMI Server&lt;/h3&gt;
&lt;p&gt;Use the below command to modify the omiserver.conf file. Change loglevel to one of the following valid options, verbose being highest:
&lt;strong&gt;ERROR, WARNING, INFO, DEBUG, VERBOSE&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;vim /etc/opt/omi/conf/omiserver.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If loglevel does not exist in the file you can add the following lines to the file and change the loglevel value&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;##&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## loglevel -- set the loggiing options for OMI server&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;##   Valid options are: ERROR, WARNING, INFO, DEBUG, VERBOSE (debug build)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;##   If commented out, then default value is: WARNING&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;##&lt;/span&gt;
loglevel &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; INFO
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After saving and quitting vim, restart the service with below command for logging to be enabled&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;sudo&lt;/span&gt; /opt/omi/bin/service_control restart
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;secure-log&quot;&gt;Secure Log&lt;/h3&gt;
&lt;p&gt;You can run the following command to show current log data pertaining to authentication and authorization privileges:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; /var/log/secure
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;messages-log&quot;&gt;Messages Log&lt;/h3&gt;
&lt;p&gt;You can run the following command to show all the global system messages, including the messages that are logged during system startup:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; /var/log/messages
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;omi&quot;&gt;OMI&lt;/h3&gt;
&lt;h4 id=&quot;server-log&quot;&gt;Server Log&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; /var/opt/omi/log/omiserver.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;agent-log&quot;&gt;Agent Log&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; /var/opt/microsoft/scx/log/omiagent.root.root.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;scx&quot;&gt;SCX&lt;/h3&gt;
&lt;h4 id=&quot;agent-log-1&quot;&gt;Agent Log&lt;/h4&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;tail&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; /var/opt/microsoft/scx/log/scx.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;h2 id=&quot;verify-openssl-s_client&quot;&gt;Verify OpenSSL s_client&lt;/h2&gt;
&lt;p&gt;The OpenSSL s_client command is a helpful test client for troubleshooting remote SSL or TLS connections:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;openssl s_client &lt;span class=&quot;nt&quot;&gt;-connect&lt;/span&gt; server.domain.com:1270
openssl s_client &lt;span class=&quot;nt&quot;&gt;-connect&lt;/span&gt; server.domain.com:1270 &lt;span class=&quot;nt&quot;&gt;-tls1&lt;/span&gt;
openssl s_client &lt;span class=&quot;nt&quot;&gt;-connect&lt;/span&gt; server.domain.com:1270 &lt;span class=&quot;nt&quot;&gt;-ssl3&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;check-linux-ciphers&quot;&gt;Check Linux Ciphers&lt;/h2&gt;

&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;openssl ciphers &lt;span class=&quot;nt&quot;&gt;-V&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;h2 id=&quot;get-mb--gb-size-of-file&quot;&gt;Get MB / GB size of file&lt;/h2&gt;
&lt;p&gt;Run the following command to gather the MB / GB size of a file:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;du&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sh&lt;/span&gt; /var/opt/microsoft/scx/log/scx.log
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;h2 id=&quot;winrm-enumerate-scx-agent&quot;&gt;WinRM Enumerate SCX Agent&lt;/h2&gt;
&lt;p&gt;From the Management Server(s) in the Unix/Linux Resource Pool, verify that the following command resolves correctly:&lt;/p&gt;

&lt;h3 id=&quot;basic-authentication&quot;&gt;Basic Authentication&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-cmd&quot;&gt;winrm enumerate http://schemas.microsoft.com/wbem/wscim/1/cim-schema/2/SCX_Agent?__cimnamespace=root/scx -username:&amp;lt;username&amp;gt; -password:&amp;lt;password&amp;gt; -r:https://&amp;lt;LINUXSERVERFQDN&amp;gt;:1270/wsman -auth:basic -skipCAcheck -skipCNcheck -skipRevocationcheck -encoding:utf-8
&lt;/code&gt;&lt;/pre&gt;

&lt;h3 id=&quot;kerberos-authentication&quot;&gt;Kerberos Authentication&lt;/h3&gt;
&lt;pre&gt;&lt;code class=&quot;language-cmd&quot;&gt;winrm e http://schemas.microsoft.com/wbem/wscim/1/cim-schema/2/SCX_Agent?__cimnamespace=root/scx -r:https://&amp;lt;LINUXSERVERFQDN&amp;gt;:1270 -u:&amp;lt;username@contoso.com&amp;gt; -p:&amp;lt;password&amp;gt; -auth:Kerberos -skipcacheck -skipcncheck -encoding:utf-8
&lt;/code&gt;&lt;/pre&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;notebook-note-1&quot;&gt;:notebook: Note 1&lt;/h3&gt;
  &lt;p&gt;Verify that you have enabled Kerberos via the Management Server Registry on each Management Server in the resource pool you are using to monitor the Unix/Linux agents: &lt;a href=&quot;https://docs.microsoft.com/system-center/scom/manage-linux-kerberos-auth&quot;&gt;https://docs.microsoft.com/system-center/scom/manage-linux-kerberos-auth&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;example-1&quot;&gt;Example 1&lt;/h4&gt;
&lt;h5 id=&quot;issue&quot;&gt;Issue&lt;/h5&gt;
&lt;p&gt;You may experience an error that contains the following when running the above Commands:&lt;/p&gt;

&lt;pre&gt;
WSManFault  
    Message = The server certificate on the destination computer (&amp;lt;LINUXSERVERFQDN&amp;gt;:1270) has the following errors:
Encountered an internal error in the SSL library.
Error number:  -2147012721 0x80072F8F
A security error occurred
&lt;/pre&gt;

&lt;p&gt;or this error via the Discovery Wizard:&lt;/p&gt;

&lt;pre&gt;
Agent verification failed. Error detail: The server certificate on the destination computer (&amp;lt;LINUXSERVERFQDN&amp;gt;:1270) has the following errors:
Encountered an internal error in the SSL library.
It is possible that:
   1. The destination certificate is signed by another certificate authority not trusted by the management server.
   2. The destination has an invalid certificate, e.g., its common name (CN) does not match the fully qualified domain name (FQDN) used for the connection.  The FQDN used for the connection is: &amp;lt;LINUXSERVERFQDN&amp;gt;.
   3. The servers in the resource pool have not been configured to trust certificates signed by other servers in the pool.  
&lt;/pre&gt;

&lt;h5 id=&quot;resolution&quot;&gt;Resolution&lt;/h5&gt;
&lt;ol&gt;
  &lt;li&gt;You could potentially import (&lt;strong&gt;Merge&lt;/strong&gt;) the below known working ciphers by copying the text to a new file on your server called &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;example.reg&lt;/code&gt;, right click and Merge the file into your registry:
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;   Windows Registry Editor Version 5.00

   [HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Cryptography\Configuration\SSL\00010002]
       &quot;Functions&quot;=&quot;TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384,TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384_P521,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256_P521,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA_P521,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P256,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P384,TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA_P521,TLS_DHE_RSA_WITH_AES_256_GCM_SHA384,TLS_DHE_RSA_WITH_AES_128_GCM_SHA256,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384_P521,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256_P521,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384_P521,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256_P521,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P384,TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA_P521,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P256,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P384,TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA_P521,TLS_DHE_RSA_WITH_AES_256_CBC_SHA,TLS_DHE_RSA_WITH_AES_128_CBC_SHA,TLS_RSA_WITH_AES_256_GCM_SHA384,TLS_RSA_WITH_AES_128_GCM_SHA256,TLS_RSA_WITH_AES_256_CBC_SHA256,TLS_RSA_WITH_AES_128_CBC_SHA256&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;An alternative to importing the above registry is to download and run &lt;a href=&quot;https://www.nartac.com/Products/IISCrypto&quot;&gt;IISCrypto&lt;/a&gt; and select &lt;strong&gt;Best Practices&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;notebook-note-1&quot;&gt;:notebook: Note&lt;/h3&gt;
  &lt;p&gt;Be sure to verify if the Linux agent supports the same ciphers as the Management Server / Gateway.
List of Ciphers Supported for Linux / Unix SCOM Agents: &lt;a href=&quot;https://docs.microsoft.com/system-center/scom/manage-security-crossplat-config-sslcipher#cipher-suite-support-matrix&quot;&gt;https://docs.microsoft.com/system-center/scom/manage-security-crossplat-config-sslcipher#cipher-suite-support-matrix&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;enumerate-omi-information-on-unixlinux-machine&quot;&gt;Enumerate OMI Information on UNIX/Linux Machine&lt;/h2&gt;
&lt;p&gt;Enumerate the &lt;strong&gt;SCX_OperatingSystem&lt;/strong&gt; via omicli:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/opt/omi/bin/omicli ei root/scx SCX_OperatingSystem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Enumerate the &lt;strong&gt;SCX_ProcessorStatisticalInformation&lt;/strong&gt; via omicli:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/opt/omi/bin/omicli ei root/scx SCX_ProcessorStatisticalInformation
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Some OMI WMI Namespaces on the Linux Agent:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;SCX_Agent &lt;br /&gt;
SCX_DiskDrive &lt;br /&gt;
SCX_DiskDriveStatisticalInformation &lt;br /&gt;
SCX_EthernetPortStatistics &lt;br /&gt;
SCX_FileSystem &lt;br /&gt;
SCX_FileSystemStatisticalInformation &lt;br /&gt;
SCX_IPProtocolEndpoint &lt;br /&gt;
SCX_LogFile &lt;br /&gt;
SCX_MemoryStatisticalInformation &lt;br /&gt;
SCX_OperatingSystem &lt;br /&gt;
SCX_ProcessorStatisticalInformation &lt;br /&gt;
SCX_StatisticalInformation &lt;br /&gt;
SCX_UnixProcess &lt;br /&gt;
SCX_UnixProcessStatisticalInformation&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;h2 id=&quot;certificate-troubleshooting&quot;&gt;Certificate Troubleshooting&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;unixlinux-certificate&quot;&gt;UNIX/Linux Certificate&lt;/h3&gt;
  &lt;h4 id=&quot;check-certificate&quot;&gt;Check Certificate&lt;/h4&gt;
  &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;openssl x509 &lt;span class=&quot;nt&quot;&gt;-in&lt;/span&gt; /etc/opt/omi/ssl/omi.pem &lt;span class=&quot;nt&quot;&gt;-text&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-noout&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;generate-certificate-with-custom-name&quot;&gt;Generate Certificate with custom name&lt;/h4&gt;
  &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/opt/microsoft/scx/bin/tools/scxsslconfig &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; contoso.com &lt;span class=&quot;nt&quot;&gt;-h&lt;/span&gt; redhat
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;generate-certificate&quot;&gt;Generate Certificate&lt;/h4&gt;
  &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/opt/microsoft/scx/bin/tools/scxsslconfig &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;remove-old-certificate&quot;&gt;Remove Old Certificate&lt;/h4&gt;
  &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;rm&lt;/span&gt; /etc/opt/omi/ssl/omikey.pem &lt;span class=&quot;nt&quot;&gt;--force&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/blockquote&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;configure-the-xplat-certificates-exportimport-for-each-management-server-in-the-resource-pool&quot;&gt;Configure the Xplat certificates (export/import) for each management server in the resource pool&lt;/h3&gt;
  &lt;p&gt;The below steps show how to configure Xplat certificates easily for Management Servers with Powershell. You can automate this process for as many management servers as you need!&lt;/p&gt;
  &lt;h4 id=&quot;windows-management-server-commands&quot;&gt;Windows Management Server Commands&lt;/h4&gt;
  &lt;h5 id=&quot;export-certificate-on-ms1-admin-powershell-prompt&quot;&gt;Export Certificate On MS1 (Admin Powershell Prompt)&lt;/h5&gt;
  &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;amp; &quot;C:\Program Files\Microsoft System Center\Operations Manager\Server\scxcertconfig.exe&quot; -export \\MS2\c$\MS1.cer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h5 id=&quot;export-certificate-on-ms2-admin-powershell-prompt&quot;&gt;Export Certificate On MS2 (Admin Powershell Prompt)&lt;/h5&gt;
  &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;amp; &quot;C:\Program Files\Microsoft System Center\Operations Manager\Server\scxcertconfig.exe&quot; -export \\MS1\c$\MS2.cer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;p&gt;¬†&lt;/p&gt;
  &lt;h5 id=&quot;import-certificate-on-ms1-admin-powershell-prompt&quot;&gt;Import Certificate On MS1 (Admin Powershell Prompt)&lt;/h5&gt;
  &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;amp; &quot;C:\Program Files\Microsoft System Center\Operations Manager\Server\scxcertconfig.exe&quot; -import \\MS1\c$\MS2.cer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h5 id=&quot;import-certificate-on-ms2-admin-powershell-prompt&quot;&gt;Import Certificate On MS2 (Admin Powershell Prompt)&lt;/h5&gt;
  &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&amp;amp; &quot;C:\Program Files\Microsoft System Center\Operations Manager\Server\scxcertconfig.exe&quot; -import \\MS2\c$\MS1.cer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/blockquote&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;location-for-certificates&quot;&gt;Location for Certificates&lt;/h3&gt;
  &lt;h4 id=&quot;scom-2012-linux-agent&quot;&gt;SCOM 2012 Linux Agent:&lt;/h4&gt;
  &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/etc/opt/microsoft/scx/ssl/scx.pem
/etc/opt/microsoft/scx/ssl/scx-host-&amp;lt;HostName&amp;gt;.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;p&gt;¬†&lt;/p&gt;
  &lt;h4 id=&quot;scom-2016-linux-agent-and-newer&quot;&gt;SCOM 2016 Linux Agent and newer:&lt;/h4&gt;
  &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/etc/opt/omi/ssl/omi.pem
/etc/opt/omi/ssl/omi-host-&amp;lt;HostName&amp;gt;.pem
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/blockquote&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;h2 id=&quot;linux-agent-certificate-hostname-detection-steps-during-initial-installation&quot;&gt;Linux Agent Certificate Hostname Detection steps during initial Installation&lt;/h2&gt;
&lt;p&gt;The following steps are what happens (from a high level) during initial installation of the Linux / Unix Agent to generate a Certificate for the Agent.&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Try &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;hostname -f&lt;/code&gt; (this will fail on some Linux systems)&lt;/li&gt;
  &lt;li&gt;Attempt to obtain the domain name from &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/resolve.conf&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Attempt to obtain long hostname with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;nslookup&lt;/code&gt; command&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;h2 id=&quot;purge-scx-agent-installation&quot;&gt;Purge SCX Agent Installation&lt;/h2&gt;
&lt;p&gt;On the Unix/Linux Machine locate the SCOM Linux Agent installation file, and run the following command to uninstall and purge the SCOM Linux Agent installation:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sh ./scx-&amp;lt;version&amp;gt;.&amp;lt;&lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;.&amp;lt;version&amp;gt;.&amp;lt;&lt;span class=&quot;nb&quot;&gt;arch&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;.sh &lt;span class=&quot;nt&quot;&gt;--purge&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--force&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;h2 id=&quot;linux-regular-expression-regex&quot;&gt;Linux Regular Expression (Regex)&lt;/h2&gt;
&lt;p&gt;The SCOM console uses .NET Regex and the SCX Agent uses POSIX Regex.&lt;/p&gt;

&lt;hr /&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;h2 id=&quot;firewalld-service&quot;&gt;Firewalld Service&lt;/h2&gt;
&lt;p&gt;Check that the SCOM Linux Agent (omiengine) Port is listening, which would mean the SCX Linux Agent service is listening:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;netstat &lt;span class=&quot;nt&quot;&gt;-tulpn&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; 1270
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ol&gt;
  &lt;li&gt;
    &lt;p&gt;To open port &lt;em&gt;1270&lt;/em&gt; (&lt;strong&gt;any&lt;/strong&gt; ip address) for System Center Operations Manager (SCOM) on a Red Hat server using Firewalld, you can execute the following commands:&lt;/p&gt;

    &lt;ol&gt;
      &lt;li&gt;
        &lt;p&gt;&lt;strong&gt;Open the Port&lt;/strong&gt;: To open port 1270, you would typically use the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--add-port&lt;/code&gt; option to specify the port and the protocol (either TCP or UDP, depending on your requirement).&lt;/p&gt;

        &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--zone&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;public &lt;span class=&quot;nt&quot;&gt;--add-port&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1270/tcp &lt;span class=&quot;nt&quot;&gt;--permanent&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;        &lt;/div&gt;

        &lt;p&gt;The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--zone=public&lt;/code&gt; flag specifies that you‚Äôre modifying the public zone, but you could replace &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;public&lt;/code&gt; with the name of another zone if that‚Äôs more appropriate for your setup. The &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;--permanent&lt;/code&gt; flag makes sure the rule survives reboots.&lt;/p&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;&lt;strong&gt;Reload Firewalld&lt;/strong&gt;: After adding the port, you‚Äôll need to reload Firewalld to apply the changes:&lt;/p&gt;

        &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--reload&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;        &lt;/div&gt;
      &lt;/li&gt;
      &lt;li&gt;
        &lt;p&gt;&lt;strong&gt;Check the Rules&lt;/strong&gt;: To make sure the port has been opened, you can list the rules for the public zone as follows:&lt;/p&gt;

        &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--zone&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;public &lt;span class=&quot;nt&quot;&gt;--list-ports&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;        &lt;/div&gt;

        &lt;p&gt;This should display the ports that are open, and 1270 should be among them if the previous commands were successful.&lt;/p&gt;
      &lt;/li&gt;
    &lt;/ol&gt;

    &lt;p&gt;These commands are based on the assumption that you are using the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;firewall-cmd&lt;/code&gt; utility, which is the default frontend for Firewalld on Red Hat.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;To open port &lt;em&gt;1270&lt;/em&gt; (&lt;strong&gt;specific&lt;/strong&gt; ip address) for System Center Operations Manager (SCOM) on a Red Hat server using Firewalld, you can execute the following commands:&lt;/p&gt;

    &lt;p&gt;Here‚Äôs how you can open port 1270 for a specific IP address (e.g., &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.1.10&lt;/code&gt;):&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--zone&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;public &lt;span class=&quot;nt&quot;&gt;--add-rich-rule&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;rule family=&quot;ipv4&quot; source address=&quot;192.168.1.10&quot; port port=1270 protocol=tcp accept&apos;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--permanent&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;This adds a ‚Äúrich rule‚Äù to the public zone, specifying that only traffic from the IP address &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.1.10&lt;/code&gt; is allowed to access port 1270 over TCP. Replace &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;192.168.1.10&lt;/code&gt; with the specific IP address that needs access to your SCOM service on port 1270.&lt;/p&gt;

    &lt;p&gt;After adding the rule, don‚Äôt forget to reload the firewall to apply the changes:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--reload&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;To check if the rule has been successfully added, you can list all the rich rules for the public zone like so:&lt;/p&gt;

    &lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt; &lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;firewall-cmd &lt;span class=&quot;nt&quot;&gt;--zone&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;public &lt;span class=&quot;nt&quot;&gt;--list-rich-rules&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;

    &lt;p&gt;This should show your newly added rule among the list.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;strong&gt;Note:&lt;/strong&gt; Be sure to check any security policies or guidelines in your organization before opening ports on a server.&lt;/p&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scom-unix-linux-troubleshooting-tips/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>January 26, 2022</pubDate>
        <link>https://blakedrumm.com/blog/scom-unix-linux-troubleshooting-tips/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scom-unix-linux-troubleshooting-tips/</guid>
      </item>
    
      <item>
        <title>SCOM ACS Collector Troubleshooting Tips</title>
        <postImage>/assets/img/posts/system-center-operations-manager-acs.png</postImage>
        <description>&lt;p&gt;A customer of mine was having problems with Audit Collection Services in SCOM 2019 UR3. I figured this information may prove helpful someday to someone. Enjoy!&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;sql-queries&quot;&gt;SQL Queries&lt;/h2&gt;
&lt;p&gt;Here are some ACS SQL Queries you can utilize: &lt;br /&gt;
&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/tree/master/SQL%20Queries/OperationsManagerAC&quot;&gt;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/tree/master/SQL%20Queries/OperationsManagerAC&lt;/a&gt;&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;verify-acs-collector-performance&quot;&gt;Verify ACS collector performance&lt;/h2&gt;

&lt;ol&gt;
  &lt;li&gt;Open Performance Monitor, right click on Start Menu and select run. &lt;br /&gt;
In run box type the following:
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;perfmon.msc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Once Opened go to Monitoring Tools Folder, then right click on &lt;strong&gt;Performance Monitor&lt;/strong&gt; and go to &lt;strong&gt;Properties&lt;/strong&gt;: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/ACS-perfmonitor-properties.png&quot; alt=&quot;Performance Monitor Properties&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Select the Data tab: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/ACS-PerformanceMonitorProperties-General.png&quot; alt=&quot;Performance Monitor Properties - General&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Clear the currently selected counters by removing each counter listed with the &lt;strong&gt;Remove&lt;/strong&gt; Button, then select &lt;strong&gt;Add&lt;/strong&gt;: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/ACS-PerformanceMonitorProperties-DataSets.png&quot; alt=&quot;Performance Monitor Properties - Data Sets&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Locate the &lt;strong&gt;ACS Collector&lt;/strong&gt; in available counters, select it, and click on the &lt;strong&gt;Add&lt;/strong&gt; button: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/ACS-CollectorPerformanceCounter.png&quot; alt=&quot;ACS Collector Performance Counter&quot; class=&quot;img-fluid&quot; /&gt; &lt;br /&gt;
This is how it should look when it is added: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/ACS-CollectorPerformanceCounter-Added.png&quot; alt=&quot;ACS Collector Performance Counter - Added&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Click &lt;strong&gt;OK&lt;/strong&gt; to confirm the property settings.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Click on the following button to change the view type, change to &lt;strong&gt;Report&lt;/strong&gt;: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/ACS-ChangeToReportView.png&quot; alt=&quot;Change to Report View&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;View your performance data for ACS: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/ACS-PerformanceData.png&quot; alt=&quot;ACS Performance Data&quot; class=&quot;img-fluid&quot; /&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;gather-partition-table-history&quot;&gt;Gather Partition Table History&lt;/h2&gt;
&lt;p&gt;You can run the following tsql query against the OperationsManagerAC&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;-- Status:&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;-- 0: active, set by collector&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;-- 1: inactive, mark for closing during collector startup &amp;amp; indexing, set manually&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;-- 2: archived, ready for deletion, set from outside the collector&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;-- 100 - 108: closed, indexing in progress&lt;/span&gt;
&lt;span class=&quot;c1&quot;&gt;-- 109: indexing complete&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dtpartition&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;order&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;by&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;partitionstarttime&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;enable-acs-collector-logging&quot;&gt;Enable ACS Collector Logging&lt;/h2&gt;
&lt;h3 id=&quot;traceflags&quot;&gt;TraceFlags&lt;/h3&gt;
&lt;p&gt;TraceFlags consists of three groups that are OR‚Äôd (added) together. They are Verbosity Level, Component, and Log Output Method. Verbosity Level refers to the number and type of events that are logged to the trace log when trace logging is enabled, while Component can only be used if the Verbosity Level is set to Level Debug and is used to enable/disable logging for various internal components. Log Output Method is used to specify the location that tracing information is written to.&lt;/p&gt;

&lt;h4 id=&quot;verbosity-level-settings&quot;&gt;Verbosity Level settings&lt;/h4&gt;
&lt;div class=&quot;responsive-table&quot;&gt;
&lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th scope=&quot;col&quot;&gt;Value&lt;/th&gt;
          &lt;th scope=&quot;col&quot;&gt;Description&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td&gt;0x00000000&lt;/td&gt;
          &lt;td&gt;No logging.&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;0x00000001&lt;/td&gt;
          &lt;td&gt;Level Error. Logs only errors.&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;0x00000002&lt;/td&gt;
          &lt;td&gt;Level Warning. Logs errors and warnings.&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;0x00000003&lt;/td&gt;
          &lt;td&gt;Level Informational. Logs errors, warnings, and information.&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;0x00000004&lt;/td&gt;
          &lt;td&gt;Level Debug. Logs everything and is very verbose.&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
    &lt;/div&gt;

&lt;hr /&gt;

&lt;h4 id=&quot;component-settings&quot;&gt;Component settings&lt;/h4&gt;
&lt;div class=&quot;responsive-table&quot;&gt;
&lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th scope=&quot;col&quot;&gt;Value&lt;/th&gt;
          &lt;th scope=&quot;col&quot;&gt;Description&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td&gt;0x00000010&lt;/td&gt;
          &lt;td&gt;General&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;0x00000020&lt;/td&gt;
          &lt;td&gt;Networking&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;0x00000080&lt;/td&gt;
          &lt;td&gt;Event tracking&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
    &lt;/div&gt;

&lt;hr /&gt;

&lt;h4 id=&quot;log-output-method-settings&quot;&gt;Log Output Method settings&lt;/h4&gt;
&lt;div class=&quot;responsive-table&quot;&gt;
&lt;table&gt;
      &lt;thead&gt;
        &lt;tr&gt;
          &lt;th scope=&quot;col&quot;&gt;Value&lt;/th&gt;
          &lt;th scope=&quot;col&quot;&gt;Description&lt;/th&gt;
        &lt;/tr&gt;
      &lt;/thead&gt;
      &lt;tbody&gt;
        &lt;tr&gt;
          &lt;td&gt;0x00020000&lt;/td&gt;
          &lt;td&gt;Log to debug out&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;0x00040000&lt;/td&gt;
          &lt;td&gt;Log to the console, if available (only when running the collector from the command line)&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
          &lt;td&gt;0x00080000&lt;/td&gt;
          &lt;td&gt;Log to file in `%SystemRoot%\Temp` directory&lt;/td&gt;
        &lt;/tr&gt;
      &lt;/tbody&gt;
    &lt;/table&gt;
    &lt;/div&gt;

&lt;hr /&gt;

&lt;blockquote&gt;
  &lt;p&gt;%SystemRoot% = C:\Windows\&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Trace log files are located in the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%SystemRoot%\Temp&lt;/code&gt; directory. For the Collector, the log files are written to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%SystemRoot%\Temp\AdtServer.log&lt;/code&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%SystemRoot%\Temp\AdtSrvDll.log&lt;/code&gt;. When a log file fills to capacity, the system overwrites the oldest entries with the most recent entries. Log files have a default size of 1 MB and begin to overwrite the oldest entries once they are full.&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;To enable logging, open RegEdit navigate to the following location: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HKEY_LOCAL_MACHINE\Software\Policies\Microsoft\AdtAgent\Parameters&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Create the TraceFlags &lt;strong&gt;DWORD (32-bit) Value&lt;/strong&gt; and set it to &lt;strong&gt;Hexadecimal&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;80003&lt;/code&gt; unless otherwise advised. Trace logging begins immediately; no restart of the Collector is needed. Additionally, Change permission must be granted to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;%SystemRoot%\Temp&lt;/code&gt; for the &lt;strong&gt;NetworkService&lt;/strong&gt; account.&lt;/p&gt;

    &lt;blockquote&gt;
      &lt;h3 id=&quot;note&quot;&gt;Note&lt;/h3&gt;
      &lt;p&gt;For example, to log errors, warnings, and information messages to a file change the traceflags registry value to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x00080003&lt;/code&gt;. This is a combination of &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x00080000&lt;/code&gt; &lt;em&gt;[file]&lt;/em&gt; and &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0x00000003&lt;/code&gt; &lt;em&gt;[errors +warnings+informational]&lt;/em&gt;.&lt;/p&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
  &lt;li&gt;To disable logging, delete the &lt;strong&gt;TraceFlags&lt;/strong&gt; value or set it to &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;0&lt;/code&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;change-the-scheduled-time-the-sql-scripts-run-that-are-in-the-acs-installation-folder&quot;&gt;Change the scheduled time the SQL Scripts run that are in the ACS Installation Folder&lt;/h2&gt;
&lt;p&gt;In order for you to change the time the jobs will run the partitioning, grooming and reindexing. You need to edit the dtConfig table and change the &lt;strong&gt;‚Äútable switch offset in seconds since midnight UTC‚Äù&lt;/strong&gt; value to another time in UTC (&lt;a href=&quot;https://www.google.com/search?q=UTC+Converter&quot;&gt;Google UTC Converter&lt;/a&gt;):&lt;/p&gt;

&lt;p&gt;Get current configuration:&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;dtConfig&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Get current SQL UTC time:&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GETUTCDATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;&apos;Current UTC Time&apos;&lt;/span&gt; 
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Get 10 minutes ahead of current UTC time:&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;SELECT&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DATEADD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;MINUTE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GETUTCDATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Get seconds from midnight for dtConfig &lt;strong&gt;‚Äútable switch offset in seconds since midnight UTC‚Äù&lt;/strong&gt; ahead in seconds, in this example we add 10 minutes to the current UTC time:&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;Declare&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;DateTime&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;Select&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DATEADD&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;MINUTE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;GETUTCDATE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;())&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;Select&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DatePart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HOUR&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3600&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;DatePart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;MINUTE&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;60&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;DatePart&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;SECOND&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;d&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Update configuration to midnight UTC, which is 7:00 PM (EST):&lt;/p&gt;
&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;UPDATE&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dbo&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;].[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;dtConfig&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;SET&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Value&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;-- Default: 25200 (2:00 AM (EST))&lt;/span&gt;
   &lt;span class=&quot;k&quot;&gt;WHERE&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;4&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;GO&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Be mindful that the scripts are usually run overnight when there is not alot of activity in the ACS Database. So take precautions if changing this when alot of logons/logoffs are happening in your environment.&lt;/p&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;set-filter-for-acs-data&quot;&gt;Set filter for ACS Data&lt;/h2&gt;
&lt;ol&gt;
  &lt;li&gt;On the ACS server, Go to the registry: &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\services\AdtServer\Parameters&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Right click the key Parameters, select Permissions&lt;/li&gt;
  &lt;li&gt;Select the row ‚ÄúNetwork service‚Äù&lt;/li&gt;
  &lt;li&gt;Click edit&lt;/li&gt;
  &lt;li&gt;Set ‚ÄúApply to‚Äù as ‚ÄúThis key and subkeys‚Äù&lt;/li&gt;
  &lt;li&gt;Select Full control in the column Allow, click OK&lt;/li&gt;
  &lt;li&gt;Run &lt;strong&gt;CMD&lt;/strong&gt; as an &lt;strong&gt;Administrator&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Run the below command:
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;cd C:\Windows\System32\Security\AdtServer
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Run the below command to check current query we being used by SCOM ACS. (&lt;em&gt;There should be a no filter clause to exclude the collected event&lt;/em&gt;):
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;adtadmin ‚Äìgetquery
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;Run the following command to add filter for the collected events:
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;adtadmin /setquery /query:&quot;SELECT * FROM AdtsEvent WHERE NOT (EventID=528 or EventID=540 or EventID=680)‚Äù
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;blockquote&gt;
      &lt;h3 id=&quot;note-1&quot;&gt;Note&lt;/h3&gt;
      &lt;p&gt;Change the event IDs to the events you don‚Äôt want collected. See the below example for a basic filter. Since every environment has its own concerns, please double check which events can be ignored to reduce data collection amount.&lt;/p&gt;
      &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;adtadmin /setquery /query:&quot;SELECT * FROM AdtsEvent WHERE NOT (((EventId=528 AND String01=&apos;5&apos;) OR (EventId=576 AND (String01=&apos;SeChangeNotifyPrivilege&apos; OR HeaderDomain=&apos;NT Authority&apos;)) OR (EventId=538 OR EventId=566 OR EventId=672 OR EventId=680)))&quot;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;      &lt;/div&gt;
    &lt;/blockquote&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;install-acs-from-command-line&quot;&gt;Install ACS from Command Line&lt;/h2&gt;
&lt;p&gt;In order to install the ACS Collector from the command line you are required to provide an XML, this an example of the XML that is required:&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;InstallationOptions&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;nt&quot;&gt;&amp;lt;AcsCollector&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Interval (in seconds) between heartbeats. --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;HeartBeatInterval&amp;gt;&lt;/span&gt;60&lt;span class=&quot;nt&quot;&gt;&amp;lt;/HeartBeatInterval&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Number of failed heart beats before collector
             disconnects the forwarder. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;HeartBeatFailedCount&amp;gt;&lt;/span&gt;3&lt;span class=&quot;nt&quot;&gt;&amp;lt;/HeartBeatFailedCount&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Time (in seconds) to wait before disconnecting forwarders
             which have not yet sent the initial data packet on a
             new connection. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;ConnectNoDataThreshold&amp;gt;&lt;/span&gt;10&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ConnectNoDataThreshold&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- The TCP port on which the collector should listen
             for forwarder connections. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;AdtAgentPort&amp;gt;&lt;/span&gt;51909&lt;span class=&quot;nt&quot;&gt;&amp;lt;/AdtAgentPort&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Maximum length of database queue. This value will be
             rounded up to a power of two if necessary. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;MaximumQueueLength&amp;gt;&lt;/span&gt;0x40000&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MaximumQueueLength&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Lower bound (in seconds) of randomly chosen backoff
             time sent to agent if the collector is overloaded. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;BackOffMinTime&amp;gt;&lt;/span&gt;120&lt;span class=&quot;nt&quot;&gt;&amp;lt;/BackOffMinTime&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Upper bound (in seconds) of randomly chosen backoff
             time sent to agent if the collector is overloaded. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;BackOffMaxTime&amp;gt;&lt;/span&gt;480&lt;span class=&quot;nt&quot;&gt;&amp;lt;/BackOffMaxTime&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- (percentage of max queue length) --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;BackOffThreshold&amp;gt;&lt;/span&gt;50&lt;span class=&quot;nt&quot;&gt;&amp;lt;/BackOffThreshold&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- (percentage of max queue length) --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DisconnectThreshold&amp;gt;&lt;/span&gt;75&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DisconnectThreshold&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Asset value new agents get assigned.
             -1 means they get the value of their group instead. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;DefaultAssetValue&amp;gt;&lt;/span&gt;-1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DefaultAssetValue&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Group ID of the group new agents get assigned to. --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DefaultGroup&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DefaultGroup&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Number of simultaneous database connections to use
             for event insertion. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbEventConnections&amp;gt;&lt;/span&gt;8&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DbEventConnections&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Number of simultaneous database connections to use
             for string insertion. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbStringConnections&amp;gt;&lt;/span&gt;8&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DbStringConnections&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Minimum asset value required in order to report 
             application log events regarding an agent. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;ReportThreshold&amp;gt;&lt;/span&gt;1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ReportThreshold&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Minimum asset value required in order to store events
             from an agent. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;StoreThreshold&amp;gt;&lt;/span&gt;1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/StoreThreshold&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- (seconds) --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;CheckPointInterval&amp;gt;&lt;/span&gt;198&lt;span class=&quot;nt&quot;&gt;&amp;lt;/CheckPointInterval&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- (seconds) --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;PurgingInterval&amp;gt;&lt;/span&gt;198&lt;span class=&quot;nt&quot;&gt;&amp;lt;/PurgingInterval&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- If running in grooming mode, the collector only kicks
             off a grooming cycle if the database queue has at most
             MaxPurgingQueue entries. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;MaxPurgingQueue&amp;gt;&lt;/span&gt;500&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MaxPurgingQueue&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- 0 = Event timestamps will be reported in UTC.
         1 = Event timestamps will be reported in local time. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;ConvertToLocalTime&amp;gt;&lt;/span&gt;1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/ConvertToLocalTime&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Size (in bytes) of memory to use for caching principal data. --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;PrincipalCacheSize&amp;gt;&lt;/span&gt;0x8000&lt;span class=&quot;nt&quot;&gt;&amp;lt;/PrincipalCacheSize&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Size (in bytes) of memory to use for caching string data. --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;StringCacheSize&amp;gt;&lt;/span&gt;0x20000&lt;span class=&quot;nt&quot;&gt;&amp;lt;/StringCacheSize&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Time, in seconds, to backoff unwanted agents --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;BackOffUnwanted&amp;gt;&lt;/span&gt;21600&lt;span class=&quot;nt&quot;&gt;&amp;lt;/BackOffUnwanted&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Maximum time (in minutes) a connection can exist before it
             gets disconnected for rekeying purposes. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;TlsRekeyInterval&amp;gt;&lt;/span&gt;600&lt;span class=&quot;nt&quot;&gt;&amp;lt;/TlsRekeyInterval&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;AcceptSockets&amp;gt;&lt;/span&gt;4&lt;span class=&quot;nt&quot;&gt;&amp;lt;/AcceptSockets&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Time, in seconds, before a new connection gets
             disconnected if the client doesn&apos;t send any data --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;MaxAcceptIdle&amp;gt;&lt;/span&gt;15&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MaxAcceptIdle&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Time, in seconds, before a connection attempt times out --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;MaxConnectIdle&amp;gt;&lt;/span&gt;15&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MaxConnectIdle&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Interval (in seconds) between recalculation of queue
             statistics. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;MinUpdateInterval&amp;gt;&lt;/span&gt;21&lt;span class=&quot;nt&quot;&gt;&amp;lt;/MinUpdateInterval&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Name of ODBC data source --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DataSource&amp;gt;&lt;/span&gt;acs&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DataSource&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- 0 = SQL Server runs on a different machine
         1 = SQL Server runs on collector machine --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbServerLocal&amp;gt;&lt;/span&gt;1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DbServerLocal&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Name of machine running SQL Server --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbServerName&amp;gt;&lt;/span&gt;acs-sql&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DbServerName&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Name of SQL Server instance to use. Usually blank. --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbServerInstance&amp;gt;&amp;lt;/DbServerInstance&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Name of collector database --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbName&amp;gt;&lt;/span&gt;OperationsManagerAC&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DbName&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- 0 = Specified data and log directories will be used.
         1 = SQL Server&apos;s data and log directories will be used. --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;UseDefaultPaths&amp;gt;&lt;/span&gt;1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/UseDefaultPaths&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Path (on DB server) where data file should be created
             Necessary only if UseDefaultPaths is set to 0 --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;DataFilePath&amp;gt;&lt;/span&gt;d:\acsdata&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DataFilePath&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Initial data file size in MB --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbDataFileInitialSize&amp;gt;&lt;/span&gt;1024&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DbDataFileInitialSize&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Maximum data file size in MB, 0 means unlimited --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbDataFileMaximumSize&amp;gt;&lt;/span&gt;65536&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DbDataFileMaximumSize&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- File growth amount in MB --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbDataFileIncrementSize&amp;gt;&lt;/span&gt;1024&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DbDataFileIncrementSize&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Path (on DB server) where log file should be created.
             Necessary only if UseDefaultPaths is set to 0 --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;LogFilePath&amp;gt;&lt;/span&gt;e:\acslog&lt;span class=&quot;nt&quot;&gt;&amp;lt;/LogFilePath&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Initial log file size in MB --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbLogFileInitialSize&amp;gt;&lt;/span&gt;128&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DbLogFileInitialSize&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Maximum log file size in MB, 0 means unlimited --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbLogFileMaximumSize&amp;gt;&lt;/span&gt;4096&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DbLogFileMaximumSize&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- File growth amount in MB --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbLogFileIncrementSize&amp;gt;&lt;/span&gt;128&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DbLogFileIncrementSize&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- (hours) time to keep events --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;EventRetentionPeriod&amp;gt;&lt;/span&gt;24&lt;span class=&quot;nt&quot;&gt;&amp;lt;/EventRetentionPeriod&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Number of partitions to use --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;PartitionCount&amp;gt;&lt;/span&gt;1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/PartitionCount&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Time when partition switching should occur.
             Expressed in seconds since midnight in UTC --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;PartitionSwitchOffset&amp;gt;&lt;/span&gt;0&lt;span class=&quot;nt&quot;&gt;&amp;lt;/PartitionSwitchOffset&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- Type of authentication collector should use
             when connecting to the database:
             0 = Use SQL authentication (not recommended)
             1 = Use Windows authentication (recommended) --&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;UseWindowsAuth&amp;gt;&lt;/span&gt;1&lt;span class=&quot;nt&quot;&gt;&amp;lt;/UseWindowsAuth&amp;gt;&lt;/span&gt;

   &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- only necessary when using SQL authentication --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbUser&amp;gt;&lt;/span&gt;SampleAdtServerDbUser&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DbUser&amp;gt;&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;&amp;lt;!-- only necessary when using SQL authentication --&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;DbPassword&amp;gt;&lt;/span&gt;SampleAdtServerDbPwd&lt;span class=&quot;nt&quot;&gt;&amp;lt;/DbPassword&amp;gt;&lt;/span&gt;

  &lt;span class=&quot;nt&quot;&gt;&amp;lt;/AcsCollector&amp;gt;&lt;/span&gt;

&lt;span class=&quot;nt&quot;&gt;&amp;lt;/InstallationOptions&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/acs-collector-troubleshooting-tips/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>January 24, 2022</pubDate>
        <link>https://blakedrumm.com/blog/acs-collector-troubleshooting-tips/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/acs-collector-troubleshooting-tips/</guid>
      </item>
    
      <item>
        <title>Maintenance Schedule Failing Intermittently</title>
        <postImage>/assets/img/posts/maintenance-mode-schedule.png</postImage>
        <description>&lt;p&gt;The customer had setup Maintenance Scheduled Jobs that were to run Daily against a group of servers. This Maintenance Schedule would work as intended for a while (up to a week), but would stop working intermittently. The ‚ÄúNext Run‚Äù date/time for the Maintenance Mode Scheduled Job would be empty and to fix this we would need to change, ‚ÄúThe schedule is effective beginning‚Äù date, to today. Or recreate the maintenance schedule job.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/maintenance-mode-schedule-properties.png&quot; alt=&quot;Maintenance Mode Scheduled Job Properties&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;In order to resolve this issue we had to run the SCOM Console as the SDK (System Center Data Access Service) Account and recreate the Maintenance Scheduled Jobs. This allowed the Maintenance Mode Scheduled jobs to run without any issues.&lt;/strong&gt;&lt;/p&gt;

&lt;h2 id=&quot;conclusion&quot;&gt;Conclusion&lt;/h2&gt;
&lt;p&gt;So the issue was due to the users‚Äô personal Active Directory account being locked out when setting up the Maintenance Schedule. To resolve we just need to run as the Data Access Service (SDK) Account.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/maintenance-mode-scheduled-jobs-failing-intermittently/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>January 11, 2022</pubDate>
        <link>https://blakedrumm.com/blog/maintenance-mode-scheduled-jobs-failing-intermittently/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/maintenance-mode-scheduled-jobs-failing-intermittently/</guid>
      </item>
    
      <item>
        <title>Resolve Post Install error with Unix / Linux Install for SCOM Agent</title>
        <postImage>/assets/img/posts/scx-agent-list.png</postImage>
        <description>&lt;h2 id=&quot;introduction&quot;&gt;Introduction&lt;/h2&gt;
&lt;p&gt;My customer was running Solaris 10 (SunOS 5.10), they were having issues when attempting to install the SCOM Agent (scx-1.6.8-1.solaris.10.sparc.sh). So we dug further into things to verify why the installer was failing on the &lt;strong&gt;PostInstall&lt;/strong&gt; step.&lt;/p&gt;

&lt;p&gt;Discovery error is shown when attempting to discover from the SCOM Console via the Discovery Wizard:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Task invocation failed with error code -2130771918. Error message was: The SCXCertWriteAction module encountered a DoProcess exception. The workflow &quot;Microsoft.Unix.Agent.GetCert.Task&quot; has been unloaded.
 
Module: SCXCertWriteAction
Location: DoProcess
Exception type: ScxCertLibException
 
Exception message: Unable to create certificate context
; {ASN1 bad tag value met.
}
 
Additional data: Sudo path: /etc/opt/microsoft/scx/conf/sudodir/
Management group: SCOM2019
Workflow name: Microsoft.Unix.Agent.GetCert.Task
Object name: UNIX/Linux Resource Pool
Object ID: {6F1686BA-C068-4C9F-F1ED-29CDD800528A}
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;what-we-did&quot;&gt;What we did&lt;/h2&gt;
&lt;p&gt;I asked the customer to copy the SCOM Linux / Unix Agent install files (&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;C:\Program Files\Microsoft System Center\Operations Manager\Server\AgentManagement\UnixAgents\DownloadedKits&lt;/code&gt;) to the Solaris Machine so we can attempt a manual installation.&lt;/p&gt;

&lt;p&gt;Extract the Solaris Installer file:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;sh scx-1.6.8-1.solaris.10.sparc.sh &lt;span class=&quot;nt&quot;&gt;--extract&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We looked at the output after running the install manually:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;solaris10:root@/home/ops_monitoring/scxbundle.24766] pkgadd &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; scx-1.6.8-1.solaris.10.sparc.pkg
 
The following packages are available:
  1  MSFTscx     Microsoft System Center 2012 Operations Manager &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;UNIX/Linux agent
                 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;sparc&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 1.6.8-1
 
Select package&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; you wish to process &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;or &lt;span class=&quot;s1&quot;&gt;&apos;all&apos;&lt;/span&gt; to process
all packages&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default: all&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;?,??,q]:
 
Processing package instance &amp;lt;MSFTscx&amp;gt; from &amp;lt;/home/ops_monitoring/scxbundle.24766/scx-1.6.8-1.solaris.10.sparc.pkg&amp;gt;
 
Microsoft System Center 2012 Operations Manager &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;UNIX/Linux agent&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;sparc&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 1.6.8-1
http://www.microsoft.com
&lt;span class=&quot;c&quot;&gt;## Processing package information.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## Processing system information.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## Verifying package dependencies.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## Verifying disk space requirements.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## Checking for conflicts with packages already installed.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## Checking for setuid/setgid programs.&lt;/span&gt;
 
This package contains scripts which will be executed with super-user
permission during the process of installing this package.
 
Do you want to &lt;span class=&quot;k&quot;&gt;continue &lt;/span&gt;with the installation of &amp;lt;MSFTscx&amp;gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;y,n,?] y
 
Installing Microsoft System Center 2012 Operations Manager &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;UNIX/Linux agent as &amp;lt;MSFTscx&amp;gt;
 
&lt;span class=&quot;c&quot;&gt;## Executing preinstall script.&lt;/span&gt;
Waiting &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;service stop: svc:/application/management/omid ...
&lt;span class=&quot;c&quot;&gt;## Installing part 1 of 1.&lt;/span&gt;
/etc/opt/microsoft/scx/pf_file.sh
/etc/opt/omi/conf/omiregister/root-scx/SCXProvider-omi.reg
/etc/opt/omi/conf/omiregister/root-scx/SCXProvider-req.reg
/etc/opt/omi/conf/omiregister/root-scx/SCXProvider-root.reg
/opt/microsoft/scx/bin/omi_preexec
/opt/microsoft/scx/bin/scxlogfilereader
/opt/microsoft/scx/bin/setup.sh
/opt/microsoft/scx/bin/tools/.scxadmin
/opt/microsoft/scx/bin/tools/.scxsslconfig
/opt/microsoft/scx/bin/tools/scxadmin
/opt/microsoft/scx/bin/tools/scxsslconfig
/opt/microsoft/scx/bin/tools/setup.sh
/opt/microsoft/scx/bin/uninstall
/opt/microsoft/scx/lib/libSCXCoreProviderModule.so
/opt/omi/lib/libSCXCoreProviderModule.so &amp;lt;symbolic &lt;span class=&quot;nb&quot;&gt;link&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; verifying class &amp;lt;none&amp;gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
/etc/opt/microsoft/scx/conf/installinfo.txt
/etc/opt/microsoft/scx/conf/scxconfig.conf
/etc/opt/microsoft/scx/conf/scxlog.conf
/etc/opt/microsoft/scx/conf/scxrunas.conf
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; verifying class &amp;lt;config&amp;gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;## Executing postinstall script.&lt;/span&gt;
/var/sadm/pkg/MSFTscx/install/postinstall: &lt;span class=&quot;nv&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/sislocal/profile: is not an identifier
pkgadd: ERROR: postinstall script did not &lt;span class=&quot;nb&quot;&gt;complete &lt;/span&gt;successfully
 
Installation of &amp;lt;MSFTscx&amp;gt; failed.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The piece of the message above that stood out to me was this line:&lt;/p&gt;
&lt;div class=&quot;language-shell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;/var/sadm/pkg/MSFTscx/install/postinstall: &lt;span class=&quot;nv&quot;&gt;ENV&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/usr/sislocal/profile: is not an identifier
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I asked the customer to take a look at their Environmental Variables in &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;/etc/profile&lt;/code&gt; and verify if there are any custom lines in there. We noticed there were custom lines, &lt;strong&gt;we removed these lines and attempted the installation again, it succeeded!&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/error-postinstall-linux-unix-agent/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>January 10, 2022</pubDate>
        <link>https://blakedrumm.com/blog/error-postinstall-linux-unix-agent/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/error-postinstall-linux-unix-agent/</guid>
      </item>
    
      <item>
        <title>Set and Check User Rights Assignment via PowerShell</title>
        <postImage>/assets/img/posts/set-user-rights.png</postImage>
        <description>&lt;p&gt;&lt;sub&gt;This post was last updated on November 5th, 2024&lt;/sub&gt;&lt;/p&gt;

&lt;p&gt;I stumbled across this gem (&lt;a href=&quot;https://github.com/weloytty/QuirkyPSFunctions/blob/master/Source/Users/Grant-LogOnAsService.ps1&quot;&gt;weloytty/Grant-LogonAsService.ps1&lt;/a&gt;) that allows you to grant Logon as a Service Right for a User. I modified the script you can now run the Powershell script against multiple machines, users, and user rights.&lt;/p&gt;

&lt;h2 id=&quot;set-user-rights&quot;&gt;Set User Rights&lt;/h2&gt;
&lt;h3 id=&quot;arrow_down-how-to-get-it&quot;&gt;:arrow_down: How to get it&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/General%20Functions/Set-UserRights.ps1&quot;&gt;Set-UserRights.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Direct Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Set-UserRights.ps1&quot;&gt;Personal File Server - Set-UserRights.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Alternative Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Set-UserRights.txt&quot;&gt;Personal File Server - Set-UserRights.txt&lt;/a&gt; :arrow_left: &lt;strong&gt;Text Format Alternative Download Link&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;All of the User Rights that can be set:&lt;/p&gt;

&lt;table class=&quot;table table-hover table-text d-block overflow-auto&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Privilege&lt;/th&gt;
      &lt;th&gt;PrivilegeName&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;SeAssignPrimaryTokenPrivilege&lt;/td&gt;
      &lt;td&gt;Replace a process level token&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeAuditPrivilege&lt;/td&gt;
      &lt;td&gt;Generate security audits&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeBackupPrivilege&lt;/td&gt;
      &lt;td&gt;Back up files and directories&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeBatchLogonRight&lt;/td&gt;
      &lt;td&gt;Log on as a batch job&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeChangeNotifyPrivilege&lt;/td&gt;
      &lt;td&gt;Bypass traverse checking&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeCreateGlobalPrivilege&lt;/td&gt;
      &lt;td&gt;Create global objects&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeCreatePagefilePrivilege&lt;/td&gt;
      &lt;td&gt;Create a pagefile&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeCreatePermanentPrivilege&lt;/td&gt;
      &lt;td&gt;Create permanent shared objects&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeCreateSymbolicLinkPrivilege&lt;/td&gt;
      &lt;td&gt;Create symbolic links&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeCreateTokenPrivilege&lt;/td&gt;
      &lt;td&gt;Create a token object&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeDebugPrivilege&lt;/td&gt;
      &lt;td&gt;Debug programs&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeDelegateSessionUserImpersonatePrivilege&lt;/td&gt;
      &lt;td&gt;Obtain an impersonation token for another user in the same session&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeDenyBatchLogonRight&lt;/td&gt;
      &lt;td&gt;Deny log on as a batch job&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeDenyInteractiveLogonRight&lt;/td&gt;
      &lt;td&gt;Deny log on locally&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeDenyNetworkLogonRight&lt;/td&gt;
      &lt;td&gt;Deny access to this computer from the network&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeDenyRemoteInteractiveLogonRight&lt;/td&gt;
      &lt;td&gt;Deny log on through Remote Desktop Services&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeDenyServiceLogonRight&lt;/td&gt;
      &lt;td&gt;Deny log on as a service&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeEnableDelegationPrivilege&lt;/td&gt;
      &lt;td&gt;Enable computer and user accounts to be trusted for delegation&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeImpersonatePrivilege&lt;/td&gt;
      &lt;td&gt;Impersonate a client after authentication&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeIncreaseBasePriorityPrivilege&lt;/td&gt;
      &lt;td&gt;Increase scheduling priority&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeIncreaseQuotaPrivilege&lt;/td&gt;
      &lt;td&gt;Adjust memory quotas for a process&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeIncreaseWorkingSetPrivilege&lt;/td&gt;
      &lt;td&gt;Increase a process working set&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeInteractiveLogonRight&lt;/td&gt;
      &lt;td&gt;Allow log on locally&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeLoadDriverPrivilege&lt;/td&gt;
      &lt;td&gt;Load and unload device drivers&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeLockMemoryPrivilege&lt;/td&gt;
      &lt;td&gt;Lock pages in memory&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeMachineAccountPrivilege&lt;/td&gt;
      &lt;td&gt;Add workstations to domain&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeManageVolumePrivilege&lt;/td&gt;
      &lt;td&gt;Perform volume maintenance tasks&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeNetworkLogonRight&lt;/td&gt;
      &lt;td&gt;Access this computer from the network&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeProfileSingleProcessPrivilege&lt;/td&gt;
      &lt;td&gt;Profile single process&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeRelabelPrivilege&lt;/td&gt;
      &lt;td&gt;Modify an object label&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeRemoteInteractiveLogonRight&lt;/td&gt;
      &lt;td&gt;Allow log on through Remote Desktop Services&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeRemoteShutdownPrivilege&lt;/td&gt;
      &lt;td&gt;Force shutdown from a remote system&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeRestorePrivilege&lt;/td&gt;
      &lt;td&gt;Restore files and directories&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeSecurityPrivilege&lt;/td&gt;
      &lt;td&gt;Manage auditing and security log&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeServiceLogonRight&lt;/td&gt;
      &lt;td&gt;Log on as a service&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeShutdownPrivilege&lt;/td&gt;
      &lt;td&gt;Shut down the system&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeSyncAgentPrivilege&lt;/td&gt;
      &lt;td&gt;Synchronize directory service data&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeSystemEnvironmentPrivilege&lt;/td&gt;
      &lt;td&gt;Modify firmware environment values&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeSystemProfilePrivilege&lt;/td&gt;
      &lt;td&gt;Profile system performance&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeSystemtimePrivilege&lt;/td&gt;
      &lt;td&gt;Change the system time&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeTakeOwnershipPrivilege&lt;/td&gt;
      &lt;td&gt;Take ownership of files or other objects&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeTcbPrivilege&lt;/td&gt;
      &lt;td&gt;Act as part of the operating system&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeTimeZonePrivilege&lt;/td&gt;
      &lt;td&gt;Change the time zone&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeTrustedCredManAccessPrivilege&lt;/td&gt;
      &lt;td&gt;Access Credential Manager as a trusted caller&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;SeUndockPrivilege&lt;/td&gt;
      &lt;td&gt;Remove computer from docking station&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h2 id=&quot;notebook-note&quot;&gt;:notebook: Note&lt;/h2&gt;
  &lt;p&gt;You may edit line &lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/General%20Functions/Set-UserRights.ps1#L564&quot;&gt;564&lt;/a&gt; in the script to change what happens when the script is run without any arguments or parameters, this also allows you to change what happens when the script is run from the PowerShell ISE.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Here are a few examples:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;h2 id=&quot;add-users&quot;&gt;Add Users&lt;/h2&gt;
  &lt;h3 id=&quot;single-users&quot;&gt;Single Users&lt;/h3&gt;
  &lt;h4 id=&quot;example-1&quot;&gt;Example 1&lt;/h4&gt;
  &lt;p&gt;Add User Right ‚ÄúAllow log on locally‚Äù for current user:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Set-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AddRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SeInteractiveLogonRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-2&quot;&gt;Example 2&lt;/h4&gt;
  &lt;p&gt;Add User Right ‚ÄúLog on as a service‚Äù for CONTOSO\User:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Set-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AddRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Username&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CONTOSO\User&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SeServiceLogonRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-3&quot;&gt;Example 3&lt;/h4&gt;
  &lt;p&gt;Add User Right ‚ÄúLog on as a batch job‚Äù for CONTOSO\User:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Set-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AddRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Username&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CONTOSO\User&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SeBatchLogonRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-4&quot;&gt;Example 4&lt;/h4&gt;
  &lt;p&gt;Add User Right ‚ÄúLog on as a batch job‚Äù for user SID S-1-5-11:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Set-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AddRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Username&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;S-1-5-11&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SeBatchLogonRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h3 id=&quot;add-multiple-users--rights--computers&quot;&gt;Add Multiple Users / Rights / Computers&lt;/h3&gt;
  &lt;h4 id=&quot;example-5&quot;&gt;Example 5&lt;/h4&gt;
  &lt;p&gt;Add User Right ‚ÄúLog on as a service‚Äù and ‚ÄúLog on as a batch job‚Äù for CONTOSO\User1 and CONTOSO\User2 and run on, local machine and SQL.contoso.com:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Set-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AddRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SeServiceLogonRight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SeBatchLogonRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ComputerName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;COMPUTERNAME&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SQL.contoso.com&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CONTOSO\User1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CONTOSO\User2&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/blockquote&gt;

&lt;p&gt;¬†&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h2 id=&quot;remove-users&quot;&gt;Remove Users&lt;/h2&gt;
  &lt;h3 id=&quot;single-users-1&quot;&gt;Single Users&lt;/h3&gt;
  &lt;h4 id=&quot;example-1-1&quot;&gt;Example 1&lt;/h4&gt;
  &lt;p&gt;Remove User Right ‚ÄúAllow log on locally‚Äù for current user:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Set-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-RemoveRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SeInteractiveLogonRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-2-1&quot;&gt;Example 2&lt;/h4&gt;
  &lt;p&gt;Remove User Right ‚ÄúLog on as a service‚Äù for CONTOSO\User:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Set-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-RemoveRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Username&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CONTOSO\User&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SeServiceLogonRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-3-1&quot;&gt;Example 3&lt;/h4&gt;
  &lt;p&gt;Remove User Right ‚ÄúLog on as a batch job‚Äù for CONTOSO\User:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Set-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-RemoveRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Username&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CONTOSO\User&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SeBatchLogonRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h4 id=&quot;example-4-1&quot;&gt;Example 4&lt;/h4&gt;
  &lt;p&gt;Remove User Right ‚ÄúLog on as a batch job‚Äù for user SID S-1-5-11:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Set-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-RemoveRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Username&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;S-1-5-11&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SeBatchLogonRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
  &lt;h3 id=&quot;remove-multiple-users--rights--computers&quot;&gt;Remove Multiple Users / Rights / Computers&lt;/h3&gt;
  &lt;h4 id=&quot;example-5-1&quot;&gt;Example 5&lt;/h4&gt;
  &lt;p&gt;Remove User Right ‚ÄúLog on as a service‚Äù and ‚ÄúLog on as a batch job‚Äù for CONTOSO\User1 and CONTOSO\User2 and run on, local machine and SQL.contoso.com:&lt;/p&gt;
  &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Set-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-RemoveRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SeServiceLogonRight&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SeBatchLogonRight&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ComputerName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;COMPUTERNAME&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SQL.contoso.com&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CONTOSO\User1&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;CONTOSO\User2&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;  &lt;/div&gt;
&lt;/blockquote&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;check-user-rights&quot;&gt;Check User Rights&lt;/h2&gt;
&lt;h3 id=&quot;arrow_down-how-to-get-it-1&quot;&gt;:arrow_down: How to get it&lt;/h3&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/General%20Functions/Get-UserRights.ps1&quot;&gt;Get-UserRights.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Direct Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Get-UserRights.ps1&quot;&gt;Personal File Server - Get-UserRights.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Alternative Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Get-UserRights.txt&quot;&gt;Personal File Server - Get-UserRights.txt&lt;/a&gt; :arrow_left: &lt;strong&gt;Text Format Alternative Download Link&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;In order to check the Local User Rights, you will need to run the above (Get-UserRights), you may copy and paste the above script in your PowerShell ISE and press play.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/get-user-right.png&quot; alt=&quot;UserAccountsRights&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;blockquote&gt;
  &lt;h2 id=&quot;note&quot;&gt;Note&lt;/h2&gt;
  &lt;p&gt;You may edit line &lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/General%20Functions/Get-UserRights.ps1#L493&quot;&gt;493&lt;/a&gt; in the script to change what happens when the script is run without any arguments or parameters, this also allows you to change what happens when the script is run from the PowerShell ISE.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Here are a few examples:&lt;/p&gt;
&lt;h3 id=&quot;local-computer&quot;&gt;Local Computer&lt;/h3&gt;
&lt;p&gt;Get Local User Account Rights and output to text in console:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Get-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# or&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Get-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DOMAIN\Username&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;remote-computer&quot;&gt;Remote Computer&lt;/h3&gt;
&lt;p&gt;Get Remote SQL Server User Account Rights:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Get-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ComputerName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SQL.contoso.com&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Get Local Machine and SQL Server User Account Rights:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Get-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ComputerName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$&lt;/span&gt;&lt;span class=&quot;nn&quot;&gt;env&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;COMPUTERNAME&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;SQL.contoso.com&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;output-types&quot;&gt;Output Types&lt;/h3&gt;
&lt;p&gt;Output Local User Rights on Local Machine as CSV in ‚ÄòC:\Temp‚Äô:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Get-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-FileOutputPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C:\Temp&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-FileOutputType&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;CSV&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Output to Text in ‚ÄòC:\Temp‚Äô:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Get-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-FileOutputPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C:\Temp&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-FileOutputType&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Text&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# or&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Get-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-FileOutputPath&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C:\Temp&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;PassThru object to allow manipulation / filtering:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Get-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ComputerName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SQL.contoso.com&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-UserName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;DOMAIN\SQLUser&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-PassThru&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Where-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Privilege&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-match&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;SeInteractiveLogonRight&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# or&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Get-UserRights.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-PassThru&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Where-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Privilege&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-match&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;SeServiceLogonRight&apos;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Leave some feedback if this helped you! :v:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/set-and-check-user-rights-assignment/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>January 5, 2022</pubDate>
        <link>https://blakedrumm.com/blog/set-and-check-user-rights-assignment/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/set-and-check-user-rights-assignment/</guid>
      </item>
    
      <item>
        <title>Create your own offline Certificate Request for SCOM Off-Domain Server</title>
        <postImage>/assets/img/posts/local-machine-certificate.png</postImage>
        <description>&lt;p&gt;In the below example we are assuming your machine is named &lt;strong&gt;IIS-2019&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Create a new file on your machine and name it:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;IIS-2019-CertReq.inf&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Edit the file to include something similar to the following (&lt;strong&gt;NOTE: Be aware Operations Manager only uses the first CN name in the Subject&lt;/strong&gt;):&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;[NewRequest]
Subject=&quot;CN=IIS-2019.contoso.com,OU=Servers,O=Support Team,L=Charlotte,S=North Carolina,C=US&quot;
Exportable=TRUE ; Private key is exportable - Required for Server Authentication
KeyLength=2048
KeySpec=1 ; Key Exchange ‚Äì Required for encryption
KeyUsage=0xf0 ; Digital Signature, Key Encipherment
MachineKeySet=TRUE
ProviderName = &quot;Microsoft RSA SChannel Cryptographic Provider&quot;
ProviderType = 12
KeyAlgorithm = RSA

; Optionally include the Certificate Template
; [RequestAttributes]
; CertificateTemplate=&quot;SystemCenterOperationsManager&quot;

[EnhancedKeyUsageExtension]
OID=1.3.6.1.5.5.7.3.1 ; Server Authentication
OID=1.3.6.1.5.5.7.3.2  ; Client Authentication
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Open an Administrator Command Prompt and navigate to where you saved the above file. &lt;br /&gt;
Run the following:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Certreq -New -f IIS-2019-CertReq.inf IIS-2019-CertRequest.req
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;notebook-note&quot;&gt;:notebook: Note&lt;/h3&gt;
  &lt;p&gt;The server where you run the above &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Certreq&lt;/code&gt; command will be where the Certificate Private Key will be stored.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Upload the above (IIS-2019-CertRequest.req) file to your Certificate Authority. &lt;br /&gt;
‚Ä¶ &lt;br /&gt;
Once you receive back your signed certificate, import the Certificate into the Local Computer Personal Certificate Store:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;certlm.msc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;ul&gt;
  &lt;li&gt;Run this Powershell script to check the certificate you imported: &lt;br /&gt;
&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/Test-SCOMCertificate.ps1&quot;&gt;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/Test-SCOMCertificate.ps1&lt;/a&gt; &lt;br /&gt;
 &lt;br /&gt;
Run it like this:
    &lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;.\Test-SCOMCertificate.ps1 -All
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
    &lt;p&gt;You can also copy/paste the script to an Powershell ISE (Running as Administrator), you just need to edit line &lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/Test-SCOMCertificate.ps1#L770&quot;&gt;770&lt;/a&gt; to include the arguments you want to run.&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;p&gt;On a side note. If you run the SCOM Certificate Checker script above and it shows an output that looks like this: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/scom-cert-checker-missingkey.png&quot; alt=&quot;Certificate Checker Script Missing Private Key&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;You may also notice that the Private Key for the Certificate is missing: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-private-key-notpresent.png&quot; alt=&quot;Certificate Private Key Missing&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It is possible you may need to run the following command in an Administrator Command Prompt to restore the Keyspec and Private Key (replace the numbers &amp;amp; letters after &lt;strong&gt;my&lt;/strong&gt; with the serial number of your Certificate):&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;certutil -repairstore my 1f00000008c694dac94bcfdc4a000000000008
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;/assets/img/posts/certutil-output.png&quot; alt=&quot;certutil Repair Store - Command Output&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After you run the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;certutil&lt;/code&gt; command above, you will notice the Certificate is now showing a Private Key (notice the key icon): &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/certificate-private-key-present.png&quot; alt=&quot;Certificate Private Key Present&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;You should now see this when you run the SCOM Certificate Checker Powershell Script: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/scom-cert-checker-successful.png&quot; alt=&quot;Certificate Checker Script Successful&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Now you just need to import the Certificate with MOMCertImport (located on the SCOM Installation Media): &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/momcertimport-file.png&quot; alt=&quot;MOMCertImport Location&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Right Click and Run the Program as Administrator, select the certificate you imported: &lt;br /&gt;
&lt;img src=&quot;/assets/img/posts/momcertimport-certificate.png&quot; alt=&quot;Confirm Certificate in MOMCertImport&quot; class=&quot;img-fluid&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Lastly, you will need to restart the Microsoft Monitoring Agent (HealthService). You can do this via Powershell with this command:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Restart-Service&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;HealthService&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After restarting the Microsoft Monitoring Agent (HealthService). You will wait until you see the following Event ID in the Operations Manager Event Log (20053) confirming that the certificate has been loaded:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Log Name: Operations Manager
Source: OpsMgr Connector
Date: 2/28/2022 10:35:36 AM
Event ID: 20053
Task Category: None
Level: Information
Keywords: Classic
User: N/A
Computer: MS02-2019.contoso.com
Description:
The OpsMgr Connector has loaded the specified authentication certificate successfully.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;Don‚Äôt forget the Management Server&lt;/strong&gt; &lt;br /&gt;
The Management Server also needs to have a certificate requested for itself, and imported into the Personal Store in the Local Machine Certificates. You also need to run MOMCertImport.exe on the Management Server for the Management Server certificate. Otherwise the communication between the Management Server and the Agent or Gateway Server will not work via certificates.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/request-offline-certificate-for-off-domain-server/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>December 29, 2021</pubDate>
        <link>https://blakedrumm.com/blog/request-offline-certificate-for-off-domain-server/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/request-offline-certificate-for-off-domain-server/</guid>
      </item>
    
      <item>
        <title>Resolve Operations Manager Event ID 33333</title>
        <postImage>/assets/img/posts/event-33333.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;
&lt;p&gt;I had a case recently where my customer was having issues with the following Event ID 33333 on all the Management Servers in the Management Group.&lt;/p&gt;

&lt;p&gt;This is the Exact Event Information:&lt;/p&gt;
&lt;div class=&quot;language-plaintext highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Log Name:      Operations Manager
Source:        DataAccessLayer
Date:          7/7/2021 2:19:52 PM
Event ID:      33333
Task Category: None
Level:         Warning
Keywords:      Classic
User:          N/A
Computer:      ManagementServer1.contoso.com
Description:
Data Access Layer rejected retry on SqlError:
 Request: p_StateChangeEventProcess -- (BaseManagedEntityId=2ee6ce9a-6ec1-4a16-335b-700136600z60), (EventOriginId=b48055d3-18f2-40f7-a0e7-a0f8bd1b44a3), (MonitorId=f1baeb56-8cce-f8c7-79ae-d69796c9d926), (NewHealthState=3), (OldHealthState=1), (TimeGenerated=7/7/2021 6:19:43 PM), (Context=), (RETURN_VALUE=0)
 Class: 14
 Number: 2627
 Message: Violation of PRIMARY KEY constraint &apos;PK_StateChangeEvent&apos;. Cannot insert duplicate key in object &apos;dbo.StateChangeEvent&apos;. The duplicate key value is (b48055d3-18f2-40f7-a0e7-a0f8bd1b44a3).
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;page_with_curl-how-to-fix&quot;&gt;:page_with_curl: How to fix&lt;/h2&gt;
&lt;p&gt;This Powershell Script will allow you to detect for Event ID 33333 being generated and get a count of unique Servers referenced across your OperationsManager Event Log:&lt;/p&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$events&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-EventLog&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-LogName&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;Operations Manager&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Source&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;&apos;DataAccessLayer&apos;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ErrorAction&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;SilentlyContinue&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Where-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;EventID&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-eq&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;33333&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# If Event 33333 found in the OperationsManager Event Log, do the below&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;kr&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;((&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$events&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-like&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;*Violation of PRIMARY KEY constraint &apos;PK_StateChangeEvent&apos;. Cannot insert duplicate key in object &apos;dbo.StateChangeEvent&apos;. The duplicate key value is*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-and&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$events&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-like&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;*f1baeb56-8cce-f8c7-79ae-d69796c9d926*&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$message&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$events&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Select-Object&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Property&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ExpandProperty&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$matches&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$message&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-split&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;,&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;select-string&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;MonitorId=(.*)&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$match&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$matches&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;matches&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;value&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;TrimEnd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;)&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$i&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
		&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Found &lt;/span&gt;&lt;span class=&quot;si&quot;&gt;$(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt; issues with the Event ID 33333 (Monitor Id: &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$match&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;), see the following article:&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;`n&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;   https://kevinholman.com/2017/05/29/stop-healthservice-restarts-in-scom-2016/&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
	&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Run the above script on each of your Management Servers in your Management Group.&lt;/p&gt;

&lt;p&gt;I found that this correlates to this article written by Kevin Holman:
&lt;a href=&quot;https://kevinholman.com/2017/05/29/stop-healthservice-restarts-in-scom-2016/&quot;&gt;https://kevinholman.com/2017/05/29/stop-healthservice-restarts-in-scom-2016/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Following the steps in the article above, will resolve the issues you are having with Event ID: &lt;strong&gt;33333&lt;/strong&gt; &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;Violation of PRIMARY KEY constraint &apos;PK_StateChangeEvent&apos;. Cannot insert duplicate key in object &apos;dbo.StateChangeEvent&apos;.&lt;/code&gt; .&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/resolve-33333-events/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>August 16, 2021</pubDate>
        <link>https://blakedrumm.com/blog/resolve-33333-events/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/resolve-33333-events/</guid>
      </item>
    
      <item>
        <title>SCOM Clear Cache Script</title>
        <postImage>/assets/img/posts/clear-scomcache.png</postImage>
        <description>&lt;p&gt;&lt;sub&gt;Article last updated on April 12th, 2023&lt;/sub&gt;&lt;/p&gt;

&lt;h1 id=&quot;arrow_down-how-to-get-it&quot;&gt;:arrow_down: How to get it&lt;/h1&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/blob/master/Powershell/Clear-SCOMCache.ps1&quot;&gt;Clear-SCOMCache.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Direct Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Clear-SCOMCache.ps1&quot;&gt;Personal File Server - Clear-SCOMCache.ps1&lt;/a&gt; :arrow_left: &lt;strong&gt;Alternative Download Link&lt;/strong&gt; &lt;br /&gt;
&lt;em&gt;or&lt;/em&gt; &lt;br /&gt;
&lt;a href=&quot;https://files.blakedrumm.com/Clear-SCOMCache.txt&quot;&gt;Personal File Server - Clear-SCOMCache.txt&lt;/a&gt; :arrow_left: &lt;strong&gt;Text Format Alternative Download Link&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;The script without any modifications or parameters clears the Operations Manager cache only on the local server, nothing else.&lt;/p&gt;

&lt;h2 id=&quot;classical_building-argument-list&quot;&gt;:classical_building: Argument List&lt;/h2&gt;

&lt;table class=&quot;table table-hover table-text d-block overflow-auto&quot;&gt;
  &lt;thead&gt;
    &lt;tr&gt;
      &lt;th&gt;Parameter&lt;/th&gt;
      &lt;th&gt;Description&lt;/th&gt;
    &lt;/tr&gt;
  &lt;/thead&gt;
  &lt;tbody&gt;
    &lt;tr&gt;
      &lt;td&gt;-All&lt;/td&gt;
      &lt;td&gt;Optionally clear all caches that SCOM could potentially use that doesnt require a reboot. Flushing DNS, Purging Kerberos Tickets, Resetting NetBIOS over TCPIP Statistics. (Combine with -Reboot for a full clear cache)&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;-Reboot&lt;/td&gt;
      &lt;td&gt;Optionally reset winsock catalog, stop the SCOM Services, clear SCOM Cache, then reboot the server. This will always perform on the local server last.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;-Servers&lt;/td&gt;
      &lt;td&gt;Optionally each Server you want to clear SCOM Cache on. Can be an Agent, Management Server, or SCOM Gateway. This will always perform on the local server last.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;-Shutdown&lt;/td&gt;
      &lt;td&gt;Optionally shutdown the server after clearing the SCOM cache. This will always perform on the local server last.&lt;/td&gt;
    &lt;/tr&gt;
    &lt;tr&gt;
      &lt;td&gt;-Sleep&lt;/td&gt;
      &lt;td&gt;Time in seconds to sleep between each server.&lt;/td&gt;
    &lt;/tr&gt;
  &lt;/tbody&gt;
&lt;/table&gt;

&lt;h2 id=&quot;question-examples&quot;&gt;:question: Examples&lt;/h2&gt;
&lt;h3 id=&quot;clear-all-gray-scom-agents&quot;&gt;Clear all Gray SCOM Agents&lt;/h3&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#Get the SystemCenter Agent Class&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$agent&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMClass&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;where-object&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-eq&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;microsoft.systemcenter.agent&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;#Get the grey agents&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$objects&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMMonitoringObject&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-class&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$agent&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;n&quot;&gt;where&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$_&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;IsAvailable&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-eq&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;$false&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Clear-SCOMCache.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Servers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$objects&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;clear-scom-cache-on-every-management-server-in-management-group&quot;&gt;Clear SCOM cache on every Management Server in Management Group&lt;/h3&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMManagementServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Clear-SCOMCache.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;clear-scom-cache-on-every-agent-in-the-management-group&quot;&gt;Clear SCOM cache on every Agent in the Management Group&lt;/h3&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;Get-SCOMAgent&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;|&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Clear-SCOMCache.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;clear-scom-cache-and-reboot-the-servers-specified&quot;&gt;Clear SCOM cache and reboot the Servers specified&lt;/h3&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Clear-SCOMCache.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Servers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AgentServer.contoso.com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ManagementServer.contoso.com&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Reboot&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;clear-scom-cache-and-shutdown-the-servers-specified&quot;&gt;Clear SCOM cache and shutdown the Servers specified&lt;/h3&gt;
&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\Clear-SCOMCache.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Servers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AgentServer.contoso.com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;ManagementServer.contoso.com&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Shutdown&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/clear-scomcache/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>July 22, 2021</pubDate>
        <link>https://blakedrumm.com/blog/clear-scomcache/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/clear-scomcache/</guid>
      </item>
    
      <item>
        <title>System Center Operations Manager - Data Collector</title>
        <postImage>/assets/img/posts/scom-data-collector.png</postImage>
        <description>&lt;h2 id=&quot;book-introduction&quot;&gt;:book: Introduction&lt;/h2&gt;
&lt;p&gt;This tool was designed to assist with troubleshooting complex System Center Operations Manager issues.&lt;/p&gt;

&lt;h2 id=&quot;arrow_down_small-quick-download-link&quot;&gt;:arrow_down_small: Quick Download Link&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://aka.ms/SCOM-DataCollector&quot;&gt;https://aka.ms/SCOM-DataCollector&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/releases/latest&quot; class=&quot;img-shields-io&quot;&gt;&lt;img src=&quot;https://img.shields.io/github/v/release/blakedrumm/SCOM-Scripts-and-SQL&quot; alt=&quot;Latest Version&quot; /&gt;&lt;/a&gt; &lt;br /&gt;
&lt;a href=&quot;https://aka.ms/SCOM-DataCollector&quot; class=&quot;img-shields-io&quot;&gt;&lt;img src=&quot;https://img.shields.io/github/downloads/blakedrumm/SCOM-Scripts-and-SQL/latest/SCOM-DataCollector.zip?style=for-the-badge&amp;amp;color=brightgreen&quot; alt=&quot;Download Count Latest&quot; /&gt;&lt;/a&gt; &lt;br /&gt;
&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/releases&quot; class=&quot;img-shields-io&quot;&gt;&lt;img src=&quot;https://img.shields.io/github/downloads/blakedrumm/SCOM-Scripts-and-SQL/total.svg?style=for-the-badge&amp;amp;color=brightgreen&quot; alt=&quot;Download Count Releases&quot; /&gt;&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;page_facing_up-personal-webpage&quot;&gt;:page_facing_up: Personal Webpage&lt;/h2&gt;
&lt;h4 id=&quot;data-collector&quot;&gt;Data Collector&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://files.blakedrumm.com/SCOM-DataCollector.zip&quot;&gt;https://files.blakedrumm.com/SCOM-DataCollector.zip&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;report-builder&quot;&gt;Report Builder&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://files.blakedrumm.com/ReportBuilder.zip&quot;&gt;https://files.blakedrumm.com/ReportBuilder.zip&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;link-github-link&quot;&gt;:link: Github Link&lt;/h2&gt;
&lt;h4 id=&quot;data-collector-1&quot;&gt;Data Collector&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/releases/latest/download/SCOM-DataCollector.zip&quot;&gt;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/releases/latest/download/SCOM-DataCollector.zip&lt;/a&gt;&lt;/p&gt;
&lt;h4 id=&quot;report-builder-1&quot;&gt;Report Builder&lt;/h4&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/releases/latest/download/ReportBuilder.zip&quot;&gt;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/releases/latest/download/ReportBuilder.zip&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&quot;red_circle-requirements&quot;&gt;:red_circle: Requirements&lt;/h2&gt;
&lt;ul&gt;
  &lt;li&gt;System Center Operations Manager - Management Server&lt;/li&gt;
  &lt;li&gt;Administrator Privileges&lt;/li&gt;
  &lt;li&gt;Powershell 4&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;page_with_curl-instructions&quot;&gt;:page_with_curl: Instructions&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://aka.ms/SCOM-DataCollector&quot;&gt;Download the zip file&lt;/a&gt; and extract zip file to a directory (ex. C:\Data Collector). You have 2 options for running this script.&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Right Click the SCOM Data Collector script and select Run with Powershell.&lt;/li&gt;
  &lt;li&gt;Open an Powershell shell &lt;strong&gt;as Adminstrator&lt;/strong&gt; and change to the directory the SCOM Data Collector Powershell Script is located, such as:
    &lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;cd&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;C:\Data&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Collector&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector-v4.0.0.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;o-optional&quot;&gt;:o: Optional&lt;/h3&gt;
  &lt;p&gt;You have the ability to run this script as any user you would like when you start the script without any switches. The default is the System Center Data Access Service account.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Run this script on a Operations Manager Management Server to gather their SQL server names and DB names from the local registry. Otherwise user will need to manually input names. It will attempt to query the SQL Server Instance remotely, and will create CSV output files in the Output folder located in the SCOM Data Collector script directory.The SCOM Data Collector has the ability to query multiple databases in the SCOM SQL Instance (&lt;em&gt;master, OperationsManager, OperationsManagerDW&lt;/em&gt;), having a high level of rights to SQL is preferred for a full gather.&lt;/p&gt;

&lt;p&gt;After the script has completed you will see that the Output folder that is temporary created during script execution is removed. The Data Collector will automatically create a zip file in the same directory as the SCOM Data Collector Powershell Script named something similar to this: &lt;br /&gt;
&lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;SDC_Results_04_04_1975.zip&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;This script has the ability to gather the following information:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Data from Management Server(s), Operations Manager SQL Server(s). You can also gather from Servers(s) specified with &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;-Servers&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Event Logs ‚Äì Application, System, OperationsManager&lt;/li&gt;
  &lt;li&gt;SCOM Version Installed&lt;/li&gt;
  &lt;li&gt;Update Rollup Information for SCOM Upgrades&lt;/li&gt;
  &lt;li&gt;SQL Queries that collect information about many aspects of your environment (too many queries to go into detail here, here are some of the queries it uses: &lt;a href=&quot;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/tree/master/SQL%20Queries&quot;&gt;https://github.com/blakedrumm/SCOM-Scripts-and-SQL/tree/master/SQL%20Queries&lt;/a&gt;)&lt;/li&gt;
  &lt;li&gt;Windows Updates installed on Management Servers / SQL Server&lt;/li&gt;
  &lt;li&gt;Service Principal Name (SPN) Information for SCOM Management Servers&lt;/li&gt;
  &lt;li&gt;Local Administrators Group on each Management Server and any other servers you specify&lt;/li&gt;
  &lt;li&gt;Local User Account Rights on each Management Server and any other servers you specify&lt;/li&gt;
  &lt;li&gt;Database Information / DB Version&lt;/li&gt;
  &lt;li&gt;SCOM RunAs Account Information&lt;/li&gt;
  &lt;li&gt;Check TLS 1.2 Readiness&lt;/li&gt;
  &lt;li&gt;TLS Settings on each Management Server and SQL Server&lt;/li&gt;
  &lt;li&gt;MSInfo32&lt;/li&gt;
  &lt;li&gt;Sealed / Unsealed MPs&lt;/li&gt;
  &lt;li&gt;Clock Synchronization&lt;/li&gt;
  &lt;li&gt;Latency Check (Ping Test)&lt;/li&gt;
  &lt;li&gt;Rules / Monitors in your SCOM Environment&lt;/li&gt;
  &lt;li&gt;Get Run As Accounts from SCOM Management Group&lt;/li&gt;
  &lt;li&gt;Test SCOM Ports&lt;/li&gt;
  &lt;li&gt;Best Practice Analyzer to verify you are following SCOM Best Practices &lt;em&gt;(only a few items being checked currently)&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;Gathers Group Policy settings on each Management Server and SQL Server&lt;/li&gt;
  &lt;li&gt;Gathers installed Software on each Management Server&lt;/li&gt;
  &lt;li&gt;Management Group Overall Health and verify Configuration matches across Management Servers in Management Group&lt;/li&gt;
  &lt;li&gt;Check SCOM Certificates for Validity / Usability&lt;/li&gt;
  &lt;li&gt;SCOM Install / Update Logs&lt;/li&gt;
  &lt;li&gt;IP Address of each Management Server&lt;/li&gt;
  &lt;li&gt;Gather SCOM Configuration from registry and configuration file&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;&lt;em&gt;this list is not complete‚Ä¶&lt;/em&gt;&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;hr /&gt;

&lt;h2 id=&quot;question-examples&quot;&gt;:question: Examples&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;h3 id=&quot;o-optional-1&quot;&gt;:o: Optional&lt;/h3&gt;
  &lt;p&gt;If you know you have (read) Query rights against the DB(s) and Administrator permissions on the Management Servers, run any Switch (-Command) with -AssumeYes (-Yes). Otherwise you will need to provide an account that has permissions at runtime.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;available-switches&quot;&gt;Available Switches&lt;/h3&gt;
&lt;p&gt;Every Switch Available:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-All&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ManagementServers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;array&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Servers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;array&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AdditionalEventLogs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;array&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetRulesAndMonitors&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetRunAsAccounts&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-CheckTLS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-CheckCertificates&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetEventLogs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ExportMPs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GPResult&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SQLLogs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-CheckPorts&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetLocalSecurity&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetInstalledSoftware&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetSPN&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-AssumeYes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetConfiguration&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-CheckGroupPolicy&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetInstallLogs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SkipSQLQueries&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SQLOnly&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SQLOnlyOpsDB&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SQLOnlyDW&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-BuildPipeline&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-CaseNumber&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;string&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ExportSCXCertificates&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ExportMSCertificates&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GenerateHTML&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetNotificationSubscriptions&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetUserRoles&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-LeastAmount&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-MSInfo32&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-NoSQLPermission&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-PingAll&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SCXAgents&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;array&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SCXUsername&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;string&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SCXMaintenanceUsername&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;string&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SCXMonitoringUsername&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&amp;lt;string&amp;gt;&quot;&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SkipBestPracticeAnalyzer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SkipConnectivityTests&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SkipGeneralInformation&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SQLLogs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;all-switches&quot;&gt;All Switches&lt;/h3&gt;
&lt;p&gt;This will allow you to run every switch available currently:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-All&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-All&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Servers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Agent1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-All&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Servers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Agent1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Agent2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Agent3&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-All&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Servers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Agent1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ManagementServer&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;MS01-2019.contoso.com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;MS02-2019.contoso.com&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-All&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Yes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;built-in-menu&quot;&gt;Built in menu&lt;/h3&gt;
&lt;p&gt;To see the built in menu, run the script with no arguments or switches:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;You can also right click the &lt;code class=&quot;language-plaintext highlighter-rouge&quot;&gt;.ps1&lt;/code&gt; file and Run with Powershell.&lt;/p&gt;

&lt;h3 id=&quot;certificates&quot;&gt;Certificates&lt;/h3&gt;
&lt;p&gt;To Check the Certificate(s) Installed on the Management Server(s) in the Management Group, and an Server:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-CheckCertificates&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Servers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;AppServer1.contoso.com&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To Check the Certificate(s) Installed on the Management Server(s) in the Management Group:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-CheckCertificates&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;gather-only-sql-queries&quot;&gt;Gather only SQL Queries&lt;/h3&gt;
&lt;p&gt;To gather only the SQL Queries run the following:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SQLOnly&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;If you know the account running the Data Collector has permissions against the SCOM Databases, run this:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-SQLOnly&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Yes&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;event-logs&quot;&gt;Event Logs&lt;/h3&gt;
&lt;p&gt;To gather Event Logs from 3 Agents and the Management Server(s) in the Current Management Group:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetEventLogs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-Servers&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Agent1.contoso.com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Agent2.contoso.com&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;Agent3.contoso.com&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To just gather the Event Logs from the Management Server(s) in the Management Group:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetEventLogs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;management-packs&quot;&gt;Management Packs&lt;/h3&gt;
&lt;p&gt;To Export Installed Management Packs:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-ExportMPs&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;runas-accounts&quot;&gt;RunAs Accounts&lt;/h3&gt;
&lt;p&gt;To Export RunAs Accounts from the Management Server:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-GetRunAsAccounts&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;check-tls-12-readiness&quot;&gt;Check TLS 1.2 Readiness&lt;/h3&gt;
&lt;p&gt;To Run the TLS 1.2 Hardening Readiness Checks on every Management Server and SQL SCOM DB Server(s) in the Management Group:&lt;/p&gt;

&lt;div class=&quot;language-powershell highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;\DataCollector.ps1&lt;/span&gt;&lt;span class=&quot;w&quot;&gt; &lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;-CheckTLS&lt;/span&gt;&lt;span class=&quot;w&quot;&gt;
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://counter.blakedrumm.com/count/tag.svg?url=blakedrumm.com/blog/scom-data-collector/&quot; alt=&quot;Page Views&quot; /&gt;&lt;/p&gt;

&lt;!--
## Welcome to GitHub Pages

You can use the [editor on GitHub](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/edit/master/docs/index.md) to maintain and preview the content for your website in Markdown files.

Whenever you commit to this repository, GitHub Pages will run [Jekyll](https://jekyllrb.com/) to rebuild the pages in your site, from the content in your Markdown files.

### Markdown

Markdown is a lightweight and easy-to-use syntax for styling your writing. It includes conventions for

```markdown
Syntax highlighted code block

# Header 1
## Header 2
### Header 3

- Bulleted
- List

1. Numbered
2. List

**Bold** and _Italic_ and `Code` text

[Link](url) and ![Image](src)
```

For more details see [GitHub Flavored Markdown](https://guides.github.com/features/mastering-markdown/).

### Jekyll Themes

Your Pages site will use the layout and styles from the Jekyll theme you have selected in your [repository settings](https://github.com/blakedrumm/SCOM-Scripts-and-SQL/settings/pages). The name of this theme is saved in the Jekyll `_config.yml` configuration file.

### Support or Contact

Having trouble with Pages? Check out our [documentation](https://docs.github.com/categories/github-pages-basics/) or [contact support](https://support.github.com/contact) and we‚Äôll help you sort it out.

Tip:
To add auto-size pictures:
![/assets/img/posts/example.jpg](/assets/img/posts/example.jpg){:class=&quot;img-fluid&quot;}
--&gt;
</description>
        <pubDate>July 6, 2021</pubDate>
        <link>https://blakedrumm.com/blog/scom-data-collector/</link>
        <guid isPermaLink="true">https://blakedrumm.com/blog/scom-data-collector/</guid>
      </item>
    
  </channel>
</rss>
